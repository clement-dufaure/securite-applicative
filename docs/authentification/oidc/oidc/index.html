<!doctype html><html lang=fr-fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://securite-applicative.dufau.re/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://securite-applicative.dufau.re/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://securite-applicative.dufau.re/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://securite-applicative.dufau.re/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://securite-applicative.dufau.re/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://securite-applicative.dufau.re/main.4b7becdc6ae4d4aa82eeaae3b148f17d223f00ef940719fc703457a80de18eb775172b823f38cba8885e8f72faf0251df9d7be734923a80aeb8ff46713e0c1f9.css integrity="sha512-S3vs3Grk1KqC7qrjsUjxfSI/AO+UBxn8cDRXqA3hjrd1FyuCPzjLqIhej3L68CUd+de+c0kjqArrj/RnE+DB+Q==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Fonctionnement d'OpenID Connect - Formation sécurité applicative</title><meta name=description content="Protocole grandement basé sur le protocole OAuth 2.0.
OAuth2 ne gère que l&amp;rsquo;autorisation : il permet d&amp;rsquo;autoriser l&amp;rsquo;accès à une ressource en déléguant la source de contôle à une autre entité
Les système d&amp;rsquo;autorisations sont basés sur un token : on doit spécifier à l&amp;rsquo;application consommatrice le moyen de le vérifier
Un peu de vocabulaire
 Un resource owner se connecte à une application cliente d&amp;rsquo;un resource server. Le resource server accepte de donner les resources appartenant au resource owner s&amp;rsquo;il lui fournit un jeton obtenu via un authorization server."><link rel=canonical href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Fonctionnement d'OpenID Connect"><meta property="og:description" content="Protocole grandement basé sur le protocole OAuth 2.0.
OAuth2 ne gère que l&rsquo;autorisation : il permet d&rsquo;autoriser l&rsquo;accès à une ressource en déléguant la source de contôle à une autre entité
Les système d&rsquo;autorisations sont basés sur un token : on doit spécifier à l&rsquo;application consommatrice le moyen de le vérifier
Un peu de vocabulaire
 Un resource owner se connecte à une application cliente d&rsquo;un resource server. Le resource server accepte de donner les resources appartenant au resource owner s&rsquo;il lui fournit un jeton obtenu via un authorization server."><meta property="og:url" content="https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/"><meta property="og:site_name" content="Formation sécurité applicative"><meta property="og:image" content="https://securite-applicative.dufau.re/doks.png"><meta property="og:image:alt" content="Formation sécurité applicative"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Fonctionnement d'OpenID Connect"><meta name=twitter:description content><meta name=twitter:image content="https://securite-applicative.dufau.re/doks.png"><meta name=twitter:image:alt content="Fonctionnement d'OpenID Connect"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://securite-applicative.dufau.re/#/schema/organization/1","name":"Doks","url":"https://securite-applicative.dufau.re/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://securite-applicative.dufau.re/#/schema/image/1","url":"https://securite-applicative.dufau.re/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://securite-applicative.dufau.re/#/schema/image/1"}},{"@type":"WebSite","@id":"https://securite-applicative.dufau.re/#/schema/website/1","url":"https://securite-applicative.dufau.re/","name":"Formation sécurité applicative","description":"Doks is a Hugo theme for building secure, fast, and SEO-ready documentation websites, which you can easily update and customize.","publisher":{"@id":"https://securite-applicative.dufau.re/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/","url":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/","name":"Fonctionnement d\u0027OpenID Connect","description":"","isPartOf":{"@id":"https://securite-applicative.dufau.re/#/schema/website/1"},"about":{"@id":"https://securite-applicative.dufau.re/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/"]}]},{"@type":"BreadcrumbList","@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://securite-applicative.dufau.re/","url":"https://securite-applicative.dufau.re/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://securite-applicative.dufau.re/docs/","url":"https://securite-applicative.dufau.re/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://securite-applicative.dufau.re/docs/authentification/","url":"https://securite-applicative.dufau.re/docs/authentification/","name":"Authentification"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/","url":"https://securite-applicative.dufau.re/docs/authentification/oidc/","name":"Oidc"}},{"@type":"ListItem","position":5,"item":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://securite-applicative.dufau.re/#/schema/article/1","headline":"Fonctionnement d\u0027OpenID Connect","description":"","isPartOf":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/"},"mainEntityOfPage":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://securite-applicative.dufau.re/#/schema/person/2"},"publisher":{"@id":"https://securite-applicative.dufau.re/#/schema/organization/1"},"image":{"@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://securite-applicative.dufau.re/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/h-enk"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/#/schema/image/2","url":"https://securite-applicative.dufau.re/doks.png","contentUrl":"https://securite-applicative.dufau.re/doks.png","caption":"Fonctionnement d\u0027OpenID Connect"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://securite-applicative.dufau.re/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://securite-applicative.dufau.re/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://securite-applicative.dufau.re/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://securite-applicative.dufau.re/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label="Formation sécurité applicative">Formation sécurité applicative</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Formation sécurité applicative</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/clement-dufaure/securite-applicative><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0b79795d3efc95b9976c7c5b933afce2 aria-expanded=false>
Introduction</button><div class=collapse id=section-0b79795d3efc95b9976c7c5b933afce2><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/intro/grands-principes/>Les grands principes de la sécurité</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-53c7b2c8457704ee6f16cb2e6434b744 aria-expanded=false>
Failles applicatives</button><div class=collapse id=section-53c7b2c8457704ee6f16cb2e6434b744><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/intro/>Qu'est ce qu'une faille applicative ?</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/serveur/>Les attaques directes</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/client/>Les attaques basées sur des croisements de domaines</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/cookies/>Un cookie ?</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/synthese/>Synthèse</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2badb7fa3e862298a650909d45c5066b aria-expanded=false>
Https</button><div class=collapse id=section-2badb7fa3e862298a650909d45c5066b><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/https/fonctionnement/>Fontionnement de https</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/https/pratique/>Mise en pratique de https</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c48fb18ab9d562b42911cddcdc0c855f aria-expanded=true>
Authentification</button><div class="collapse show" id=section-c48fb18ab9d562b42911cddcdc0c855f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/principes/>Les grands principes de l'authentification</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/java/>L'authentification en java</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/js/>L'authentification des clients d'API</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/ldap/>Les annuaires LDAP</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/tomcat/>L'authentification sur tomcat</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3feb628448a3679f0b136e1498ee36ff aria-expanded=true>
OpenID Connect</button><div class="collapse show" id=section-3feb628448a3679f0b136e1498ee36ff><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/>Fonctionnement d'OpenID Connect</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc-java/>OpenID Connect en java</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc-js/>OpenID Connect en js</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/keycloak/>Fonctionnalités spécifiques d'un idp : exemple de Keycloak</a></li></ul></div></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/saml/>Fonctionnement de SAML</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0b79795d3efc95b9976c7c5b933afce2 aria-expanded=false>
Introduction</button><div class=collapse id=section-0b79795d3efc95b9976c7c5b933afce2><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/intro/grands-principes/>Les grands principes de la sécurité</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-53c7b2c8457704ee6f16cb2e6434b744 aria-expanded=false>
Failles applicatives</button><div class=collapse id=section-53c7b2c8457704ee6f16cb2e6434b744><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/intro/>Qu'est ce qu'une faille applicative ?</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/serveur/>Les attaques directes</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/client/>Les attaques basées sur des croisements de domaines</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/cookies/>Un cookie ?</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/failles/synthese/>Synthèse</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2badb7fa3e862298a650909d45c5066b aria-expanded=false>
Https</button><div class=collapse id=section-2badb7fa3e862298a650909d45c5066b><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/https/fonctionnement/>Fontionnement de https</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/https/pratique/>Mise en pratique de https</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c48fb18ab9d562b42911cddcdc0c855f aria-expanded=true>
Authentification</button><div class="collapse show" id=section-c48fb18ab9d562b42911cddcdc0c855f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/principes/>Les grands principes de l'authentification</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/java/>L'authentification en java</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/js/>L'authentification des clients d'API</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/ldap/>Les annuaires LDAP</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/tomcat/>L'authentification sur tomcat</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3feb628448a3679f0b136e1498ee36ff aria-expanded=true>
OpenID Connect</button><div class="collapse show" id=section-3feb628448a3679f0b136e1498ee36ff><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc/>Fonctionnement d'OpenID Connect</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc-java/>OpenID Connect en java</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/oidc-js/>OpenID Connect en js</a></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/oidc/keycloak/>Fonctionnalités spécifiques d'un idp : exemple de Keycloak</a></li></ul></div></li><li><a class="docs-link rounded" href=https://securite-applicative.dufau.re/docs/authentification/saml/>Fonctionnement de SAML</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#les-grands-principes>Les grands principes</a><ul><li><a href=#séquencement>Séquencement</a></li><li><a href=#le-consentement>Le consentement</a></li><li><a href=#les-jetons>Les jetons</a></li></ul></li><li><a href=#les-différents-flows>Les différents flows</a><ul><li><a href=#authorization-code>Authorization code</a></li><li><a href=#implicite--déprécié->Implicite : <strong>DÉPRÉCIÉ</strong> !!!</a></li><li><a href=#resource-owner-password-credentials-ou-direct-grant>Resource Owner Password Credentials ou Direct Grant</a></li><li><a href=#client-credentials-grant>Client Credentials Grant</a></li></ul></li><li><a href=#le-jeton-jwt>Le jeton JWT</a><ul><li><a href=#header>Header</a></li><li><a href=#payload>Payload</a></li></ul></li><li><a href=#je-suis-appgestion--comment-vérifier->&ldquo;Je suis appGestion&rdquo; : comment vérifier ?</a><ul><li><a href=#par-identifiantmot-de-passe->Par identifiant/mot de passe ?</a></li><li><a href=#par-url-de-redirection->Par url de redirection ?</a></li><li><a href=#par-url-dorigine->Par url d&rsquo;origine ?</a></li></ul></li><li><a href=#cas-du-web-service-backend>Cas du web service &ldquo;backend&rdquo;</a><ul><li><a href=#et-le-swagger->Et le swagger ?</a></li></ul></li><li><a href=#les-requêtes-à-la-loupe>Les requêtes à la loupe</a><ul><li><a href=#les-mécanismes-de-sécurité>Les mécanismes de sécurité</a></li><li><a href=#flow-authorization-code>Flow Authorization Code</a></li><li><a href=#contrôle-du-jeton>Contrôle du jeton</a></li><li><a href=#connexion-à-un-service-bearer-only>Connexion à un service <em>bearer-only</em></a></li><li><a href=#flow-client-credentials>Flow Client Credentials</a></li></ul></li><li><a href=#configuration-openidconnect>Configuration OpenIDConnect</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Fonctionnement d'OpenID Connect</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#les-grands-principes>Les grands principes</a><ul><li><a href=#séquencement>Séquencement</a></li><li><a href=#le-consentement>Le consentement</a></li><li><a href=#les-jetons>Les jetons</a></li></ul></li><li><a href=#les-différents-flows>Les différents flows</a><ul><li><a href=#authorization-code>Authorization code</a></li><li><a href=#implicite--déprécié->Implicite : <strong>DÉPRÉCIÉ</strong> !!!</a></li><li><a href=#resource-owner-password-credentials-ou-direct-grant>Resource Owner Password Credentials ou Direct Grant</a></li><li><a href=#client-credentials-grant>Client Credentials Grant</a></li></ul></li><li><a href=#le-jeton-jwt>Le jeton JWT</a><ul><li><a href=#header>Header</a></li><li><a href=#payload>Payload</a></li></ul></li><li><a href=#je-suis-appgestion--comment-vérifier->&ldquo;Je suis appGestion&rdquo; : comment vérifier ?</a><ul><li><a href=#par-identifiantmot-de-passe->Par identifiant/mot de passe ?</a></li><li><a href=#par-url-de-redirection->Par url de redirection ?</a></li><li><a href=#par-url-dorigine->Par url d&rsquo;origine ?</a></li></ul></li><li><a href=#cas-du-web-service-backend>Cas du web service &ldquo;backend&rdquo;</a><ul><li><a href=#et-le-swagger->Et le swagger ?</a></li></ul></li><li><a href=#les-requêtes-à-la-loupe>Les requêtes à la loupe</a><ul><li><a href=#les-mécanismes-de-sécurité>Les mécanismes de sécurité</a></li><li><a href=#flow-authorization-code>Flow Authorization Code</a></li><li><a href=#contrôle-du-jeton>Contrôle du jeton</a></li><li><a href=#connexion-à-un-service-bearer-only>Connexion à un service <em>bearer-only</em></a></li><li><a href=#flow-client-credentials>Flow Client Credentials</a></li></ul></li><li><a href=#configuration-openidconnect>Configuration OpenIDConnect</a></li></ul></nav></div></nav><p>Protocole grandement basé sur le protocole OAuth 2.0.</p><p>OAuth2 ne gère que l&rsquo;autorisation : il permet d&rsquo;autoriser l&rsquo;accès à une ressource en déléguant la source de contôle à une autre entité</p><p>Les système d&rsquo;autorisations sont basés sur un token : on doit spécifier à l&rsquo;application consommatrice le moyen de le vérifier</p><p><strong>Un peu de vocabulaire</strong></p><ul><li>Un <em>resource owner</em> se connecte à une application cliente d&rsquo;un <em>resource server</em>.</li><li>Le <em>resource server</em> accepte de donner les resources appartenant au <em>resource owner</em> s&rsquo;il lui fournit un jeton obtenu via un <em>authorization server</em>.</li></ul><p>On distinguera le <em>client</em> qui correspond à un application ayant besoin d&rsquo;une identité pour fonctionner de l&rsquo;<em>utilisateur</em> qui est la personne physique qui possède une identité</p><h2 id=les-grands-principes>Les grands principes <a href=#les-grands-principes class=anchor aria-hidden=true>#</a></h2><h3 id=séquencement>Séquencement <a href=#s%c3%a9quencement class=anchor aria-hidden=true>#</a></h3><p>Avertissement : schema simplifié par rapport à la spec complète</p><p>Notre utilisateur Alphone Robichu doit se connecter à l&rsquo;application de gestion. Il doit se connecter en tant qu&rsquo;administrateur sur l&rsquo;application de gestion. L&rsquo;application de gestion fait appel à un web service du service de gestion des stocks. Cet appel doit se faire avec sa véritable identité &ldquo;Alphonse Robichu&rdquo; et non avec un compte générique.</p><div class="mermaid bg-white text-center">sequenceDiagram
actor U as Alphonse
participant A as AppGestion
participant S as AppStock
box LightGrey Authorization Server
participant E as Authentication Endpoint
participant F as Token Endpoint
end
U->>A: Hello !
A->>U: 302 Authentifie toi !
U->>E: AppGestion me demande me m'authentifier chez toi
U->>E: Login (id/mdp par exemple)
U-->>E: Consentement
E->>U: 302 Donne ce code à AppGestion
U->>A: Voici le code fourni par l'IDP
A->>F: Je suis appGestion, puis avoir un jeton contre ce code ?
F->>A: {accessToken, refreshToken}
A->>A: check {accessToken}
loop
A->>S: get /resource/stocks muni de {accessToken}
S->>S: check {accessToken}
S->>A: /ressource/stocks
end
Note over A,S: {accessToken} expiré
A->>F: Je suis appGestion, puis avoir un nouveau jeton contre ce {refreshToken} ?</div><h3 id=le-consentement>Le consentement <a href=#le-consentement class=anchor aria-hidden=true>#</a></h3><ul><li>Avec un fournisseur d&rsquo;identité partagé, potentiellement sur plusieurs domaines différents, se pose la question du consentement</li><li>Le fournisseur d&rsquo;identité va transmettre un certain nombre d&rsquo;information à l&rsquo;application cliente via le jeton</li><li>Le ressource owner peut contrôler les informations transmises</li></ul><p>Exemple</p><ul><li>Un service lambda vous propose de vous athentifiez avec Facebook, Facebook vous avertit des informations qui vont être transmises au site tiers</li></ul><h3 id=les-jetons>Les jetons <a href=#les-jetons class=anchor aria-hidden=true>#</a></h3><ul><li>Access token : marqueur de l&rsquo;identité. On doit être capable via son contenu signé et/ou via requete au serveur d&rsquo;autorisation d&rsquo;associer de façon fiable une identité à un access token</li><li>Refresh token : NE doit servir QU&rsquo;<strong>une seule fois</strong> pour obtenir un nouveau couple {access token, refresh token}</li><li>Il existe aussi l&rsquo;ID Token initialement dédié pour porter les information d&rsquo;identité. La spec OAuth ne précisant rien sur le format des access token. Dans la pratique on peut rendre égaux les Access et ID Token</li></ul><p><strong>Confidentialité des jeton</strong>
Les information stockées dans le jeton NE sont pas CHIFFRÉES. Dans un mode qui utilise massivement https, la sécurité de OAuth2 se base grandement sur HTTPS.
On considère que le jetons non chiffré tansite toujours sur un canal chiffrés.</p><p><strong>Intégrité du jeton</strong>
Même sur un canal chiffré, n&rsquo;importe qui pourrait forger un access token ressemblant à un access token au nom de Alphonse Robichu mais non issu du serveur d&rsquo;autorisation.</p><p>L&rsquo;unique méthode de controle présenté ici sera <strong>la signature</strong>.</p><h2 id=les-différents-flows>Les différents flows <a href=#les-diff%c3%a9rents-flows class=anchor aria-hidden=true>#</a></h2><h3 id=authorization-code>Authorization code <a href=#authorization-code class=anchor aria-hidden=true>#</a></h3><p>C&rsquo;est le mode de fonctionnement Standard présenté dans la partie précédente</p><p>1/ login => code
2/ code => token</p><p><strong>Usage ?</strong>
Systématique à moins de rentrer dans les cas suivants !</p><p>En particulier dans le cadre d&rsquo;application de type &ldquo;exécution serveur&rdquo; au sein d&rsquo;un même SI, il permet de limiter grandement la circulation des access token sur le réseau.</p><h3 id=implicite--déprécié->Implicite : <strong>DÉPRÉCIÉ</strong> !!! <a href=#implicite--d%c3%a9pr%c3%a9ci%c3%a9- class=anchor aria-hidden=true>#</a></h3><p>Ressemble fortement au précédent mais en simplifié</p><p>1/ login => token</p><p>Clairement, le serveur fournit directement un token dans la redirection et non un code à échanger.
Ce flow était historiquement utilisé dans le cadre des applications de type javascript éxécutés dans le navigateur acr le code semblait alourdir le flow sans apporter de gains de sécurité.</p><p>La position a été depuis revu pour vaforiser le flow Authorization code dans ce contexte également</p><h3 id=resource-owner-password-credentials-ou-direct-grant>Resource Owner Password Credentials ou Direct Grant <a href=#resource-owner-password-credentials-ou-direct-grant class=anchor aria-hidden=true>#</a></h3><div class="mermaid bg-white text-center">sequenceDiagram
actor U as Alphonse
participant A as AppGestion
participant S as AppStock
box LightGrey Authorization Server
participant F as Token Endpoint
end
U->>A: Hello !
A->>U: Ton login et mot de passe ?
U->>A: Login id/mdp
A->>F: Je suis appGestion, puis avoir un jeton contre ces id/mdp ?
F->>A: {accessToken, refreshToken}
A->>A: check {accessToken}
loop
A->>S: get /resource/stocks muni de {accessToken}
S->>S: check {accessToken}
S->>A: /ressource/stocks
end
Note over A,S: {accessToken} expiré
A->>F: Je suis appGestion, puis avoir un nouveau jeton contre ce {refreshToken} ?</div><p><strong>Usage ?</strong></p><p>Ce flow est à réserver aux applications qui ne peuvent pas gérer des redirections, typiquement des applications &ldquo;lourdes&rdquo; installées sur un poste.
A noter que la grande différence avec le flow Standard est que l&rsquo;application cliente connait le mot de passe de l&rsquo;utilisateur, ce que l&rsquo;on cherche plutôt à éviter avec l&rsquo;utilisation d&rsquo;un fournisseur d&rsquo;identité.</p><h3 id=client-credentials-grant>Client Credentials Grant <a href=#client-credentials-grant class=anchor aria-hidden=true>#</a></h3><div class="mermaid bg-white text-center">sequenceDiagram
participant A as AppGestion
participant S as AppStock
box LightGrey Authorization Server
participant F as Token Endpoint
end
A->>F: Je suis appGestion, puis avoir un jeton en tant que appGestion ?
F->>A: {accessToken}
A->>A: check {accessToken}
loop
A->>S: get /resource/stocks muni de {accessToken}
S->>S: check {accessToken}
S->>A: /ressource/stocks
end</div><p>Le jeton d&rsquo;accès propre au client et non à un utilisateur</p><p><strong>Usage ?</strong></p><p>Soit dans les cas où l&rsquo;on a pas d&rsquo;utilisateur du tout comme un batch. Soit dans les cas où on considère que l&rsquo;accès au web service &ldquo;backend&rdquo; n&rsquo;a pas de sens à être identifié en tant qu&rsquo;utilisateur.</p><h2 id=le-jeton-jwt>Le jeton JWT <a href=#le-jeton-jwt class=anchor aria-hidden=true>#</a></h2><p>Les jetons échangés seront sous un format dit JWT, JSON Web Token.</p><p>Les données au format JSON, en trois parties : header, payload et signature</p><h3 id=header>Header <a href=#header class=anchor aria-hidden=true>#</a></h3><pre><code class=language-json>{
  &quot;alg&quot;: &quot;RS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;,
  &quot;kid&quot;: &quot;eYjLrajOiGhn_R3Yfmok2c3v3PrUZZ9ibXob0MowXvw&quot;
}
</code></pre><p>Présente notamment l&rsquo;algorithme de signature utilisé, dans l&rsquo;exemple ici, le jeton est signé avec une signature asymétrique. Le serveur d&rsquo;authentification possède une clé privée secrète avec laquelle il a signée le jeton.</p><p>Il diffuse ouvertement sa clé publique qui permet de controller la signature.</p><h3 id=payload>Payload <a href=#payload class=anchor aria-hidden=true>#</a></h3><pre><code class=language-json>{
 &quot;exp&quot;: 1528739605,
 &quot;iat&quot;: 1528739305,
 &quot;iss&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation&quot;,
 &quot;aud&quot;: &quot;client-test-web&quot;,
 &quot;typ&quot;: &quot;Bearer&quot;,
 &quot;azp&quot;: &quot;client-test-web&quot;,
 &quot;auth_time&quot;: 1528739299,
 &quot;session_state&quot;: &quot;ac727f77-fcc4-403c-9765-6ee58bc980f5&quot;,
 &quot;acr&quot;: &quot;1&quot;,
 &quot;roles&quot;: [&quot;Responsable_Clients&quot;,&quot;Gestionnaire_Stocks&quot;],
 &quot;name&quot;: &quot;Alphonse Robichu&quot;,
 &quot;preferred_username&quot;: &quot;id&quot;,
 &quot;given_name&quot;: &quot;Alphonse&quot;,
 &quot;family_name&quot;: &quot;Robichu&quot;,
 &quot;email&quot;: &quot;alphonse.robichu@my.org&quot;
}
</code></pre><p>Les infos &ldquo;utiles&rdquo; transités par le jeton dont certaines dédiées aux contrôle ou à des précisions sur le mode d&rsquo;authentification telles que
- iat : le serveur qui a émis le jeton
- exp : la date d&rsquo;expiration du jeton
- acr : le niveau de fiabilité de l&rsquo;authentification (nombre de facteurs par exemple)</p><p>On appelle <strong>claim</strong> chaque élément de ce jeton.</p><p>Les fournisseur d&rsquo;identité fournissent généralement un ensemble de claim par défaut mais le client est censé préciser les claims requi via un paramètre de <em>scope</em> à convenir entre client et serveur d&rsquo;autorisation.</p><h2 id=je-suis-appgestion--comment-vérifier->&ldquo;Je suis appGestion&rdquo; : comment vérifier ? <a href=#je-suis-appgestion--comment-v%c3%a9rifier- class=anchor aria-hidden=true>#</a></h2><h3 id=par-identifiantmot-de-passe->Par identifiant/mot de passe ? <a href=#par-identifiantmot-de-passe- class=anchor aria-hidden=true>#</a></h3><p>On va parler de <em>client_id</em> et de <em>client_secret</em></p><p>Efficace dans le cas ou AppGestion est une application purement serveur (pas une appli javascript tournant dans un navigateur) ou dans les cas Direct Grant et Client Credential.</p><p>Dans le cas de Client Credential, c&rsquo;est d&rsquo;ailleurs l&rsquo;unique protection de récupération du jeton.</p><p>Cette vérification est totalement inéfficace dans le cas d&rsquo;une application de type javascript tournant sur navigateur, en effet dela reviendrait à écrire le mot de passe dans le code source recu par l&rsquo;utilisateur&mldr;</p><p>Dans ce dernier cas, les requêtes sur <code>/token</code> seront donc non authentifiées.</p><p>Si une application cliente possède un mot de passe on parlera de <em>client confidential</em>, sinon c&rsquo;est un <em>client public</em></p><h3 id=par-url-de-redirection->Par url de redirection ? <a href=#par-url-de-redirection- class=anchor aria-hidden=true>#</a></h3><p>Quand le cas du flow Standard, la redirection va forcément faire mention à l&rsquo;url de retour vers l&rsquo;application. On peut donc contrôler le format de cette url et empecher de renvoyer vers une url qui n&rsquo;est pas censée être utilisée en fonctionnement normal.</p><p>Cette protection n&rsquo;a aucune signification dans le cas de Direct Grant ou de Client Credential.</p><h3 id=par-url-dorigine->Par url d&rsquo;origine ? <a href=#par-url-dorigine- class=anchor aria-hidden=true>#</a></h3><p>Dans le cas des application de type javascript éxécutées dans navigateur, les requetes <code>/token</code> seront éxécutées depuis les script et un navigateur effectuera ainsi la protection CORS.</p><h2 id=cas-du-web-service-backend>Cas du web service &ldquo;backend&rdquo; <a href=#cas-du-web-service-backend class=anchor aria-hidden=true>#</a></h2><p>Si un service n&rsquo;est pas une ihm, il n&rsquo;est pas censé demander une identité mais uniquement les contrôler.</p><p>On differencie explicitement les application comme AppGestion dans l&rsquo;exemple :</p><ul><li>ont une ihm</li><li>les utilisateurs s&rsquo;y connecte en n&rsquo;téant pas encore authentifié</li><li>l&rsquo;application doit être en mesure de rediriger vers l&rsquo;idp, donc de &ldquo;créer&rdquo; un identité</li><li>l&rsquo;application gère des sessions de façon à ne pas réauthentifier l&rsquo;utilisateur à chaque requête</li></ul><p>de l&rsquo;application web service de gestion des stocks qui :</p><ul><li>n&rsquo;a pas d&rsquo;ihm</li><li>n&rsquo;est censé recevoir que des requêtes identifiées &ldquo;explicitement&rdquo;</li><li><strong>n&rsquo;est pas censé réagir à une requete anonyme autrement que par 401</strong></li><li>l&rsquo;identité est revérifiée à chaque requête (pas de gestion de session)</li></ul><p>On parlera pour ce dernier type d&rsquo;application, d&rsquo;application <em>bearer-only</em>, c&rsquo;est à dire dont le seul mode d&rsquo;authentification doit être la présence d&rsquo;un jeton dans la requête.</p><p>Ces applications n&rsquo;ont en général pas à être connu du fournisseur d&rsquo;identité</p><h3 id=et-le-swagger->Et le swagger ? <a href=#et-le-swagger- class=anchor aria-hidden=true>#</a></h3><p>Le swagger n&rsquo;est <strong>PAS</strong> l&rsquo;api, c&rsquo;est techniquement une seconde application exposée sur le même serveur que l&rsquo;api qui doit être traitée comme une application à part entière.</p><p>En l&rsquo;occurence il s&rsquo;agit d&rsquo;une application de type javascript éxécutée sur navigateur.</p><h2 id=les-requêtes-à-la-loupe>Les requêtes à la loupe <a href=#les-requ%c3%aates-%c3%a0-la-loupe class=anchor aria-hidden=true>#</a></h2><h3 id=les-mécanismes-de-sécurité>Les mécanismes de sécurité <a href=#les-m%c3%a9canismes-de-s%c3%a9curit%c3%a9 class=anchor aria-hidden=true>#</a></h3><div class="mermaid bg-white text-center">sequenceDiagram
actor U as Alphonse
participant A as AppGestion
participant S as AppStock
participant E as Authentication Server &lt;br/> (/auth et /token)
U->>A: Hello !
note over A: Génération d'un state, d'un nonce et d'un (code_verifier,code_challenge) aléatoire
A->>U: 302 avec redirect_uri + state + nonce + code_challenge
U->>E: authentifie moi et retour vers redirect_uri
note over E: sauvegarde du nonce et code_challenge en session
note over E: genération aléatoire d'un session_state
E->>U: 302 code + state (passe plat) + session_state + aud
U->>A: code + state (passe plat) + session_state + aud
note over A: contrôle du state
A->>E: code + code_verifier
note over E: vérification adéquation (code_verifier,code_challenge)
E->>A: {accessToken, refreshToken, session_state}
note over A: controle du session_state
A->>A: check {accessToken}
note over A: lecture et contrôle du claim nonce de l'accessToken &lt;br/> (en plus de la signature)
note over A: controle du claim aud
A->>S: get /resource/stocks muni de {accessToken}
note over S: controle du claim aud</div><p>Le state ?</p><ul><li>Éviter les attaque CSRF par un controle du déroulé du processus</li></ul><p>session_state et nonce ?</p><ul><li>Éviter le rejeu, il permet d&rsquo;éviter de renvoyer un jeton intercepté encore valable vers d&rsquo;autre service. On parle de contrôle de corrélation entre requêtes et réponse d&rsquo;authentification</li></ul><p>Les éléments nonce, session_state sont maintenu dans la session de l&rsquo;utilisateur côté fournisseur d&rsquo;identité. La session de l&rsquo;utilisateur coté fournisseur d&rsquo;identité (idle et max) doit donc être cohérente avec la durée de rafraichissement possible du jeton (penser aux cas de formulaire long à remplir).</p><p>(code_verifier,code_challenge) ?</p><ul><li>Mécanisme PKCE (Proof Key for Code Exchange) : protection CSRF</li></ul><p>aud ? ou Audience</p><ul><li>paramétré par le fournisseur d&rsquo;identité par client, il permet de préciser la portée d&rsquo;usage du jeton. L&rsquo;audience peut être vérifié sur un web service transitif.
Ce claim permet de distinguer des zones d&rsquo;usage des tokens.</li></ul><h3 id=flow-authorization-code>Flow Authorization Code <a href=#flow-authorization-code class=anchor aria-hidden=true>#</a></h3><p>Connexion à Appgestion, redirection vers l&rsquo;<em>authorization server</em>.</p><pre><code class=language-http>GET https://mon.fournisseur.identite/auth
?redirect_uri=https://mon.appli.gestion/sso/callback
&amp;state=9115c618-b01c-4966-a26e-8171caf30dcf
&amp;.......
</code></pre><ul><li>Le paramètre redirect_uri permet le contrôle de l&rsquo;url de l&rsquo;application de gestion où sera envoyé le code</li><li>Le paramètre state est généré aléatoirement par le client, il permet d&rsquo;éviter les attaque de type CSRF, il devra être renvoyé et contrôlé par le client au retour : l&rsquo;application le stocke associé à la session de l&rsquo;utilisateur</li></ul><p>Suite à l&rsquo;authentification sur l&rsquo;<em>authorization server</em>, redirection vers l&rsquo;application</p><pre><code class=language-http>GET https://mon.appli.gestion/sso/callback
?state=9115c618-b01c-4966-a26e-8171caf30dcf
&amp;session_state=cc84a1d5-2f0e-4100-aef9-be6aa4278d91
&amp;code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.[...]
&amp;.......
</code></pre><ul><li>Le state permet donc de s&rsquo;assurer que l&rsquo;application est bien initiatrice du processus d&rsquo;authentification</li><li>Le session_state est généré aléatoirement par le fournisseur d&rsquo;identité, dans la même logique que le state, il permettra de corréler la demande d&rsquo;authentification au reste du processus (notamment pour éviter les rejeu)</li><li>Le code à échanger contre un token. <strong>A noter que durant sa durée de validité, le code est autant critique que le mot de passe de l&rsquo;utilisateur</strong></li></ul><p>L&rsquo;application demande un jeton</p><pre><code class=language-http>POST https://mon.fournisseur.identite/token/token
Authorization: Basic YXBwbGktdGVzdDphOWUzMmYzMC1hNzFiLTQ0Y2ItODQwMi1iZjdkY2VmNzlhMTM= # appli-test:[Secret]
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[...]

grant_type=authorization_code
&amp;code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0.[...]
</code></pre><ul><li>grant_type : le type de troc demandé au serveur, ici on va échanger un code contre un token</li><li>la code</li><li>l&rsquo;authentification du client le cas échéant en authentification Basic</li></ul><p>Dans le cas de client <em>public</em> (javascript), il n&rsquo;y a donc pas d&rsquo;entete Authorization</p><p>Si tout se pass bien, le serveur d&rsquo;autorisation va donc répondre :</p><pre><code class=language-json>{
  &quot;access_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;expires_in&quot;:300,
  &quot;refresh_expires_in&quot;:1800,
  &quot;refresh_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;token_type&quot;:&quot;bearer&quot;,
  &quot;id_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;not-before-policy&quot;:0,
  &quot;session_state&quot;:&quot;34dc14d5-bbd0-4c15-86b4-2d40629e0ced&quot;,
  &quot;scope&quot;:&quot;&quot;
}
</code></pre><p>On retrouve notamment le session_state permettant de controller la corrélation des demandes.</p><p>On obtient donc les différents token attendus :</p><ul><li>L&rsquo;access token qui peut égaler l&rsquo;ID token dans son contenu &ldquo;utile&rdquo; mais qui est censé être le seul à pouvoir donner authentification via échange de jeton. <strong>A noter que durant sa durée de validité, l&rsquo;access token est autant critique que le mot de passe de l&rsquo;utilisateur</strong>. Comme il peut être ammené à beaucoup circuler sur le réseau, sa durée de validité est censé être très réduite (recommandé vers 5 minutes).</li><li>le refresh token est censé être à usage unique, pour renouveler la demande précédente mais en épargnant l&rsquo;utilisateur d&rsquo;aller rechercher un code.</li></ul><pre><code class=language-http>POST https://mon.fournisseur.identite/token/token
Authorization: Basic YXBwbGktdGVzdDphOWUzMmYzMC1hNzFiLTQ0Y2ItODQwMi1iZjdkY2VmNzlhMTM=
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[...]

grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]
</code></pre><p>(Et toujours dans le cas de <em>client public</em> : pas d&rsquo;entete Authorization)</p><pre><code class=language-json>{
  &quot;access_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;expires_in&quot;:300,
  &quot;refresh_expires_in&quot;:1800,
  &quot;refresh_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;token_type&quot;:&quot;bearer&quot;,
  &quot;id_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  &quot;not-before-policy&quot;:0,
  &quot;session_state&quot;:&quot;2bf0c940-ac60-488c-bc32-d6ced922f90d&quot;,
  &quot;scope&quot;:&quot;&quot;
}
</code></pre><p>A noter que l&rsquo;on obtient un <strong>nouveau</strong> refresh token qui est censé invalider le précédent</p><p>Un refresh token ne circule donc en étant valide que deux fois sur le réseau, d&rsquo;où la fait que sa durée peut être longue (chiffrée en heures).</p><h3 id=contrôle-du-jeton>Contrôle du jeton <a href=#contr%c3%b4le-du-jeton class=anchor aria-hidden=true>#</a></h3><p>Le serveur doit connaitre la clé publique du serveur d&rsquo;autorisation pour valider les access-token (c&rsquo;est d&rsquo;ailleurs l&rsquo;unique vérification faite dans le cas d&rsquo;un bearer-only)</p><p>La clé publique de validation de la signature peut être stockée en dûr dans l&rsquo;application cliente.</p><p>On peut aussi la demander au serveur d&rsquo;autorisation.</p><pre><code class=language-http>GET https://mon.foutrnisseur.identite/.well-known/openid-configuration
</code></pre><pre><code class=language-json>{
  &quot;issuer&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation&quot;,
  &quot;authorization_endpoint&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/auth&quot;,
  &quot;token_endpoint&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/token&quot;,
  &quot;end_session_endpoint&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/logout&quot;,
  &quot;jwks_uri&quot;: &quot;https://mon.serveur.keycloak/auth/realms/formation/protocol/openid-connect/certs&quot;,
  ...
}
</code></pre><h3 id=connexion-à-un-service-bearer-only>Connexion à un service <em>bearer-only</em> <a href=#connexion-%c3%a0-un-service-bearer-only class=anchor aria-hidden=true>#</a></h3><pre><code class=language-http>GET https://ma.gestion.de.stocks/stocks/ressource 
Authorization: Bearer  eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]  
</code></pre><p>L&rsquo;acces token est envoyé brut dans l&rsquo;entête Authorization</p><h3 id=flow-client-credentials>Flow Client Credentials <a href=#flow-client-credentials class=anchor aria-hidden=true>#</a></h3><ul><li>Récupération d&rsquo;un jeton :</li></ul><pre><code>POST auth/realms/formation/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&amp;client_id=YOUR_CLIENT_ID&amp;client_secret=YOUR_CLIENT_SECRET 
</code></pre><pre><code class=language-json>{
  &quot;access_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMWs3ZXNUbG1XTHBVSXIydEp2c0E4V0tDS1EtNWNvUjVNVmQwVFRHRlFBIn0.[...]&quot;,
  ...
}
</code></pre><h2 id=configuration-openidconnect>Configuration OpenIDConnect <a href=#configuration-openidconnect class=anchor aria-hidden=true>#</a></h2><p>L&rsquo;appli cliente doit connaitre quelques endpoints du serveur d&rsquo;autorisation</p><ul><li>endpoint auth</li><li>endpoint token</li><li>enpoint jwks (clés publiques)</li></ul><p>ces endpoints sont de façon standard donnés sur l&rsquo;url https://mon.foutrnisseur.identite/.well-known/openid-configuration</p><p>Une configuration doit être négociée entre l&rsquo;application client et le serveur d&rsquo;autorisation</p><ul><li>Le <em>client_id</em></li><li>Le <em>client_secret</em> le cas échéant (donc pas pour les applis javascript)</li></ul><p>Une application de bearer-only n&rsquo;a besoin que de la clé publique de validation ou de l&rsquo;url pour l&rsquo;obtenir.</p><p>Cette url est accessible sans authentification, il n&rsquo;est pas nécessaire de configurer le fournisseur d&rsquo;dentité autour de l&rsquo;identité du client <em>bearer-only</em></p><p><em>Le concept d&rsquo;expiration rapide de l&rsquo;access token et de renouvellement entraine génralement plusieurs configuration requisse sur la politique de renouvellement des jeton</em></p><ul><li>A chaque requête ?</li><li>Après expiration ?</li><li>Toutes les n secondes fixes ?</li><li>n secondes avant expiration ?</li></ul><p><em>Des configurations plus applicatives sont souvent demandées telles que le claim fournissant le nom d&rsquo;utilisateur ou la liste de ses habilitations</em></p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=/docs/authentification/tomcat/><div class="card my-1"><div class="card-body py-2">&larr; L'authentification sur tomcat</div></div></a><a class=ms-auto href=/docs/authentification/oidc/oidc-java/><div class="card my-1"><div class="card-body py-2">OpenID Connect en java &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by Github-pages, <a class=text-muted href=https://gohugo.io/>Hugo</a>, and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.f93d87ed312fd94eae9a720e5988a3bd322bcdd099518866fc5668e18610cca0077fc356b3edfc727dedf5f773dab0a6d87a870e4b616595e76381163dd5a730.js integrity="sha512-+T2H7TEv2U6umnIOWYijvTIrzdCZUYhm/FZo4YYQzKAHf8NWs+38cn3t9fdz2rCm2HqHDkthZZXnY4EWPdWnMA==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.537e57b5cd767e9b03563e3c2d8db2bb71516fb92afdadec7dbadb99c3a2710479044278bfeaa670bf89dd37224ed7e73d319d5e7819b6293907ddabd61bfd77.js integrity="sha512-U35Xtc12fpsDVj48LY2yu3FRb7kq/a3sfbrbmcOicQR5BEJ4v+qmcL+J3TciTtfnPTGdXngZtik5B92r1hv9dw==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/katex.min.93253b59f879e8b8bf4ef8eec49737249299a1cc8b9c25eb1b0c94ae722f3bc470677d56dfdfcc838ccc904ee3ebcc46a5336495f3b1d7fdbb182f3e6b952390.js integrity="sha512-kyU7Wfh56Li/TvjuxJc3JJKZocyLnCXrGwyUrnIvO8RwZ31W39/Mg4zMkE7j68xGpTNklfOx1/27GC8+a5UjkA==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/contrib/auto-render.min.b688a23169501c711300d4bdb5ae40c52ee8976f722fbf3871eb709a51db2ea5d7bf51eaef0e82af7542d973d2f681d9c46b70b72d902601642a15af9b9ce80d.js integrity="sha512-toiiMWlQHHETANS9ta5AxS7ol29yL784cetwmlHbLqXXv1Hq7w6Cr3VC2XPS9oHZxGtwty2QJgFkKhWvm5zoDQ==" crossorigin=anonymous defer></script>
<script src=/main.min.b8e7e565bd2186f67f57d2c5d9680f67abbb2a977ff20ad27eb51f5a7b9071fdec7b71a5e964a41a38fb59cb12d43b76e0b3ac8247cb7063bb73efc06a9ac529.js integrity="sha512-uOflZb0hhvZ/V9LF2WgPZ6u7Kpd/8grSfrUfWnuQcf3se3Gl6WSkGjj7WcsS1Dt24LOsgkfLcGO7c+/AaprFKQ==" crossorigin=anonymous defer></script>
<script src=/js/mermaid.min.83b8594750563833e1c00aeeca8f704e65d284daca1c66a503f2496362f4b45477d8cc7a064d9ec4521e5e737513884abea18acc41236f47f88a05c8eba8d239.js integrity="sha512-g7hZR1BWODPhwAruyo9wTmXShNrKHGalA/JJY2L0tFR32Mx6Bk2exFIeXnN1E4hKvqGKzEEjb0f4igXI66jSOQ==" crossorigin=anonymous defer></script>
<script src=https://securite-applicative.dufau.re/index.min.f895eeb723167b474550a304da9035a630a2b2e855b8e6fbf5a7c96ae104a7ab2948331b2bd2ea797e1ae915734999a9f24a733178541a81d51e423c956603ba.js integrity="sha512-+JXutyMWe0dFUKME2pA1pjCisuhVuOb79afJauEEp6spSDMbK9LqeX4a6RVzSZmp8kpzMXhUGoHVHkI8lWYDug==" crossorigin=anonymous defer></script></body></html>